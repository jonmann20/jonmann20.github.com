"use strict";function GameEngine(){let t=document.createElement("a");t.href="/#games",t.innerText="Back",t.className="btnBack",document.body.appendChild(t);let e=document.createElement("div");e.className="canvasWrap",window.canvas=document.createElement("canvas"),canvas.setAttribute("width",1008),canvas.setAttribute("height",567),e.appendChild(canvas),document.body.appendChild(e),window.ctx=canvas.getContext("2d"),this.input=new GameInput(this),this.graphics=new GameGraphics(this),this.utils=new GameUtils(this),this.view=new GameView(this),this.init()}function GameInput(){this.keysDown={},this.lastKeyUp=KeyCode.EMPTY,this.lastKeyDown=KeyCode.EMPTY,this.init()}function GameUtils(t){return{switchView:function(e){e.init(),t.view=e}}}function GameGraphics(t){return{isAnimating:!1,repeatAction:function(t,e,i){this.isAnimating=!0;let n=0,o=this,s=setInterval(function(){n++>e?(clearInterval(s),o.isAnimating=!1):i()},t)}}}function GameView(t){this.privates={bgColor:"#ccc"},this.init()}function TitleView(t){this.privates={title:t},this.init()}function GameSaveView(){this.privates={},this.init()}function OverworldView(){this.privates={},this.init()}function BattleView(t,e,i){this.privates={bgColor:t,dormantL:e,dormantR:i},this.init()}function Dormant(t,e,i,n,o,s,a){let r=this;this.img=new Image,this.imgReady=!1,this.img.onload=function(){r.imgReady=!0},this.img.src=`img/${t}`,this.name=e,this.atk=i,this.def=n,this.initHP=this.hp=o,this.actions=s,this.lvl=void 0!==a?a:1,this.xp=0,this.xpNeeded=50}GameEngine.prototype=function(){function t(){i.view.update(),s&&i.onUpdate()}function e(){o=requestAnimationFrame(e),i.view.render(),a&&i.onRender()}let i,n,o,s=!1,a=!1;return{init:function(){i=this},onUpdate:function(t){s=!0,this.onUpdate=t},onRender:function(t){a=!0,this.onRender=t},start:()=>{n=setInterval(t,1e3/60),o=requestAnimationFrame(e)},stop:()=>{clearInterval(n),cancelAnimationFrame(o)}}}();class GameSave{load(t){return localStorage[`slot ${t}`]}getList(){const t=this.load(0),e=this.load(1),i=this.load(2);return[void 0!==t?t:"---",void 0!==e?e:"---",void 0!==i?i:"---"]}save(t,e){localStorage[`slot ${t}`]=e}erase(t){return localStorage.removeItem(`slot ${t}`),this.getList()}}GameInput.prototype=function(){function t(t){return t===KeyCode.W?t=KeyCode.UP:t===KeyCode.S?t=KeyCode.DOWN:t===KeyCode.D?t=KeyCode.RIGHT:t===KeyCode.A&&(t=KeyCode.LEFT),t}let e;return addEventListener("keydown",function(i){let n=t(i.keyCode);e.keysDown[n]||(e.lastKeyDown=n,e.keysDown[n]=!0)}),addEventListener("keyup",function(i){e.lastKeyUp=t(i.keyCode),delete e.keysDown[e.lastKeyUp]}),{init:function(){e=this},update:function(){}}}();const KeyCode={EMPTY:-1,ENTER:13,CTRL:17,ESC:27,SPACEBAR:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,A:65,D:68,F:70,H:72,J:74,K:75,M:77,O:79,R:82,S:83,W:87};let KeyCodeNames={};KeyCodeNames[-1]="EMPTY",KeyCodeNames[13]="ENTER",KeyCodeNames[17]="CTRL",KeyCodeNames[27]="ESC",KeyCodeNames[32]="SPACEBAR",KeyCodeNames[37]="LEFT",KeyCodeNames[38]="UP",KeyCodeNames[39]="RIGHT",KeyCodeNames[40]="DOWN",KeyCodeNames[46]="DELETE",KeyCodeNames[65]="A",KeyCodeNames[68]="D",KeyCodeNames[70]="F",KeyCodeNames[72]="H",KeyCodeNames[74]="J",KeyCodeNames[75]="K",KeyCodeNames[77]="M",KeyCodeNames[79]="O",KeyCodeNames[82]="R",KeyCodeNames[83]="S",KeyCodeNames[87]="W";const Dir={RIGHT:0,LEFT:1};!function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():t.SAT=e()}(this,function(){function t(t,e){this.x=t||0,this.y=e||0}function e(e,i){this.pos=e||new t,this.r=i||0}function i(e,i){this.pos=e||new t,this.angle=0,this.offset=new t,this.setPoints(i||[])}function n(e,i,n){this.pos=e||new t,this.w=i||0,this.h=n||0}function o(){this.a=null,this.b=null,this.overlapN=new t,this.overlapV=new t,this.clear()}function s(t,e,i){for(var n=Number.MAX_VALUE,o=-Number.MAX_VALUE,s=t.length,a=0;a<s;a++){var r=t[a].dot(e);r<n&&(n=r),r>o&&(o=r)}i[0]=n,i[1]=o}function a(t,e,i,n,o,a){var r=y.pop(),l=y.pop(),c=h.pop().copy(e).sub(t),p=c.dot(o);if(s(i,o,r),s(n,o,l),l[0]+=p,l[1]+=p,r[0]>l[1]||l[0]>r[1])return h.push(c),y.push(r),y.push(l),!0;if(a){var u=0;if(r[0]<l[0])a.aInB=!1,r[1]<l[1]?(u=r[1]-l[0],a.bInA=!1):u=(f=r[1]-l[0])<(d=l[1]-r[0])?f:-d;else if(a.bInA=!1,r[1]>l[1])u=r[0]-l[1],a.aInB=!1;else{var f=r[1]-l[0],d=l[1]-r[0];u=f<d?f:-d}var m=Math.abs(u);m<a.overlap&&(a.overlap=m,a.overlapN.copy(o),u<0&&a.overlapN.reverse())}return h.push(c),y.push(r),y.push(l),!1}function r(t,e){var i=t.len2(),n=e.dot(t);return n<0?m:n>i?v:x}function l(t,e,i){for(var n=h.pop().copy(e.pos).sub(t.pos),o=e.r,s=o*o,a=t.calcPoints,l=a.length,c=h.pop(),p=h.pop(),u=0;u<l;u++){var y=u===l-1?0:u+1,f=0===u?l-1:u-1,d=0,x=null;c.copy(t.edges[u]),p.copy(n).sub(a[u]),i&&p.len2()>s&&(i.aInB=!1);var w=r(c,p);if(w===m){c.copy(t.edges[f]);var g=h.pop().copy(n).sub(a[f]);if((w=r(c,g))===v){if((C=p.len())>o)return h.push(n),h.push(c),h.push(p),h.push(g),!1;i&&(i.bInA=!1,x=p.normalize(),d=o-C)}h.push(g)}else if(w===v){if(c.copy(t.edges[y]),p.copy(n).sub(a[y]),(w=r(c,p))===m){if((C=p.len())>o)return h.push(n),h.push(c),h.push(p),!1;i&&(i.bInA=!1,x=p.normalize(),d=o-C)}}else{var K=c.perp().normalize(),C=p.dot(K),T=Math.abs(C);if(C>0&&T>o)return h.push(n),h.push(K),h.push(p),!1;i&&(x=K,d=o-C,(C>=0||d<2*o)&&(i.bInA=!1))}x&&i&&Math.abs(d)<Math.abs(i.overlap)&&(i.overlap=d,i.overlapN.copy(x))}return i&&(i.a=t,i.b=e,i.overlapV.copy(i.overlapN).scale(i.overlap)),h.push(n),h.push(c),h.push(p),!0}function c(t,e,i){for(var n=t.calcPoints,o=n.length,s=e.calcPoints,r=s.length,l=0;l<o;l++)if(a(t.pos,e.pos,n,s,t.normals[l],i))return!1;for(l=0;l<r;l++)if(a(t.pos,e.pos,n,s,e.normals[l],i))return!1;return i&&(i.a=t,i.b=e,i.overlapV.copy(i.overlapN).scale(i.overlap)),!0}var p={};p.Vector=t,p.V=t,t.prototype.copy=t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.clone=t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.perp=t.prototype.perp=function(){var t=this.x;return this.x=this.y,this.y=-t,this},t.prototype.rotate=t.prototype.rotate=function(t){var e=this.x,i=this.y;return this.x=e*Math.cos(t)-i*Math.sin(t),this.y=e*Math.sin(t)+i*Math.cos(t),this},t.prototype.reverse=t.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this},t.prototype.normalize=t.prototype.normalize=function(){var t=this.len();return t>0&&(this.x=this.x/t,this.y=this.y/t),this},t.prototype.add=t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.sub=t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.scale=t.prototype.scale=function(t,e){return this.x*=t,this.y*=e||t,this},t.prototype.project=t.prototype.project=function(t){var e=this.dot(t)/t.len2();return this.x=e*t.x,this.y=e*t.y,this},t.prototype.projectN=t.prototype.projectN=function(t){var e=this.dot(t);return this.x=e*t.x,this.y=e*t.y,this},t.prototype.reflect=t.prototype.reflect=function(t){var e=this.x,i=this.y;return this.project(t).scale(2),this.x-=e,this.y-=i,this},t.prototype.reflectN=t.prototype.reflectN=function(t){var e=this.x,i=this.y;return this.projectN(t).scale(2),this.x-=e,this.y-=i,this},t.prototype.dot=t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.len2=t.prototype.len2=function(){return this.dot(this)},t.prototype.len=t.prototype.len=function(){return Math.sqrt(this.len2())},p.Circle=e,e.prototype.getAABB=e.prototype.getAABB=function(){var e=this.r;return new n(this.pos.clone().sub(new t(e,e)),2*e,2*e).toPolygon()},p.Polygon=i,i.prototype.setPoints=i.prototype.setPoints=function(e){if(!this.points||this.points.length!==e.length){var i,n=this.calcPoints=[],o=this.edges=[],s=this.normals=[];for(i=0;i<e.length;i++)n.push(new t),o.push(new t),s.push(new t)}return this.points=e,this._recalc(),this},i.prototype.setAngle=i.prototype.setAngle=function(t){return this.angle=t,this._recalc(),this},i.prototype.setOffset=i.prototype.setOffset=function(t){return this.offset=t,this._recalc(),this},i.prototype.rotate=i.prototype.rotate=function(t){for(var e=this.points,i=e.length,n=0;n<i;n++)e[n].rotate(t);return this._recalc(),this},i.prototype.translate=i.prototype.translate=function(t,e){for(var i=this.points,n=i.length,o=0;o<n;o++)i[o].x+=t,i[o].y+=e;return this._recalc(),this},i.prototype._recalc=function(){var t,e=this.calcPoints,i=this.edges,n=this.normals,o=this.points,s=this.offset,a=this.angle,r=o.length;for(t=0;t<r;t++){var l=e[t].copy(o[t]);l.x+=s.x,l.y+=s.y,0!==a&&l.rotate(a)}for(t=0;t<r;t++){var c=e[t],p=t<r-1?e[t+1]:e[0],h=i[t].copy(p).sub(c);n[t].copy(h).perp().normalize()}return this},i.prototype.getAABB=i.prototype.getAABB=function(){for(var e=this.calcPoints,i=e.length,o=e[0].x,s=e[0].y,a=e[0].x,r=e[0].y,l=1;l<i;l++){var c=e[l];c.x<o?o=c.x:c.x>a&&(a=c.x),c.y<s?s=c.y:c.y>r&&(r=c.y)}return new n(this.pos.clone().add(new t(o,s)),a-o,r-s).toPolygon()},p.Box=n,n.prototype.toPolygon=n.prototype.toPolygon=function(){var e=this.pos,n=this.w,o=this.h;return new i(new t(e.x,e.y),[new t,new t(n,0),new t(n,o),new t(0,o)])},p.Response=o,o.prototype.clear=o.prototype.clear=function(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this};for(var h=[],u=0;u<10;u++)h.push(new t);for(var y=[],u=0;u<5;u++)y.push([]);var f=new o,d=new n(new t,1e-6,1e-6).toPolygon();p.isSeparatingAxis=a;var m=-1,x=0,v=1;return p.pointInCircle=function(t,e){var i=h.pop().copy(t).sub(e.pos),n=e.r*e.r,o=i.len2();return h.push(i),o<=n},p.pointInPolygon=function(t,e){d.pos.copy(t),f.clear();var i=c(d,e,f);return i&&(i=f.aInB),i},p.testCircleCircle=function(t,e,i){var n=h.pop().copy(e.pos).sub(t.pos),o=t.r+e.r,s=o*o,a=n.len2();if(a>s)return h.push(n),!1;if(i){var r=Math.sqrt(a);i.a=t,i.b=e,i.overlap=o-r,i.overlapN.copy(n.normalize()),i.overlapV.copy(n).scale(i.overlap),i.aInB=t.r<=e.r&&r<=e.r-t.r,i.bInA=e.r<=t.r&&r<=t.r-e.r}return h.push(n),!0},p.testPolygonCircle=l,p.testCirclePolygon=function(t,e,i){var n=l(e,t,i);if(n&&i){var o=i.a,s=i.aInB;i.overlapN.reverse(),i.overlapV.reverse(),i.a=i.b,i.b=o,i.aInB=i.bInA,i.bInA=s}return n},p.testPolygonPolygon=c,p}),GameView.prototype={then:function(t){this.privates.callback=t},init:function(){},update:function(){},render:function(){ctx.fillStyle=this.privates.bgColor,ctx.fillRect(0,0,canvas.width,canvas.height)}},TitleView.prototype=function(){let t,e="Press Enter";return{then:function(t){this.privates.callback=t},init:function(){t=this.privates.title},update:function(){game.input.lastKeyDown===KeyCode.ENTER&&(game.input.lastKeyDown=KeyCode.EMPTY,this.privates.callback())},render:()=>{ctx.fillStyle="#000",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.font="36px Arial",ctx.fillStyle="#fff",ctx.fillText(t,canvas.width/2-ctx.measureText(t).width/2,100),ctx.font="24px Arial",ctx.fillText(e,canvas.width/2-ctx.measureText(e).width/2,canvas.height/2)}}}(),GameSaveView.prototype=function(){let t,e,i="Select a save slot",n=new GameSave,o=n.getList();return{then:function(t){this.privates.callback=t},init:function(){t=this,e={img:">>",slot:0,x:canvas.width/2-ctx.measureText(o[0]).width/2-60,y:200}},update:function(){if(game.input.lastKeyDown===KeyCode.ESC)game.input.lastKeyDown=KeyCode.EMPTY,this.privates.callback(KeyCode.ESC);else if(game.input.lastKeyDown===KeyCode.ENTER){game.input.lastKeyDown=KeyCode.EMPTY;const t=new Date,i=t.getMonth()+1,o=t.getDate(),s=t.getFullYear(),a=t.toLocaleTimeString();n.save(e.slot,`${i}/${o}/${s} ${a}`),this.privates.callback(KeyCode.ENTER)}else game.input.lastKeyDown===KeyCode.DELETE?(game.input.lastKeyDownp=KeyCode.EMPTY,o=n.erase(e.slot)):2!==e.slot&&game.input.lastKeyDown===KeyCode.DOWN?(game.input.lastKeyDown=KeyCode.EMPTY,++e.slot,e.x=canvas.width/2-ctx.measureText(o[e.slot]).width/2-60,e.y+=80):0!==e.slot&&game.input.lastKeyDown===KeyCode.UP&&(game.input.lastKeyDown=KeyCode.EMPTY,--e.slot,e.x=canvas.width/2-ctx.measureText(o[e.slot]).width/2-60,e.y-=80)},render:function(){ctx.fillStyle="#111",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.font="36px Arial",ctx.fillStyle="#fff",ctx.fillText(i,canvas.width/2-ctx.measureText(i).width/2,80),ctx.font="24px Arial";for(let t=0;t<o.length;++t)ctx.fillText(o[t],canvas.width/2-ctx.measureText(o[t]).width/2,200+80*t);ctx.fillText(e.img,e.x,e.y)}}}(),OverworldView.prototype=function(){var t={img:"^^"};return{then:function(t){this.privates.callback=t},init:function(){t.x=90,t.y=canvas.height/2+70,t.slot=0},update:function(){game.input.lastKeyDown===KeyCode.ENTER?(game.input.lastKeyDown=KeyCode.EMPTY,this.privates.callback()):game.input.lastKeyDown===KeyCode.RIGHT?(game.input.lastKeyDown=KeyCode.EMPTY,t.slot<7&&(t.x+=115,++t.slot)):game.input.lastKeyDown===KeyCode.LEFT&&(game.input.lastKeyDown=KeyCode.EMPTY,t.slot>0&&(t.x-=115,--t.slot))},render:function(){ctx.fillStyle="#34282c",ctx.fillRect(0,0,canvas.width,canvas.height);for(var e,i,n=0;n<8;++n)e=60+115*n,i=canvas.height/2-40,ctx.fillStyle="#fff",ctx.font="18px Arial",ctx.fillText("Level "+(n+1),e+10,i-13),ctx.fillStyle="red",ctx.fillRect(e,i,80,80);ctx.fillStyle="#fff",ctx.fillText(t.img,t.x,t.y)}}}(),BattleView.prototype=function(){function t(t,e){switch(game.input.lastKeyDown){case KeyCode.ENTER:return game.input.lastKeyDown=KeyCode.EMPTY,h.name=t.actions[f.curSlot].name,h.atk=t.atk*t.actions[f.curSlot].multiplier/e.def,!0;case KeyCode.UP:game.input.lastKeyDown=KeyCode.EMPTY,0!==f.curSlot&&null!==t.actions[f.curSlot-1]&&(--f.curSlot,f.y-=30);break;case KeyCode.DOWN:game.input.lastKeyDown=KeyCode.EMPTY,3!==f.curSlot&&null!==t.actions[f.curSlot+1]&&(++f.curSlot,f.y+=30)}}function e(){r.dir=Dir.RIGHT,game.graphics.repeatAction(6,60,function(){r.dir===Dir.RIGHT&&r.x>60&&(r.dir=Dir.LEFT),r.dir===Dir.RIGHT?++r.x:--r.x,y.hp-=h.atk/60})}function i(t,e,i,n){let o=t.name+" L"+t.lvl;ctx.fillStyle="#000",ctx.fillText(o,e+ctx.measureText(o).width/2,i),ctx.fillText("HP",e,i+20),ctx.strokeStyle="#000",ctx.strokeRect(e+21,i+12,100,10),ctx.fillStyle="red",ctx.fillRect(e+22,i+13,t.hp*(100/t.initHP)-1,8),n&&(ctx.fillStyle="#000",ctx.fillText("XP",e,i+40),ctx.strokeStyle="#000",ctx.strokeRect(e+21,i+32,100,10),ctx.fillStyle="#777",ctx.fillRect(e+22,i+33,t.xp*(100/t.xpNeeded)-1,8))}function n(){ctx.strokeStyle="#000",ctx.strokeRect(20,300,500,250),ctx.font="12px Arial",ctx.fillStyle="#000",ctx.fillText("ATK: "+u.atk,460,320),ctx.fillText("DEF: "+u.def,460,340),o(),s()}function o(){ctx.fillStyle="#000";for(var t=0;t<4;++t)null===u.actions[t]?ctx.fillText("--",80,350+30*t):ctx.fillText(u.actions[t].name,80,350+30*t)}function s(){ctx.fillStyle="#000",ctx.fillText(f.img,f.x,f.y)}let a,r,l,c,p,h,u,y,f={img:">>"};return{then:function(t){this.privates.callback=t},init:function(){a=this,f.x=43,f.y=350,f.curSlot=0,r={x:30,dir:Dir.RIGHT},p={x:0,y:0},l=!1,c=60,h={name:"EMPTY",atk:0},u=this.privates.dormantL,y=this.privates.dormantR},update:function(){l&&(y.hp-=h.atk/60),game.graphics.isAnimating||t(u,y)&&(h.name===FightAction.TACKLE.name?e():h.name===FightAction.DRAGONS_BREATH.name&&(l=!0)),y.hp<=0&&(u.xp+=25,this.privates.callback())},render:function(){if(ctx.fillStyle=this.privates.bgColor,ctx.fillRect(0,0,canvas.width,canvas.height),i(u,10,15,!0),u.draw(r.x,90),n(),i(y,canvas.width-130,15,!1),y.draw(770,90),l){let t=c%40;t>=0&&t<10?p.x=0:t>=10&&t<20?p.x=5:t>=20&&t<30?p.x=0:t>=30&&t<40&&(p.x=-5),ctx.fillStyle="red",ctx.fillRect(870+p.x,242,40,12),ctx.fillRect(880+p.x,230,30,12),ctx.fillRect(880+p.x,218,20,12),0==c--&&(l=!1,c=60)}}}}(),Dormant.prototype={draw:function(t,e){this.imgReady&&ctx.drawImage(this.img,t,e,this.img.width,this.img.height)}};var FightAction=Object.freeze({TACKLE:{name:"TACKLE",multiplier:1},HEAL:{name:"HEAL",multiplier:1},DRAGONS_BREATH:{name:"DRAGONS BREATH",multiplier:5}});!function(){window.game=new GameEngine,game.start();let t=1,e=new TitleView("Dormanticide");e.then(()=>{game.utils.switchView(i)});let i=new OverworldView;i.then(()=>{1===t?game.utils.switchView(r):game.utils.switchView(l)});let n=[FightAction.TACKLE,FightAction.DRAGONS_BREATH,null,null],o=new Dormant("malaise.png","MALAISE",12,8,27,n),s=new Dormant("erabor.png","ERABOR",8,12,23,n),a=new Dormant("tildamesh.png","TILDAMESH",8,12,23,n),r=new BattleView("#ddd",o,s);r.then(()=>{++t,game.utils.switchView(i)});let l=new BattleView("#ddd",o,a);l.then(()=>{game.utils.switchView(i)}),game.view=e}();