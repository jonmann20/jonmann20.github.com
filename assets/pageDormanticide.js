"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function GameEngine(){var t=document.createElement("a");t.href="/#games",t.innerText="Back",t.className="btnBack",document.body.appendChild(t);var e=document.createElement("div");e.className="canvasWrap",window.canvas=document.createElement("canvas"),canvas.setAttribute("width",1008),canvas.setAttribute("height",567),e.appendChild(canvas),document.body.appendChild(e),window.ctx=canvas.getContext("2d"),this.input=new GameInput(this),this.graphics=new GameGraphics(this),this.utils=new GameUtils(this),this.view=new GameView(this),this.init()}function GameInput(){this.keysDown={},this.lastKeyUp=KeyCode.EMPTY,this.lastKeyDown=KeyCode.EMPTY,this.init()}function GameUtils(t){return{switchView:function(e){e.init(),t.view=e}}}function GameView(t){this.privates={bgColor:"#ccc"},this.init()}function TitleView(t){this.privates={title:t},this.init()}function GameSaveView(){this.privates={},this.init()}function OverworldView(){this.privates={},this.init()}function BattleView(t,e,i){this.privates={bgColor:t,dormantL:e,dormantR:i},this.init()}function Dormant(t,e,i,n,o,a,r){var s=this;this.img=new Image,this.imgReady=!1,this.img.onload=function(){s.imgReady=!0},this.img.src="img/"+t,this.name=e,this.atk=i,this.def=n,this.initHP=this.hp=o,this.actions=a,this.lvl="undefined"!=typeof r?r:1,this.xp=0,this.xpNeeded=50}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};GameEngine.prototype=function(){function t(){i.view.update(),a&&i.onUpdate()}function e(){o=requestAnimationFrame(e),i.view.render(),r&&i.onRender()}var i=void 0,n=void 0,o=void 0,a=!1,r=!1;return{init:function(){i=this},onUpdate:function(t){a=!0,this.onUpdate=t},onRender:function(t){r=!0,this.onRender=t},start:function(){n=setInterval(t,1e3/60),o=requestAnimationFrame(e)},stop:function(){clearInterval(n),cancelAnimationFrame(o)}}}();var GameSave=function(){function t(){_classCallCheck(this,t)}return t.prototype.load=function(t){return localStorage["slot "+t]},t.prototype.getList=function(){var t=this.load(0),e=this.load(1),i=this.load(2),n="---";return["undefined"!=typeof t?t:n,"undefined"!=typeof e?e:n,"undefined"!=typeof i?i:n]},t.prototype.save=function(t,e){localStorage["slot "+t]=e},t.prototype.erase=function(t){return localStorage.removeItem("slot "+t),this.getList()},t}();GameInput.prototype=function(){function t(t){return t===KeyCode.W?t=KeyCode.UP:t===KeyCode.S?t=KeyCode.DOWN:t===KeyCode.D?t=KeyCode.RIGHT:t===KeyCode.A&&(t=KeyCode.LEFT),t}var e=void 0;return addEventListener("keydown",function(i){var n=t(i.keyCode);e.keysDown[n]||(e.lastKeyDown=n,e.keysDown[n]=!0)}),addEventListener("keyup",function(i){e.lastKeyUp=t(i.keyCode),delete e.keysDown[e.lastKeyUp]}),{init:function(){e=this},update:function(){}}}();var KeyCode=Object.freeze({EMPTY:-1,ENTER:13,CTRL:17,ESC:27,SPACEBAR:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,A:65,D:68,F:70,H:72,J:74,K:75,M:77,O:79,R:82,S:83,W:87}),KeyCodeNames={};KeyCodeNames[-1]="EMPTY",KeyCodeNames[13]="ENTER",KeyCodeNames[17]="CTRL",KeyCodeNames[27]="ESC",KeyCodeNames[32]="SPACEBAR",KeyCodeNames[37]="LEFT",KeyCodeNames[38]="UP",KeyCodeNames[39]="RIGHT",KeyCodeNames[40]="DOWN",KeyCodeNames[46]="DELETE",KeyCodeNames[65]="A",KeyCodeNames[68]="D",KeyCodeNames[70]="F",KeyCodeNames[72]="H",KeyCodeNames[74]="J",KeyCodeNames[75]="K",KeyCodeNames[77]="M",KeyCodeNames[79]="O",KeyCodeNames[82]="R",KeyCodeNames[83]="S",KeyCodeNames[87]="W";var Dir=Object.freeze({RIGHT:0,LEFT:1});!function(t,e){"function"==typeof define&&define.amd?define(e):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=e():t.SAT=e()}(this,function(){function t(t,e){this.x=t||0,this.y=e||0}function e(e,i){this.pos=e||new t,this.r=i||0}function i(e,i){this.pos=e||new t,this.points=i||[],this.recalc()}function n(e,i,n){this.pos=e||new t,this.w=i||0,this.h=n||0}function o(){this.a=null,this.b=null,this.overlapN=new t,this.overlapV=new t,this.clear()}function a(t,e,i){for(var n=Number.MAX_VALUE,o=-Number.MAX_VALUE,a=t.length,r=0;r<a;r++){var s=t[r].dot(e);s<n&&(n=s),s>o&&(o=s)}i[0]=n,i[1]=o}function r(t,e,i,n,o,r){var s=d.pop(),l=d.pop(),c=y.pop().copy(e).sub(t),p=c.dot(o);if(a(i,o,s),a(n,o,l),l[0]+=p,l[1]+=p,s[0]>l[1]||l[0]>s[1])return y.push(c),d.push(s),d.push(l),!0;if(r){var h=0;if(s[0]<l[0])if(r.aInB=!1,s[1]<l[1])h=s[1]-l[0],r.bInA=!1;else{var u=s[1]-l[0],f=l[1]-s[0];h=u<f?u:-f}else if(r.bInA=!1,s[1]>l[1])h=s[0]-l[1],r.aInB=!1;else{var u=s[1]-l[0],f=l[1]-s[0];h=u<f?u:-f}var v=Math.abs(h);v<r.overlap&&(r.overlap=v,r.overlapN.copy(o),h<0&&r.overlapN.reverse())}return y.push(c),d.push(s),d.push(l),!1}function s(t,e){var i=t.len2(),n=e.dot(t);return n<0?v:n>i?x:m}function l(t,e,i){var n=y.pop().copy(e.pos).sub(t.pos),o=t.r+e.r,a=o*o,r=n.len2();if(r>a)return y.push(n),!1;if(i){var s=Math.sqrt(r);i.a=t,i.b=e,i.overlap=o-s,i.overlapN.copy(n.normalize()),i.overlapV.copy(n).scale(i.overlap),i.aInB=t.r<=e.r&&s<=e.r-t.r,i.bInA=e.r<=t.r&&s<=t.r-e.r}return y.push(n),!0}function c(t,e,i){for(var n=y.pop().copy(e.pos).sub(t.pos),o=e.r,a=o*o,r=t.points,l=r.length,c=y.pop(),p=y.pop(),h=0;h<l;h++){var u=h===l-1?0:h+1,f=0===h?l-1:h-1,d=0,m=null;c.copy(t.edges[h]),p.copy(n).sub(r[h]),i&&p.len2()>a&&(i.aInB=!1);var w=s(c,p);if(w===v){c.copy(t.edges[f]);var g=y.pop().copy(n).sub(r[f]);if(w=s(c,g),w===x){var K=p.len();if(K>o)return y.push(n),y.push(c),y.push(p),y.push(g),!1;i&&(i.bInA=!1,m=p.normalize(),d=o-K)}y.push(g)}else if(w===x){if(c.copy(t.edges[u]),p.copy(n).sub(r[u]),w=s(c,p),w===v){var K=p.len();if(K>o)return y.push(n),y.push(c),y.push(p),!1;i&&(i.bInA=!1,m=p.normalize(),d=o-K)}}else{var C=c.perp().normalize(),K=p.dot(C),T=Math.abs(K);if(K>0&&T>o)return y.push(n),y.push(C),y.push(p),!1;i&&(m=C,d=o-K,(K>=0||d<2*o)&&(i.bInA=!1))}m&&i&&Math.abs(d)<Math.abs(i.overlap)&&(i.overlap=d,i.overlapN.copy(m))}return i&&(i.a=t,i.b=e,i.overlapV.copy(i.overlapN).scale(i.overlap)),y.push(n),y.push(c),y.push(p),!0}function p(t,e,i){var n=c(e,t,i);if(n&&i){var o=i.a,a=i.aInB;i.overlapN.reverse(),i.overlapV.reverse(),i.a=i.b,i.b=o,i.aInB=i.bInA,i.bInA=a}return n}function h(t,e,i){for(var n=t.points,o=n.length,a=e.points,s=a.length,l=0;l<o;l++)if(r(t.pos,e.pos,n,a,t.normals[l],i))return!1;for(var l=0;l<s;l++)if(r(t.pos,e.pos,n,a,e.normals[l],i))return!1;return i&&(i.a=t,i.b=e,i.overlapV.copy(i.overlapN).scale(i.overlap)),!0}var u={};u.Vector=t,u.V=t,t.prototype.copy=t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.perp=t.prototype.perp=function(){var t=this.x;return this.x=this.y,this.y=-t,this},t.prototype.rotate=t.prototype.rotate=function(t){var e=this.x,i=this.y;return this.x=e*Math.cos(t)-i*Math.sin(t),this.y=e*Math.sin(t)+i*Math.cos(t),this},t.prototype.reverse=t.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this},t.prototype.normalize=t.prototype.normalize=function(){var t=this.len();return t>0&&(this.x=this.x/t,this.y=this.y/t),this},t.prototype.add=t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.sub=t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.scale=t.prototype.scale=function(t,e){return this.x*=t,this.y*=e||t,this},t.prototype.project=t.prototype.project=function(t){var e=this.dot(t)/t.len2();return this.x=e*t.x,this.y=e*t.y,this},t.prototype.projectN=t.prototype.projectN=function(t){var e=this.dot(t);return this.x=e*t.x,this.y=e*t.y,this},t.prototype.reflect=t.prototype.reflect=function(t){var e=this.x,i=this.y;return this.project(t).scale(2),this.x-=e,this.y-=i,this},t.prototype.reflectN=t.prototype.reflectN=function(t){var e=this.x,i=this.y;return this.projectN(t).scale(2),this.x-=e,this.y-=i,this},t.prototype.dot=t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.len2=t.prototype.len2=function(){return this.dot(this)},t.prototype.len=t.prototype.len=function(){return Math.sqrt(this.len2())},u.Circle=e,u.Polygon=i,i.prototype.recalc=i.prototype.recalc=function(){this.edges=[],this.normals=[];for(var e=this.points,i=e.length,n=0;n<i;n++){var o=e[n],a=n<i-1?e[n+1]:e[0],r=(new t).copy(a).sub(o),s=(new t).copy(r).perp().normalize();this.edges.push(r),this.normals.push(s)}return this},i.prototype.rotate=i.prototype.rotate=function(t){var e,i=this.points,n=this.edges,o=this.normals,a=i.length;for(e=0;e<a;e++)i[e].rotate(t),n[e].rotate(t),o[e].rotate(t);return this},i.prototype.translate=i.prototype.translate=function(t,e){var i,n=this.points,o=n.length;for(i=0;i<o;i++)n[i].x+=t,n[i].y+=e;return this},u.Box=n,n.prototype.toPolygon=n.prototype.toPolygon=function(){var e=this.pos,n=this.w,o=this.h;return new i(new t(e.x,e.y),[new t,new t(n,0),new t(n,o),new t(0,o)])},u.Response=o,o.prototype.clear=o.prototype.clear=function(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this};for(var y=[],f=0;f<10;f++)y.push(new t);for(var d=[],f=0;f<5;f++)d.push([]);var v=-1,m=0,x=1;return u.testCircleCircle=l,u.testPolygonCircle=c,u.testCirclePolygon=p,u.testPolygonPolygon=h,u});var GameGraphics=function(t){return{isAnimating:!1,repeatAction:function(t,e,i){this.isAnimating=!0;var n=0,o=this,a=setInterval(function(){n++>e?(clearInterval(a),o.isAnimating=!1):i()},t)}}};GameView.prototype=function(){return{then:function(t){this.privates.callback=t},init:function(){},update:function(){},render:function(){ctx.fillStyle=this.privates.bgColor,ctx.fillRect(0,0,canvas.width,canvas.height)}}}(),TitleView.prototype=function(){var t=void 0,e="Press Enter";return{then:function(t){this.privates.callback=t},init:function(){t=this.privates.title},update:function(){game.input.lastKeyDown===KeyCode.ENTER&&(game.input.lastKeyDown=KeyCode.EMPTY,this.privates.callback())},render:function(){ctx.fillStyle="#000",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.font="36px Arial",ctx.fillStyle="#fff",ctx.fillText(t,canvas.width/2-ctx.measureText(t).width/2,100),ctx.font="24px Arial",ctx.fillText(e,canvas.width/2-ctx.measureText(e).width/2,canvas.height/2)}}}(),GameSaveView.prototype=function(){var t,e,i="Select a save slot",n=new GameSave,o=n.getList();return{then:function(t){this.privates.callback=t},init:function(){t=this,e={img:">>",slot:0,x:canvas.width/2-ctx.measureText(o[0]).width/2-60,y:200}},update:function(){if(game.input.lastKeyDown===KeyCode.ESC)game.input.lastKeyDown=KeyCode.EMPTY,this.privates.callback(KeyCode.ESC);else if(game.input.lastKeyDown===KeyCode.ENTER){game.input.lastKeyDown=KeyCode.EMPTY;var t=new Date,i=t.getMonth(),a=t.getDay(),r=t.getYear(),s=t.toLocaleTimeString();n.save(e.slot,i+"/"+a+"/"+r+" "+s),this.privates.callback(KeyCode.ENTER)}else game.input.lastKeyDown===KeyCode.DELETE?(game.input.lastKeyDownp=KeyCode.EMPTY,o=n.erase(e.slot)):2!==e.slot&&game.input.lastKeyDown===KeyCode.DOWN?(game.input.lastKeyDown=KeyCode.EMPTY,++e.slot,e.x=canvas.width/2-ctx.measureText(o[e.slot]).width/2-60,e.y+=80):0!==e.slot&&game.input.lastKeyDown===KeyCode.UP&&(game.input.lastKeyDown=KeyCode.EMPTY,--e.slot,e.x=canvas.width/2-ctx.measureText(o[e.slot]).width/2-60,e.y-=80)},render:function(){ctx.fillStyle="#111",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.font="36px Arial",ctx.fillStyle="#fff",ctx.fillText(i,canvas.width/2-ctx.measureText(i).width/2,80),ctx.font="24px Arial";for(var t=0;t<o.length;++t)ctx.fillText(o[t],canvas.width/2-ctx.measureText(o[t]).width/2,200+80*t);ctx.fillText(e.img,e.x,e.y)}}}(),OverworldView.prototype=function(){var t={img:"^^"};return{then:function(t){this.privates.callback=t},init:function(){t.x=90,t.y=canvas.height/2+70,t.slot=0},update:function(){game.input.lastKeyDown===KeyCode.ENTER?(game.input.lastKeyDown=KeyCode.EMPTY,this.privates.callback()):game.input.lastKeyDown===KeyCode.RIGHT?(game.input.lastKeyDown=KeyCode.EMPTY,t.slot<7&&(t.x+=115,++t.slot)):game.input.lastKeyDown===KeyCode.LEFT&&(game.input.lastKeyDown=KeyCode.EMPTY,t.slot>0&&(t.x-=115,--t.slot))},render:function(){ctx.fillStyle="#34282c",ctx.fillRect(0,0,canvas.width,canvas.height);for(var e,i,n=80,o=0;o<8;++o)e=60+115*o,i=canvas.height/2-n/2,ctx.fillStyle="#fff",ctx.font="18px Arial",ctx.fillText("Level "+(o+1),e+10,i-13),ctx.fillStyle="red",ctx.fillRect(e,i,n,n);ctx.fillStyle="#fff",ctx.fillText(t.img,t.x,t.y)}}}(),BattleView.prototype=function(){function t(t,e){switch(game.input.lastKeyDown){case KeyCode.ENTER:return game.input.lastKeyDown=KeyCode.EMPTY,u.name=t.actions[s.curSlot].name,u.atk=t.atk*t.actions[s.curSlot].multiplier/e.def,!0;case KeyCode.UP:game.input.lastKeyDown=KeyCode.EMPTY,0!==s.curSlot&&null!==t.actions[s.curSlot-1]&&(--s.curSlot,s.y-=30);break;case KeyCode.DOWN:game.input.lastKeyDown=KeyCode.EMPTY,3!==s.curSlot&&null!==t.actions[s.curSlot+1]&&(++s.curSlot,s.y+=30)}}function e(){l.dir=Dir.RIGHT,game.graphics.repeatAction(6,60,function(){l.dir===Dir.RIGHT&&l.x>60&&(l.dir=Dir.LEFT),l.dir===Dir.RIGHT?++l.x:--l.x,f.hp-=u.atk/60})}function i(t,e,i,n){var o=t.name+" L"+t.lvl;ctx.fillStyle="#000",ctx.fillText(o,e+ctx.measureText(o).width/2,i),ctx.fillText("HP",e,i+20),ctx.strokeStyle="#000",ctx.strokeRect(e+21,i+12,100,10),ctx.fillStyle="red",ctx.fillRect(e+22,i+13,t.hp*(100/t.initHP)-1,8),n&&(ctx.fillStyle="#000",ctx.fillText("XP",e,i+40),ctx.strokeStyle="#000",ctx.strokeRect(e+21,i+32,100,10),ctx.fillStyle="#777",ctx.fillRect(e+22,i+33,t.xp*(100/t.xpNeeded)-1,8))}function n(){ctx.strokeStyle="#000",ctx.strokeRect(20,300,500,250),ctx.font="12px Arial",ctx.fillStyle="#000",ctx.fillText("ATK: "+y.atk,460,320),ctx.fillText("DEF: "+y.def,460,340),o(),a()}function o(){ctx.fillStyle="#000";for(var t=0;t<4;++t)null===y.actions[t]?ctx.fillText("--",80,350+30*t):ctx.fillText(y.actions[t].name,80,350+30*t)}function a(){ctx.fillStyle="#000",ctx.fillText(s.img,s.x,s.y)}var r=void 0,s={img:">>"},l=void 0,c=void 0,p=void 0,h=void 0,u=void 0,y=void 0,f=void 0;return{then:function(t){this.privates.callback=t},init:function(){r=this,s.x=43,s.y=350,s.curSlot=0,l={x:30,dir:Dir.RIGHT},h={x:0,y:0},c=!1,p=60,u={name:"EMPTY",atk:0},y=this.privates.dormantL,f=this.privates.dormantR},update:function(){if(c&&(f.hp-=u.atk/60),!game.graphics.isAnimating){var i=t(y,f);i&&(u.name===FightAction.TACKLE.name?e():u.name===FightAction.DRAGONS_BREATH.name&&(c=!0))}f.hp<=0&&(y.xp+=25,this.privates.callback())},render:function(){if(ctx.fillStyle=this.privates.bgColor,ctx.fillRect(0,0,canvas.width,canvas.height),i(y,10,15,!0),y.draw(l.x,90),n(),i(f,canvas.width-130,15,!1),f.draw(770,90),c){var t=p%40;t>=0&&t<10?h.x=0:t>=10&&t<20?h.x=5:t>=20&&t<30?h.x=0:t>=30&&t<40&&(h.x=-5),ctx.fillStyle="red",ctx.fillRect(870+h.x,242,40,12),ctx.fillRect(880+h.x,230,30,12),ctx.fillRect(880+h.x,218,20,12),0===p--&&(c=!1,p=60)}}}}(),Dormant.prototype=function(){return{draw:function(t,e){this.imgReady&&ctx.drawImage(this.img,t,e,this.img.width,this.img.height)}}}();var FightAction=Object.freeze({TACKLE:{name:"TACKLE",multiplier:1},HEAL:{name:"HEAL",multiplier:1},DRAGONS_BREATH:{name:"DRAGONS BREATH",multiplier:5}});!function(){window.game=new GameEngine,game.start();var t=1,e=new TitleView("Dormanticide");e.then(function(){game.utils.switchView(i)});var i=new OverworldView;i.then(function(){1===t?game.utils.switchView(s):game.utils.switchView(l)});var n=[FightAction.TACKLE,FightAction.DRAGONS_BREATH,null,null],o=new Dormant("malaise.png","MALAISE",12,8,27,n),a=new Dormant("erabor.png","ERABOR",8,12,23,n),r=new Dormant("tildamesh.png","TILDAMESH",8,12,23,n),s=new BattleView("#ddd",o,a);s.then(function(){++t,game.utils.switchView(i)});var l=new BattleView("#ddd",o,r);l.then(function(){game.utils.switchView(i)}),game.view=e}();