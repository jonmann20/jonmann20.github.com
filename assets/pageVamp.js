"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function GameEngine(){var t=document.createElement("a");t.href="/#games",t.innerText="Back",t.className="btnBack",document.body.appendChild(t);var e=document.createElement("div");e.className="canvasWrap",window.canvas=document.createElement("canvas"),canvas.setAttribute("width",1008),canvas.setAttribute("height",567),e.appendChild(canvas),document.body.appendChild(e),window.ctx=canvas.getContext("2d"),this.input=new GameInput(this),this.graphics=new GameGraphics(this),this.utils=new GameUtils(this),this.view=new GameView(this),this.init()}function GameInput(){this.keysDown={},this.lastKeyUp=KeyCode.EMPTY,this.lastKeyDown=KeyCode.EMPTY,this.init()}function GameUtils(t){return{switchView:function(e){e.init(),t.view=e}}}function GameView(t){this.privates={bgColor:"#ccc"},this.init()}function TitleView(t){this.privates={title:t},this.init()}function GameSaveView(){this.privates={},this.init()}function LevelView(t,e){this.privates={},this.player=t,this.curLvl=e,this.init()}function Level1(){this.init()}function Vamp(){this.init()}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};GameEngine.prototype=function(){function t(){n.view.update(),r&&n.onUpdate()}function e(){o=requestAnimationFrame(e),n.view.render(),s&&n.onRender()}var n=void 0,i=void 0,o=void 0,r=!1,s=!1;return{init:function(){n=this},onUpdate:function(t){r=!0,this.onUpdate=t},onRender:function(t){s=!0,this.onRender=t},start:function(){i=setInterval(t,1e3/60),o=requestAnimationFrame(e)},stop:function(){clearInterval(i),cancelAnimationFrame(o)}}}();var GameSave=function(){function t(){_classCallCheck(this,t)}return t.prototype.load=function(t){return localStorage["slot "+t]},t.prototype.getList=function(){var t=this.load(0),e=this.load(1),n=this.load(2);return[void 0!==t?t:"---",void 0!==e?e:"---",void 0!==n?n:"---"]},t.prototype.save=function(t,e){localStorage["slot "+t]=e},t.prototype.erase=function(t){return localStorage.removeItem("slot "+t),this.getList()},t}();GameInput.prototype=function(){function t(t){return t===KeyCode.W?t=KeyCode.UP:t===KeyCode.S?t=KeyCode.DOWN:t===KeyCode.D?t=KeyCode.RIGHT:t===KeyCode.A&&(t=KeyCode.LEFT),t}var e=void 0;return addEventListener("keydown",function(n){var i=t(n.keyCode);e.keysDown[i]||(e.lastKeyDown=i,e.keysDown[i]=!0)}),addEventListener("keyup",function(n){e.lastKeyUp=t(n.keyCode),delete e.keysDown[e.lastKeyUp]}),{init:function(){e=this},update:function(){}}}();var KeyCode=Object.freeze({EMPTY:-1,ENTER:13,CTRL:17,ESC:27,SPACEBAR:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,A:65,D:68,F:70,H:72,J:74,K:75,M:77,O:79,R:82,S:83,W:87}),KeyCodeNames={};KeyCodeNames[-1]="EMPTY",KeyCodeNames[13]="ENTER",KeyCodeNames[17]="CTRL",KeyCodeNames[27]="ESC",KeyCodeNames[32]="SPACEBAR",KeyCodeNames[37]="LEFT",KeyCodeNames[38]="UP",KeyCodeNames[39]="RIGHT",KeyCodeNames[40]="DOWN",KeyCodeNames[46]="DELETE",KeyCodeNames[65]="A",KeyCodeNames[68]="D",KeyCodeNames[70]="F",KeyCodeNames[72]="H",KeyCodeNames[74]="J",KeyCodeNames[75]="K",KeyCodeNames[77]="M",KeyCodeNames[79]="O",KeyCodeNames[82]="R",KeyCodeNames[83]="S",KeyCodeNames[87]="W";var Dir=Object.freeze({RIGHT:0,LEFT:1});!function(t,e){"function"==typeof define&&define.amd?define(e):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=e():t.SAT=e()}(this,function(){function t(t,e){this.x=t||0,this.y=e||0}function e(e,n){this.pos=e||new t,this.r=n||0}function n(e,n){this.pos=e||new t,this.points=n||[],this.recalc()}function i(e,n,i){this.pos=e||new t,this.w=n||0,this.h=i||0}function o(){this.a=null,this.b=null,this.overlapN=new t,this.overlapV=new t,this.clear()}function r(t,e,n){for(var i=Number.MAX_VALUE,o=-Number.MAX_VALUE,r=t.length,s=0;s<r;s++){var a=t[s].dot(e);a<i&&(i=a),a>o&&(o=a)}n[0]=i,n[1]=o}function s(t,e,n,i,o,s){var a=d.pop(),p=d.pop(),c=y.pop().copy(e).sub(t),l=c.dot(o);if(r(n,o,a),r(i,o,p),p[0]+=l,p[1]+=l,a[0]>p[1]||p[0]>a[1])return y.push(c),d.push(a),d.push(p),!0;if(s){var h=0;if(a[0]<p[0])s.aInB=!1,a[1]<p[1]?(h=a[1]-p[0],s.bInA=!1):h=(u=a[1]-p[0])<(f=p[1]-a[0])?u:-f;else if(s.bInA=!1,a[1]>p[1])h=a[0]-p[1],s.aInB=!1;else{var u=a[1]-p[0],f=p[1]-a[0];h=u<f?u:-f}var v=Math.abs(h);v<s.overlap&&(s.overlap=v,s.overlapN.copy(o),h<0&&s.overlapN.reverse())}return y.push(c),d.push(a),d.push(p),!1}function a(t,e){var n=t.len2(),i=e.dot(t);return i<0?v:i>n?w:m}function p(t,e,n){var i=y.pop().copy(e.pos).sub(t.pos),o=t.r+e.r,r=o*o,s=i.len2();if(s>r)return y.push(i),!1;if(n){var a=Math.sqrt(s);n.a=t,n.b=e,n.overlap=o-a,n.overlapN.copy(i.normalize()),n.overlapV.copy(i).scale(n.overlap),n.aInB=t.r<=e.r&&a<=e.r-t.r,n.bInA=e.r<=t.r&&a<=t.r-e.r}return y.push(i),!0}function c(t,e,n){for(var i=y.pop().copy(e.pos).sub(t.pos),o=e.r,r=o*o,s=t.points,p=s.length,c=y.pop(),l=y.pop(),h=0;h<p;h++){var u=h===p-1?0:h+1,f=0===h?p-1:h-1,d=0,m=null;c.copy(t.edges[h]),l.copy(i).sub(s[h]),n&&l.len2()>r&&(n.aInB=!1);var x=a(c,l);if(x===v){c.copy(t.edges[f]);var g=y.pop().copy(i).sub(s[f]);if((x=a(c,g))===w){if((K=l.len())>o)return y.push(i),y.push(c),y.push(l),y.push(g),!1;n&&(n.bInA=!1,m=l.normalize(),d=o-K)}y.push(g)}else if(x===w){if(c.copy(t.edges[u]),l.copy(i).sub(s[u]),(x=a(c,l))===v){if((K=l.len())>o)return y.push(i),y.push(c),y.push(l),!1;n&&(n.bInA=!1,m=l.normalize(),d=o-K)}}else{var C=c.perp().normalize(),K=l.dot(C),b=Math.abs(K);if(K>0&&b>o)return y.push(i),y.push(C),y.push(l),!1;n&&(m=C,d=o-K,(K>=0||d<2*o)&&(n.bInA=!1))}m&&n&&Math.abs(d)<Math.abs(n.overlap)&&(n.overlap=d,n.overlapN.copy(m))}return n&&(n.a=t,n.b=e,n.overlapV.copy(n.overlapN).scale(n.overlap)),y.push(i),y.push(c),y.push(l),!0}function l(t,e,n){var i=c(e,t,n);if(i&&n){var o=n.a,r=n.aInB;n.overlapN.reverse(),n.overlapV.reverse(),n.a=n.b,n.b=o,n.aInB=n.bInA,n.bInA=r}return i}function h(t,e,n){for(var i=t.points,o=i.length,r=e.points,a=r.length,p=0;p<o;p++)if(s(t.pos,e.pos,i,r,t.normals[p],n))return!1;for(p=0;p<a;p++)if(s(t.pos,e.pos,i,r,e.normals[p],n))return!1;return n&&(n.a=t,n.b=e,n.overlapV.copy(n.overlapN).scale(n.overlap)),!0}var u={};u.Vector=t,u.V=t,t.prototype.copy=t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.perp=t.prototype.perp=function(){var t=this.x;return this.x=this.y,this.y=-t,this},t.prototype.rotate=t.prototype.rotate=function(t){var e=this.x,n=this.y;return this.x=e*Math.cos(t)-n*Math.sin(t),this.y=e*Math.sin(t)+n*Math.cos(t),this},t.prototype.reverse=t.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this},t.prototype.normalize=t.prototype.normalize=function(){var t=this.len();return t>0&&(this.x=this.x/t,this.y=this.y/t),this},t.prototype.add=t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.sub=t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.scale=t.prototype.scale=function(t,e){return this.x*=t,this.y*=e||t,this},t.prototype.project=t.prototype.project=function(t){var e=this.dot(t)/t.len2();return this.x=e*t.x,this.y=e*t.y,this},t.prototype.projectN=t.prototype.projectN=function(t){var e=this.dot(t);return this.x=e*t.x,this.y=e*t.y,this},t.prototype.reflect=t.prototype.reflect=function(t){var e=this.x,n=this.y;return this.project(t).scale(2),this.x-=e,this.y-=n,this},t.prototype.reflectN=t.prototype.reflectN=function(t){var e=this.x,n=this.y;return this.projectN(t).scale(2),this.x-=e,this.y-=n,this},t.prototype.dot=t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.len2=t.prototype.len2=function(){return this.dot(this)},t.prototype.len=t.prototype.len=function(){return Math.sqrt(this.len2())},u.Circle=e,u.Polygon=n,n.prototype.recalc=n.prototype.recalc=function(){this.edges=[],this.normals=[];for(var e=this.points,n=e.length,i=0;i<n;i++){var o=e[i],r=i<n-1?e[i+1]:e[0],s=(new t).copy(r).sub(o),a=(new t).copy(s).perp().normalize();this.edges.push(s),this.normals.push(a)}return this},n.prototype.rotate=n.prototype.rotate=function(t){var e,n=this.points,i=this.edges,o=this.normals,r=n.length;for(e=0;e<r;e++)n[e].rotate(t),i[e].rotate(t),o[e].rotate(t);return this},n.prototype.translate=n.prototype.translate=function(t,e){var n,i=this.points,o=i.length;for(n=0;n<o;n++)i[n].x+=t,i[n].y+=e;return this},u.Box=i,i.prototype.toPolygon=i.prototype.toPolygon=function(){var e=this.pos,i=this.w,o=this.h;return new n(new t(e.x,e.y),[new t,new t(i,0),new t(i,o),new t(0,o)])},u.Response=o,o.prototype.clear=o.prototype.clear=function(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this};for(var y=[],f=0;f<10;f++)y.push(new t);for(var d=[],f=0;f<5;f++)d.push([]);var v=-1,m=0,w=1;return u.testCircleCircle=p,u.testPolygonCircle=c,u.testCirclePolygon=l,u.testPolygonPolygon=h,u});var GameGraphics=function(t){return{isAnimating:!1,repeatAction:function(t,e,n){this.isAnimating=!0;var i=0,o=this,r=setInterval(function(){i++>e?(clearInterval(r),o.isAnimating=!1):n()},t)}}};GameView.prototype=function(){return{then:function(t){this.privates.callback=t},init:function(){},update:function(){},render:function(){ctx.fillStyle=this.privates.bgColor,ctx.fillRect(0,0,canvas.width,canvas.height)}}}(),TitleView.prototype=function(){var t=void 0,e="Press Enter";return{then:function(t){this.privates.callback=t},init:function(){t=this.privates.title},update:function(){game.input.lastKeyDown===KeyCode.ENTER&&(game.input.lastKeyDown=KeyCode.EMPTY,this.privates.callback())},render:function(){ctx.fillStyle="#000",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.font="36px Arial",ctx.fillStyle="#fff",ctx.fillText(t,canvas.width/2-ctx.measureText(t).width/2,100),ctx.font="24px Arial",ctx.fillText(e,canvas.width/2-ctx.measureText(e).width/2,canvas.height/2)}}}(),GameSaveView.prototype=function(){var t,e,n="Select a save slot",i=new GameSave,o=i.getList();return{then:function(t){this.privates.callback=t},init:function(){t=this,e={img:">>",slot:0,x:canvas.width/2-ctx.measureText(o[0]).width/2-60,y:200}},update:function(){if(game.input.lastKeyDown===KeyCode.ESC)game.input.lastKeyDown=KeyCode.EMPTY,this.privates.callback(KeyCode.ESC);else if(game.input.lastKeyDown===KeyCode.ENTER){game.input.lastKeyDown=KeyCode.EMPTY;var t=new Date,n=t.getMonth(),r=t.getDay(),s=t.getYear(),a=t.toLocaleTimeString();i.save(e.slot,n+"/"+r+"/"+s+" "+a),this.privates.callback(KeyCode.ENTER)}else game.input.lastKeyDown===KeyCode.DELETE?(game.input.lastKeyDownp=KeyCode.EMPTY,o=i.erase(e.slot)):2!==e.slot&&game.input.lastKeyDown===KeyCode.DOWN?(game.input.lastKeyDown=KeyCode.EMPTY,++e.slot,e.x=canvas.width/2-ctx.measureText(o[e.slot]).width/2-60,e.y+=80):0!==e.slot&&game.input.lastKeyDown===KeyCode.UP&&(game.input.lastKeyDown=KeyCode.EMPTY,--e.slot,e.x=canvas.width/2-ctx.measureText(o[e.slot]).width/2-60,e.y-=80)},render:function(){ctx.fillStyle="#111",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.font="36px Arial",ctx.fillStyle="#fff",ctx.fillText(n,canvas.width/2-ctx.measureText(n).width/2,80),ctx.font="24px Arial";for(var t=0;t<o.length;++t)ctx.fillText(o[t],canvas.width/2-ctx.measureText(o[t]).width/2,200+80*t);ctx.fillText(e.img,e.x,e.y)}}}(),LevelView.prototype=function(){function t(){if(e.player.invincible)0==e.player.invincibleTimer--&&(e.player.invincible=!1,e.player.invincibleTimer=120);else for(var t=0;t<e.curLvl.projectiles.length;++t)if(SAT.testPolygonPolygon(e.player,e.curLvl.projectiles[t])){--e.player.hp,e.player.invincible=!0;break}}var e,n=!1,i=!1;return{then:function(t){this.privates.callback=t},init:function(){e=this},update:function(){this.curLvl.update(),this.player.update(),t()},onUpdate:function(t){n=!0,this.onUpdate=t},render:function(){this.curLvl.render(),this.player.render()},onRender:function(t){i=!0,this.onRender=t}}}(),Level1.prototype=function(){return{projectiles:[],init:function(){for(var t=0;t<10;++t){var e=new SAT.Box(new SAT.Vector(Math.floor(Math.random()*canvas.width+0),canvas.height),10,20).toPolygon();e.speed=.1*Math.floor(10*Math.random()+3),this.projectiles.push(e)}},update:function(){for(var t=0;t<this.projectiles.length;++t)this.projectiles[t].pos.y-=this.projectiles[t].speed},render:function(){ctx.fillStyle="#000",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.fillStyle="silver";for(var t=0;t<this.projectiles.length;++t)ctx.fillRect(this.projectiles[t].pos.x,this.projectiles[t].pos.y,10,20)}}}(),Vamp.prototype=function(){var t=new Image,e=!1;t.onload=function(){e=!0},t.src="img/vamp.png";return{w:40,h:40,hp:3,invincible:!1,invincibleTimer:120,init:function(){$.extend(this,new SAT.Box(new SAT.Vector(0,0),this.w,this.h).toPolygon())},update:function(){game.input.keysDown[KeyCode.RIGHT]?this.pos.x+=4:game.input.keysDown[KeyCode.LEFT]&&(this.pos.x-=4),game.input.keysDown[KeyCode.UP]?this.pos.y-=4:game.input.keysDown[KeyCode.DOWN]&&(this.pos.y+=4),this.hp<=0&&(alert("You died"),location.reload())},render:function(){var t=!0;if(this.invincible){var e=this.invincibleTimer%30;e>=0&&e<15&&(t=!1)}t&&(ctx.fillStyle="yellow",ctx.fillRect(this.pos.x,this.pos.y,this.w,this.h)),ctx.fillStyle="red";for(var n=0;n<this.hp;++n)ctx.fillRect(this.pos.x-10+20*n,this.pos.y-20,20,10)}}}(),function(){window.game=new GameEngine,game.start();var t=new TitleView("Vamp: The Great and Powerful",!0);t.then(function(){game.utils.switchView(e)});var e=new GameSaveView;e.then(function(e){e===KeyCode.ESC?game.utils.switchView(t):e===KeyCode.ENTER&&game.utils.switchView(n)});var n=new LevelView(new Vamp,new Level1);game.view=t}();