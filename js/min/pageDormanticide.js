function Input(){function a(a){return a===KeyCode.UP?a=KeyCode.W:a===KeyCode.DOWN&&(a=KeyCode.S),a}keysDown={},lastKeyUp=KeyCode.EMPTY,addEventListener("keydown",function(b){keysDown[a(b.keyCode)]=!0},!0),addEventListener("keyup",function(b){lastKeyUp=a(b.keyCode),delete keysDown[lastKeyUp]},!1)}function BattleView(a,b,c){this.bgColor=a,this.dormantL=b,this.dormantR=c}function Dormant(a,b,c,d,e,f,g){var h=this;this.img=new Image,this.imgReady=!1,this.img.onload=function(){h.imgReady=!0},this.img.src="img/"+a,this.name=b,this.atk=c,this.def=d,this.initHP=this.hp=e,this.actions=f,this.lvl="undefined"!=typeof g?g:1}!function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-43015655-1","jonmann20.github.io"),ga("send","pageview");var GameEngine=function(){function a(){view.update()}function b(){requestAnimationFrame(b),view.render()}canvas=document.getElementsByTagName("canvas")[0],ctx=canvas.getContext("2d"),input=new Input;var c=[FightAction.TACKLE,FightAction.DRAGONS_BREATH,null,null],d=new Dormant("malaise.png","MALAISE",12,8,27,c),e=new Dormant("erabor.png","ERABOR",8,12,23,c);return view=new BattleView("#ddd",d,e),{start:function(){setInterval(a,1e3/60),requestAnimationFrame(b)},stop:function(){}}},KeyCode=Object.freeze({ENTER:13,CTRL:17,UP:38,DOWN:40,A:65,D:68,F:70,H:72,J:74,K:75,M:77,O:79,R:82,S:83,W:87,EMPTY:-1,SPACEBAR:32}),Graphics=function(){return{repeatAction:function(a,b,c){var d=0,e=setInterval(function(){d++>b?clearInterval(e):c()},a)}}}();BattleView.prototype=function(){function a(a,b,c){ctx.fillStyle="#000",ctx.fillText(a.name+"  L"+a.lvl,b+40,c),ctx.fillText("HP",b,c+20),ctx.strokeStyle="#000",ctx.strokeRect(b+20,c+12,100,10),ctx.fillStyle="red",ctx.fillRect(b+21,c+13,a.hp*(100/a.initHP)-1,8)}function b(a){ctx.strokeStyle="#000",ctx.strokeRect(20,300,500,250),ctx.fillStyle="#000",ctx.fillText("ATK: "+a.atk,460,320),ctx.fillText("DEF: "+a.def,460,340)}function c(a){ctx.fillStyle="#000";for(var b=0;4>b;++b)null===a.actions[b]?ctx.fillText("--",80,350+30*b):ctx.fillText(a.actions[b].name,80,350+30*b)}function d(){ctx.fillStyle="#000",ctx.fillText(">>",e.x,e.y)}var e={x:43,y:350,curSlot:0},f=Object.freeze({RIGHT:0,LEFT:1}),g={x:30,dir:f.RIGHT};return{update:function(){switch(lastKeyUp){case KeyCode.ENTER:g.dir=f.RIGHT,Graphics.repeatAction(6,60,function(){g.dir===f.RIGHT&&g.x>60&&(g.dir=f.LEFT),g.dir===f.RIGHT?++g.x:--g.x}),this.dormantR.hp-=this.dormantL.atk*this.dormantL.actions[e.curSlot].multiplier/this.dormantR.def,lastKeyUp=KeyCode.EMPTY;break;case KeyCode.W:0!==e.curSlot&&null!==this.dormantL.actions[e.curSlot-1]&&(--e.curSlot,e.y-=30);break;case KeyCode.S:3!==e.curSlot&&null!==this.dormantL.actions[e.curSlot+1]&&(++e.curSlot,e.y+=30)}this.dormantR.hp<=0&&(alert("You Win"),location.reload())},render:function(){ctx.fillStyle=this.bgColor,ctx.fillRect(0,0,canvas.width,canvas.height),a(this.dormantL,10,15),this.dormantL.draw(g.x,90),b(this.dormantL),c(this.dormantL),d(),a(this.dormantR,canvas.width-130,15),this.dormantR.draw(770,90)}}}(),Dormant.prototype=function(){return{draw:function(a,b){this.imgReady&&ctx.drawImage(this.img,a,b,this.img.width,this.img.height)}}}();var FightAction=Object.freeze({TACKLE:{name:"TACKLE",multiplier:1},HEAL:{name:"HEAL",multiplier:1},DRAGONS_BREATH:{name:"DRAGONS_BREATH",multiplier:5}}),game=new GameEngine;game.start();