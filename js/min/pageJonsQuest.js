!function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-43015655-1","jonmann20.github.io"),ga("send","pageview"),function(a,b,c){function d(c,d,e){var f=b.createElement(c);return d&&(f.id=_+d),e&&(f.style.cssText=e),a(f)}function e(){return c.innerHeight?c.innerHeight:a(c).height()}function f(a){var b=y.length,c=(Q+a)%b;return 0>c?b+c:c}function g(a,b){return Math.round((/%/.test(a)?("x"===b?z.width():e())/100:1)*parseInt(a,10))}function h(a,b){return a.photo||a.photoRegex.test(b)}function i(a,b){return a.retinaUrl&&c.devicePixelRatio>1?b.replace(a.photoRegex,a.retinaSuffix):b}function j(a){"contains"in r[0]&&!r[0].contains(a.target)&&(a.stopPropagation(),r.focus())}function k(){var b,c=a.data(P,$);null==c?(K=a.extend({},Z),console&&console.log&&console.log("Error: cboxElement missing settings object")):K=a.extend({},c);for(b in K)a.isFunction(K[b])&&"on"!==b.slice(0,2)&&(K[b]=K[b].call(P));K.rel=K.rel||P.rel||a(P).data("rel")||"nofollow",K.href=K.href||a(P).attr("href"),K.title=K.title||P.title,"string"==typeof K.href&&(K.href=a.trim(K.href))}function l(c,d){a(b).trigger(c),hb.triggerHandler(c),a.isFunction(d)&&d.call(P)}function m(c){U||(P=c,k(),y=a(P),Q=0,"nofollow"!==K.rel&&(y=a("."+ab).filter(function(){var b,c=a.data(this,$);return c&&(b=a(this).data("rel")||c.rel||this.rel),b===K.rel}),Q=y.index(P),-1===Q&&(y=y.add(P),Q=y.length-1)),q.css({opacity:parseFloat(K.opacity),cursor:K.overlayClose?"pointer":"auto",visibility:"visible"}).show(),X&&r.add(q).removeClass(X),K.className&&r.add(q).addClass(K.className),X=K.className,K.closeButton?I.html(K.close).appendTo(t):I.appendTo("<div/>"),S||(S=T=!0,r.css({visibility:"hidden",display:"block"}),A=d(ib,"LoadedContent","width:0; height:0; overflow:hidden"),t.css({width:"",height:""}).append(A),L=u.height()+x.height()+t.outerHeight(!0)-t.height(),M=v.width()+w.width()+t.outerWidth(!0)-t.width(),N=A.outerHeight(!0),O=A.outerWidth(!0),K.w=g(K.initialWidth,"x"),K.h=g(K.initialHeight,"y"),A.css({width:"",height:K.h}),W.position(),l(bb,K.onOpen),J.add(D).hide(),r.focus(),K.trapFocus&&b.addEventListener&&(b.addEventListener("focus",j,!0),hb.one(fb,function(){b.removeEventListener("focus",j,!0)})),K.returnFocus&&hb.one(fb,function(){a(P).focus()})),p())}function n(){!r&&b.body&&(Y=!1,z=a(c),r=d(ib).attr({id:$,"class":a.support.opacity===!1?_+"IE":"",role:"dialog",tabindex:"-1"}).hide(),q=d(ib,"Overlay").hide(),C=a([d(ib,"LoadingOverlay")[0],d(ib,"LoadingGraphic")[0]]),s=d(ib,"Wrapper"),t=d(ib,"Content").append(D=d(ib,"Title"),E=d(ib,"Current"),H=a('<button type="button"/>').attr({id:_+"Previous"}),G=a('<button type="button"/>').attr({id:_+"Next"}),F=d("button","Slideshow"),C),I=a('<button type="button"/>').attr({id:_+"Close"}),s.append(d(ib).append(d(ib,"TopLeft"),u=d(ib,"TopCenter"),d(ib,"TopRight")),d(ib,!1,"clear:left").append(v=d(ib,"MiddleLeft"),t,w=d(ib,"MiddleRight")),d(ib,!1,"clear:left").append(d(ib,"BottomLeft"),x=d(ib,"BottomCenter"),d(ib,"BottomRight"))).find("div div").css({"float":"left"}),B=d(ib,!1,"position:absolute; width:9999px; visibility:hidden; display:none; max-width:none;"),J=G.add(H).add(E).add(F),a(b.body).append(q,r.append(s,B)))}function o(){function c(a){a.which>1||a.shiftKey||a.altKey||a.metaKey||a.ctrlKey||(a.preventDefault(),m(this))}return r?(Y||(Y=!0,G.click(function(){W.next()}),H.click(function(){W.prev()}),I.click(function(){W.close()}),q.click(function(){K.overlayClose&&W.close()}),a(b).bind("keydown."+_,function(a){var b=a.keyCode;S&&K.escKey&&27===b&&(a.preventDefault(),W.close()),S&&K.arrowKey&&y[1]&&!a.altKey&&(37===b?(a.preventDefault(),H.click()):39===b&&(a.preventDefault(),G.click()))}),a.isFunction(a.fn.on)?a(b).on("click."+_,"."+ab,c):a("."+ab).live("click."+_,c)),!0):!1}function p(){var e,f,j,m=W.prep,n=++jb;T=!0,R=!1,P=y[Q],k(),l(gb),l(cb,K.onLoad),K.h=K.height?g(K.height,"y")-N-L:K.innerHeight&&g(K.innerHeight,"y"),K.w=K.width?g(K.width,"x")-O-M:K.innerWidth&&g(K.innerWidth,"x"),K.mw=K.w,K.mh=K.h,K.maxWidth&&(K.mw=g(K.maxWidth,"x")-O-M,K.mw=K.w&&K.w<K.mw?K.w:K.mw),K.maxHeight&&(K.mh=g(K.maxHeight,"y")-N-L,K.mh=K.h&&K.h<K.mh?K.h:K.mh),e=K.href,V=setTimeout(function(){C.show()},100),K.inline?(j=d(ib).hide().insertBefore(a(e)[0]),hb.one(gb,function(){j.replaceWith(A.children())}),m(a(e))):K.iframe?m(" "):K.html?m(K.html):h(K,e)?(e=i(K,e),R=b.createElement("img"),a(R).addClass(_+"Photo").bind("error",function(){K.title=!1,m(d(ib,"Error").html(K.imgError))}).one("load",function(){var b;n===jb&&(a.each(["alt","longdesc","aria-describedby"],function(b,c){var d=a(P).attr(c)||a(P).attr("data-"+c);d&&R.setAttribute(c,d)}),K.retinaImage&&c.devicePixelRatio>1&&(R.height=R.height/c.devicePixelRatio,R.width=R.width/c.devicePixelRatio),K.scalePhotos&&(f=function(){R.height-=R.height*b,R.width-=R.width*b},K.mw&&R.width>K.mw&&(b=(R.width-K.mw)/R.width,f()),K.mh&&R.height>K.mh&&(b=(R.height-K.mh)/R.height,f())),K.h&&(R.style.marginTop=Math.max(K.mh-R.height,0)/2+"px"),y[1]&&(K.loop||y[Q+1])&&(R.style.cursor="pointer",R.onclick=function(){W.next()}),R.style.width=R.width+"px",R.style.height=R.height+"px",setTimeout(function(){m(R)},1))}),setTimeout(function(){R.src=e},1)):e&&B.load(e,K.data,function(b,c){n===jb&&m("error"===c?d(ib,"Error").html(K.xhrError):a(this).contents())})}var q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z={html:!1,photo:!1,iframe:!1,inline:!1,transition:"elastic",speed:300,fadeOut:300,width:!1,initialWidth:"600",innerWidth:!1,maxWidth:!1,height:!1,initialHeight:"450",innerHeight:!1,maxHeight:!1,scalePhotos:!0,scrolling:!0,href:!1,title:!1,rel:!1,opacity:.9,preloading:!0,className:!1,overlayClose:!0,escKey:!0,arrowKey:!0,top:!1,bottom:!1,left:!1,right:!1,fixed:!1,data:void 0,closeButton:!0,fastIframe:!0,open:!1,reposition:!0,loop:!0,slideshow:!1,slideshowAuto:!0,slideshowSpeed:2500,slideshowStart:"start slideshow",slideshowStop:"stop slideshow",photoRegex:/\.(gif|png|jp(e|g|eg)|bmp|ico|webp)((#|\?).*)?$/i,retinaImage:!1,retinaUrl:!1,retinaSuffix:"@2x.$1",current:"image {current} of {total}",previous:"previous",next:"next",close:"close",xhrError:"This content failed to load.",imgError:"This image failed to load.",returnFocus:!0,trapFocus:!0,onOpen:!1,onLoad:!1,onComplete:!1,onCleanup:!1,onClosed:!1},$="colorbox",_="cbox",ab=_+"Element",bb=_+"_open",cb=_+"_load",db=_+"_complete",eb=_+"_cleanup",fb=_+"_closed",gb=_+"_purge",hb=a("<a/>"),ib="div",jb=0,kb={},lb=function(){function a(){clearTimeout(g)}function b(){(K.loop||y[Q+1])&&(a(),g=setTimeout(W.next,K.slideshowSpeed))}function c(){F.html(K.slideshowStop).unbind(i).one(i,d),hb.bind(db,b).bind(cb,a),r.removeClass(h+"off").addClass(h+"on")}function d(){a(),hb.unbind(db,b).unbind(cb,a),F.html(K.slideshowStart).unbind(i).one(i,function(){W.next(),c()}),r.removeClass(h+"on").addClass(h+"off")}function e(){f=!1,F.hide(),a(),hb.unbind(db,b).unbind(cb,a),r.removeClass(h+"off "+h+"on")}var f,g,h=_+"Slideshow_",i="click."+_;return function(){f?K.slideshow||(hb.unbind(eb,e),e()):K.slideshow&&y[1]&&(f=!0,hb.one(eb,e),K.slideshowAuto?c():d(),F.show())}}();a.colorbox||(a(n),W=a.fn[$]=a[$]=function(b,c){var d=this;if(b=b||{},n(),o()){if(a.isFunction(d))d=a("<a/>"),b.open=!0;else if(!d[0])return d;c&&(b.onComplete=c),d.each(function(){a.data(this,$,a.extend({},a.data(this,$)||Z,b))}).addClass(ab),(a.isFunction(b.open)&&b.open.call(d)||b.open)&&m(d[0])}return d},W.position=function(b,c){function d(){u[0].style.width=x[0].style.width=t[0].style.width=parseInt(r[0].style.width,10)-M+"px",t[0].style.height=v[0].style.height=w[0].style.height=parseInt(r[0].style.height,10)-L+"px"}var f,h,i,j=0,k=0,l=r.offset();if(z.unbind("resize."+_),r.css({top:-9e4,left:-9e4}),h=z.scrollTop(),i=z.scrollLeft(),K.fixed?(l.top-=h,l.left-=i,r.css({position:"fixed"})):(j=h,k=i,r.css({position:"absolute"})),k+=K.right!==!1?Math.max(z.width()-K.w-O-M-g(K.right,"x"),0):K.left!==!1?g(K.left,"x"):Math.round(Math.max(z.width()-K.w-O-M,0)/2),j+=K.bottom!==!1?Math.max(e()-K.h-N-L-g(K.bottom,"y"),0):K.top!==!1?g(K.top,"y"):Math.round(Math.max(e()-K.h-N-L,0)/2),r.css({top:l.top,left:l.left,visibility:"visible"}),s[0].style.width=s[0].style.height="9999px",f={width:K.w+O+M,height:K.h+N+L,top:j,left:k},b){var m=0;a.each(f,function(a){return f[a]!==kb[a]?(m=b,void 0):void 0}),b=m}kb=f,b||r.css(f),r.dequeue().animate(f,{duration:b||0,complete:function(){d(),T=!1,s[0].style.width=K.w+O+M+"px",s[0].style.height=K.h+N+L+"px",K.reposition&&setTimeout(function(){z.bind("resize."+_,W.position)},1),c&&c()},step:d})},W.resize=function(a){var b;S&&(a=a||{},a.width&&(K.w=g(a.width,"x")-O-M),a.innerWidth&&(K.w=g(a.innerWidth,"x")),A.css({width:K.w}),a.height&&(K.h=g(a.height,"y")-N-L),a.innerHeight&&(K.h=g(a.innerHeight,"y")),a.innerHeight||a.height||(b=A.scrollTop(),A.css({height:"auto"}),K.h=A.height()),A.css({height:K.h}),b&&A.scrollTop(b),W.position("none"===K.transition?0:K.speed))},W.prep=function(c){function e(){return K.w=K.w||A.width(),K.w=K.mw&&K.mw<K.w?K.mw:K.w,K.w}function g(){return K.h=K.h||A.height(),K.h=K.mh&&K.mh<K.h?K.mh:K.h,K.h}if(S){var j,k="none"===K.transition?0:K.speed;A.empty().remove(),A=d(ib,"LoadedContent").append(c),A.hide().appendTo(B.show()).css({width:e(),overflow:K.scrolling?"auto":"hidden"}).css({height:g()}).prependTo(t),B.hide(),a(R).css({"float":"none"}),j=function(){function c(){a.support.opacity===!1&&r[0].style.removeAttribute("filter")}var e,g,j=y.length,m="frameBorder",n="allowTransparency";S&&(g=function(){clearTimeout(V),C.hide(),l(db,K.onComplete)},D.html(K.title).add(A).show(),j>1?("string"==typeof K.current&&E.html(K.current.replace("{current}",Q+1).replace("{total}",j)).show(),G[K.loop||j-1>Q?"show":"hide"]().html(K.next),H[K.loop||Q?"show":"hide"]().html(K.previous),lb(),K.preloading&&a.each([f(-1),f(1)],function(){var c,d,e=y[this],f=a.data(e,$);f&&f.href?(c=f.href,a.isFunction(c)&&(c=c.call(e))):c=a(e).attr("href"),c&&h(f,c)&&(c=i(f,c),d=b.createElement("img"),d.src=c)})):J.hide(),K.iframe?(e=d("iframe")[0],m in e&&(e[m]=0),n in e&&(e[n]="true"),K.scrolling||(e.scrolling="no"),a(e).attr({src:K.href,name:(new Date).getTime(),"class":_+"Iframe",allowFullScreen:!0,webkitAllowFullScreen:!0,mozallowfullscreen:!0}).one("load",g).appendTo(A),hb.one(gb,function(){e.src="//about:blank"}),K.fastIframe&&a(e).trigger("load")):g(),"fade"===K.transition?r.fadeTo(k,1,c):c())},"fade"===K.transition?r.fadeTo(k,0,function(){W.position(0,j)}):W.position(k,j)}},W.next=function(){!T&&y[1]&&(K.loop||y[Q+1])&&(Q=f(1),m(y[Q]))},W.prev=function(){!T&&y[1]&&(K.loop||Q)&&(Q=f(-1),m(y[Q]))},W.close=function(){S&&!U&&(U=!0,S=!1,l(eb,K.onCleanup),z.unbind("."+_),q.fadeTo(K.fadeOut||0,0),r.stop().fadeTo(K.fadeOut||0,0,function(){r.add(q).css({opacity:1,cursor:"auto"}).hide(),l(gb),A.empty().remove(),setTimeout(function(){U=!1,l(fb,K.onClosed)},1)}))},W.remove=function(){r&&(r.stop(),a.colorbox.close(),r.stop().remove(),q.remove(),U=!1,r=null,a("."+ab).removeData($).removeClass(ab),a(b).unbind("click."+_))},W.element=function(){return a(P)},W.settings=Z)}(jQuery,document,window);var SAT={};!function(a){"use strict";var b=function(a,b){this.x=a||0,this.y=b||0};a.Vector=b,b.prototype.copy=function(a){return this.x=a.x,this.y=a.y,this},b.prototype.perp=function(){var a=this.x;return this.x=this.y,this.y=-a,this},b.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this},b.prototype.normalize=function(){var a=this.len();return a>0&&(this.x=this.x/a,this.y=this.y/a),this},b.prototype.add=function(a){return this.x+=a.x,this.y+=a.y,this},b.prototype.sub=function(a){return this.x-=a.x,this.y-=a.y,this},b.prototype.scale=function(a,b){return this.x*=a,this.y*=b||a,this},b.prototype.project=function(a){var b=this.dot(a)/a.len2();return this.x=b*a.x,this.y=b*a.y,this},b.prototype.projectN=function(a){var b=this.dot(a);return this.x=b*a.x,this.y=b*a.y,this},b.prototype.projectN=b.prototype.projectN,b.prototype.reflect=function(a){var b=this.x,c=this.y;return this.project(a).scale(2),this.x-=b,this.y-=c,this},b.prototype.reflectN=function(a){var b=this.x,c=this.y;return this.projectN(a).scale(2),this.x-=b,this.y-=c,this},b.prototype.dot=function(a){return this.x*a.x+this.y*a.y},b.prototype.len2=function(){return this.dot(this)},b.prototype.len=function(){return Math.sqrt(this.len2())};var c=function(a,c){this.pos=a||new b,this.points=c||[],this.recalc()};a.Polygon=c,c.prototype.recalc=function(){var a=this.points,c=a.length;this.edges=[],this.normals=[];for(var d=0;c>d;d++){var e=a[d],f=c-1>d?a[d+1]:a[0],g=(new b).copy(f).sub(e),h=(new b).copy(g).perp().normalize();this.edges.push(g),this.normals.push(h)}};var d=function(a,c,d){this.pos=a||new b,this.w=c||0,this.h=d||0};a.Box=d,d.prototype.toPolygon=function(){var a=this.pos,d=this.w,e=this.h;return new c(new b(a.x,a.y),[new b,new b(d,0),new b(d,e),new b(0,e)])};for(var e=[],f=0;10>f;++f)e.push(new b);for(var g=[],f=0;5>f;++f)g.push([]);var h=function(){this.a=null,this.b=null,this.overlapN=new b,this.overlapV=new b,this.clear()};a.Response=h,h.prototype.clear=function(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this};var i=function(a,b,c){for(var d=Number.MAX_VALUE,e=-Number.MAX_VALUE,f=a.length,g=0;f>g;++g){var h=a[g].dot(b);d>h&&(d=h),h>e&&(e=h)}c[0]=d,c[1]=e},j=function(a,b,c,d,f,h){var j=g.pop(),k=g.pop(),l=e.pop().copy(b).sub(a),m=l.dot(f);if(i(c,f,j),i(d,f,k),k[0]+=m,k[1]+=m,j[0]>k[1]||k[0]>j[1])return e.push(l),g.push(j),g.push(k),!0;if(h){var n=0;if(j[0]<k[0])if(h.aInB=!1,j[1]<k[1])n=j[1]-k[0],h.bInA=!1;else{var o=j[1]-k[0],p=k[1]-j[0];n=p>o?o:-p}else if(h.bInA=!1,j[1]>k[1])n=j[0]-k[1],h.aInB=!1;else{var o=j[1]-k[0],p=k[1]-j[0];n=p>o?o:-p}var q=Math.abs(n);q<h.overlap&&(h.overlap=q,h.overlapN.copy(f),0>n&&h.overlapN.reverse())}return e.push(l),g.push(j),g.push(k),!1};a.testPolygonPolygon=function(a,b,c){for(var d=a.points,e=d.length,f=b.points,g=f.length,h=0;e>h;h++)if(j(a.pos,b.pos,d,f,a.normals[h],c))return!1;for(var h=0;g>h;h++)if(j(a.pos,b.pos,d,f,b.normals[h],c))return!1;return c&&(c.a=a,c.b=b,c.overlapV.copy(c.overlapN).scale(c.overlap)),!0}}(SAT);var utils=function(){var a;return{extend:function(a,b){$.extend(a,b);var c="imgReady";Object.defineProperty(a,c,{get:function(){return b[c]}})},repeatAction:function(a,b,c){var d=0,e=setInterval(function(){d++>b?clearInterval(e):c()},a)},deathSequence:function(){audio.heroDeath.play(),audio.bgMusic.muted=!0,alert("You died"),location.reload(),game.over=!0},degToRad:function(a){return.017453292519943295*a},getTimeObj:function(a){if(0===a)return{min:"00",sec:"00"};var b=Math.floor(a/60),c=a%60;return 10>c&&(c="0"+c),10>b&&(b="0"+b),{min:b,sec:c}},printSlow:function(a){game.actualTime%10===0&&console.log(a)},printMouse:function(){$("canvas").on("mousemove",function(a){console.log(a.offsetX,a.offsetY)})},printDir:function(a){switch(a){case 0:console.log("Dir.NONE");break;case 1:console.log("Dir.TOP");break;case 2:console.log("Dir.BOT");break;case 3:console.log("Dir.LEFT");break;case 4:console.log("Dir.RIGHT");break;case 5:console.log("Dir.IN");break;default:console.log("Dir.unknown")}},toggleMenu:function(){"block"===$("#colorbox").css("display")?a.colorbox.close():a=$.colorbox({html:$(".gameInstructions").html(),width:320,height:530})},toggleFullScreen:function(){if($("body").hasClass("fullscreen"))$(".canvasWrap").css({width:"",marginLeft:""}),$("body").removeClass("fullscreen");else{$("body").addClass("fullscreen");var a=1.777778*$(window).height();$(".canvasWrap").css({width:a,marginLeft:-a/2})}}}}(),Dir=Object.freeze({NONE:0,TOP:1,BOT:2,LEFT:3,RIGHT:4,IN:5}),Inv_e=Object.freeze({NOT_HIT:0,HIT_WHITE:1,HIT_RED:2}),KeyCode=Object.freeze({ENTER:13,J:74,K:75,O:79,S:83,W:87,EMPTY:-1}),Color=Object.freeze({LIGHT_BROWN:"#c44525",DARK_BROWN:"#672819",LIGHT_GREEN:"#166a38",SILVER:"#c0c0c0",BLACK:"#000",GOLD:"#ddaa13",ORANGE:"#ff6a00"}),JQObject=Object.freeze({EMPTY:0,CRATE:1,LADDER:2,SACK:3,ENEMY:4,CASH:5,DOOR:6,SCALE:7,SMALL_CLOUD:8,CLOUD:9,PLATFORM:10,FLOOR:11}),JQObject_names=Object.freeze({0:"EMPTY",1:"CRATE",2:"LADDER",3:"SACK",4:"ENEMY",5:"CASH",6:"DOOR",7:"SCALE",8:"SMALL_CLOUD",9:"CLOUD",10:"PLATFORM",11:"FLOOR"}),bullet={w:19.5,h:9,speed:4.4};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(a){setTimeout(a,16.6666666667)}}();var audio=function(){return{bgMusic:new Audio("audio/firstChiptune/firstChiptune.mp3"),enterSound:new Audio("audio/synthetic_explosion_1.mp3"),exitSound:new Audio("audio/annulet.mp3"),itemPickedUp:new Audio("audio/life_pickup.mp3"),heartbeat:new Audio("audio/heartbeat.mp3"),jump:new Audio("audio/jump.mp3"),thud:new Audio("audio/thud.mp3"),step:new Audio("audio/step.mp3"),effort:new Audio("audio/woosh.mp3"),discovery:new Audio("audio/spell3.mp3"),enemyDeath:new Audio("audio/death.mp3"),heroDeath:new Audio("audio/DiscsOfTron_Cascade.mp3"),enchant:new Audio("audio/enchant.mp3"),isOn:!1,init:function(){audio.bgMusic.loop=!0,audio.bgMusic.volume=.7,audio.bgMusic.pause(),audio.enemyDeath.volume=.6,audio.jump.volume=.4,audio.thud.volume=.78,audio.discovery.volume=.7,audio.mute(!0),$(document).on("click",".audioState",audio.handleMuteButton),$(".menu").on("click",function(a){a.preventDefault(),utils.toggleMenu()}),audio.handleMuteButton()},lvlComplete:function(){audio.bgMusic.pause();var a;switch(game.lvl){case 0:audio.enterSound.play(),a="inspiredBySparkMan/sparkBoy.mp3";break;default:audio.exitSound.play(),a="sweetAcoustic.mp3"}setTimeout(function(){audio.bgMusic=new Audio("audio/"+a),audio.bgMusic.loop=!0,audio.bgMusic.volume=.45,audio.isOn?audio.bgMusic.play():audio.bgMusic.pause()},1e3)},play:function(a,b){b="undefined"!=typeof b?b:!0,a.ended?a.play():(b||0===a.currentTime)&&(a.pause(),a.currentTime=0,a.play())},handleMuteButton:function(){$(".audioState").hasClass("off")?($(".audioState span").removeClass("icon-volume-mute").addClass("icon-volume-medium"),$(".audioState").removeClass("off"),$(".audioState").addClass("on"),audio.mute(!1)):($(".audioState span").removeClass("icon-volume-medium").addClass("icon-volume-mute"),$(".audioState").removeClass("on"),$(".audioState").addClass("off"),audio.mute(!0))},mute:function(a){audio.discovery.muted=audio.enterSound.muted=audio.bgMusic.muted=audio.itemPickedUp.muted=audio.heartbeat.muted=audio.effort.muted=audio.thud.muted=audio.jump.muted=audio.step.muted=audio.enemyDeath.muted=audio.heroDeath.muted=audio.enchant.muted=audio.exitSound.muted=a,a?audio.bgMusic.pause():audio.bgMusic.play(),audio.isOn=!a}}}(),Graphics=function(){var a=1,b=null;return{ticker:1,tickerStep:.01,fadeOut:!1,projectX:9,projectY:12,fadeCanvas:function(a){$(canvas).removeClass("preTransition"),$(canvas).addClass("duringTransition"),b=$(canvas).on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){b.off(),$(this).removeClass("duringTransition"),$(this).addClass("preTransition"),a()})},blinkText:function(b,c,d,e){e="undefined"!=typeof e?e:"PRESS ENTER",(Graphics.ticker>=1.35||Graphics.ticker<=Graphics.tickerStep)&&(Graphics.fadeOut=!Graphics.fadeOut),a=Graphics.ticker>=1?1:Graphics.ticker<=Graphics.tickerStep?0:Graphics.ticker,ctx.font=b+"px 'Press Start 2P'";var f=ctx.measureText(e).width;ctx.fillStyle="rgba(233, 233, 233,"+a+")",ctx.fillText(e,c-f/2,d)},getSkewedRect:function(a,b,c,d){b+=Graphics.projectY/2;var e=new SAT.Polygon(new SAT.Vector(a,b),[new SAT.Vector,new SAT.Vector(c-Graphics.projectX,0),new SAT.Vector(c,Graphics.projectY),new SAT.Vector(c,d),new SAT.Vector(Graphics.projectX,d),new SAT.Vector(0,d-Graphics.projectY)]);return e.type=JQObject.PLATFORM,e},drawLadder:function(a){var b=a.pos.x,c=a.pos.y,d=a.edges[0].x,e=a.edges[1].y;ctx.fillStyle=Color.LIGHT_BROWN,ctx.fillRect(b,c,5,e),ctx.fillRect(b+d-5,c,5,e);for(var f=13;e>f;f+=20)ctx.fillRect(b,c+f,d,8)},drawScale:function(a){var b=a.pos.x,c=a.pos.y,d=a.edges[0].x,e=a.edges[1].y;ctx.fillStyle=Color.BLACK,ctx.fillRect(b,c-1,d,1),ctx.fillStyle=Color.DARK_BROWN,ctx.fillRect(b,c,d,e)},drawPlatform:function(a){var b=a.pos.y-Graphics.projectY/2;ctx.fillStyle=Color.LIGHT_BROWN,ctx.beginPath(),ctx.moveTo(a.pos.x,b),ctx.lineTo(a.pos.x+a.points[1].x,b+a.points[1].y),ctx.lineTo(a.pos.x+a.points[2].x,b+a.points[2].y),ctx.lineTo(a.pos.x+Graphics.projectX,b+Graphics.projectY),ctx.closePath(),ctx.fill(),ctx.fillStyle=Color.DARK_BROWN,ctx.beginPath(),ctx.moveTo(a.pos.x+a.points[2].x,b+a.points[2].y),ctx.lineTo(a.pos.x+a.points[3].x,b+a.points[3].y),ctx.lineTo(a.pos.x+a.points[4].x,b+a.points[4].y),ctx.lineTo(a.pos.x+a.points[5].x,b+a.points[5].y),ctx.lineTo(a.pos.x+a.points[0].x,b+a.points[0].y),ctx.lineTo(a.pos.x+Graphics.projectX,b+Graphics.projectY),ctx.closePath(),ctx.fill()},drawPlatformStatus:function(a){var b=a.pos.x,c=a.pos.y,d=a.w,e=a.h,f=26,g=f/2,h=b+d/2-g,i=c+e/2-g;ctx.lineWidth=3,a.holdingItem===JQObject.CRATE?(ctx.strokeStyle="green",--i,ctx.beginPath(),ctx.moveTo(h,i+g),ctx.lineTo(h+g,i+f),ctx.moveTo(h+g-1,i+f),ctx.lineTo(h+f+2,i+2),ctx.stroke(),ctx.closePath()):(ctx.strokeStyle="red",ctx.beginPath(),ctx.moveTo(h,i),ctx.lineTo(h+f,i+f),ctx.moveTo(h,i+f),ctx.lineTo(h+f,i),ctx.stroke(),ctx.closePath())},drawDoor:function(a,b,c,d){ctx.fillStyle=Color.LIGHT_BROWN,ctx.fillRect(a+2,b+2,c-2,d-2),ctx.fillStyle=Color.DARK_BROWN,ctx.fillRect(a,b,2,d),ctx.fillRect(a,b,c,2),ctx.fillRect(a+c,b,2,d),ctx.beginPath(),ctx.arc(a+c-c/3.2,b+d-d/3.4,3,0,2*Math.PI,!1),ctx.fill(),ctx.closePath(),ctx.fillStyle="#e1e1e1",ctx.font="12px 'Press Start 2P'",ctx.fillText("EXIT",a-8,b-5)},drawEllipse:function(a,b,c,d){var e=.5522848,f=c/2*e,g=d/2*e,h=a+c,i=b+d,j=a+c/2,k=b+d/2;ctx.beginPath(),ctx.moveTo(a,k),ctx.bezierCurveTo(a,k-g,j-f,b,j,b),ctx.bezierCurveTo(j+f,b,h,k-g,h,k),ctx.bezierCurveTo(h,k+g,j+f,i,j,i),ctx.bezierCurveTo(j-f,i,a,k+g,a,k),ctx.closePath(),ctx.fill()},drawRotate:function(a,b,c,d){ctx.save(),ctx.translate(b,c),ctx.rotate(utils.degToRad(d)),ctx.translate(.5*-a.width,.5*-a.height),ctx.drawImage(a,0,0),ctx.restore()}}}(),Physics=function(){return{isCollision:function(a,b,c,d){var e="undefined"!=typeof d?a.pos.x+a.lvlX:a.pos.x;return e+c<=b.pos.x+b.w&&b.pos.x+c<=e+a.w&&a.pos.y+c<=b.pos.y+b.h&&b.pos.y+c<=a.pos.y+a.h?!0:!1},lvlObjCollision:function(a,b){for(var c=new SAT.Response,d=0;d<level.objs.length;++d)if("undefined"==typeof level.objs[d].collidable){var e=SAT.testPolygonPolygon(a,level.objs[d],c);if(e){c.a.pos.x-=c.overlapV.x,c.a.pos.y-=c.overlapV.y,c.type=level.objs[d].type,b(c);break}c.clear()}},lvlItemCollision:function(a){if(!(hero.isCarrying||32 in keysDown))for(var b=0;b<level.items.length;++b)Physics.isSATcollision(hero,level.items[b],function(c){a(c,b)})},isSATcollision:function(a,b,c){var d=new SAT.Response,e=SAT.testPolygonPolygon(a,b,d);e&&c(d)}}}(),Crate=function(){return{update:function(){for(var a=level.crates,b=new SAT.Response,c=0;c<a.length;++c)for(var d=0;d<a.length;++d)if(c!==d&&!a[c].holding&&!a[d].holding){var e=SAT.testPolygonPolygon(a[c],a[d],b);e&&1===b.overlapN.y&&(b.a.pos.x-=b.overlapV.x,b.a.pos.y-=b.overlapV.y,b.a.isOnObj=!0,b.a.onObj=b.b,b.b.grabbable=!1,level.items.push(b.a)),b.clear()}for(var c=0;c<a.length;++c){if(a[c].holding)a[c].pos.x=hero.dir===Dir.RIGHT?hero.pos.x+22:hero.pos.x-22,a[c].pos.y=hero.pos.y;else{Physics.lvlObjCollision(a[c],function(a){a.type!==JQObject.FLOOR&&1===a.overlapN.y&&(a.a.vY=0,level.items.push(a.a),a.a.onPlatform=!0,a.a.grabbable=!1,a.b.holdingItem=JQObject.CRATE,utils.repeatAction(70,8,function(){++a.a.pos.y,++a.b.pos.y}),audio.thud.play())});var f=level.items.indexOf(a[c]);0>f&&a[c].onGround&&level.items.push(a[c])}a[c].updatePos()}}}}(),GameObj=function(a,b,c,d,e,f){if(this.initX=a,this.initY=b,e===JQObject.FLOOR?$.extend(this,Graphics.getSkewedRect(a,b,c,d)):$.extend(this,new SAT.Box(new SAT.Vector(a,b),c,d).toPolygon()),this.w=c,this.h=d,this.type=e,this.vY=0,this.onGround=!1,this.isOnObj=!1,this.onObj=null,this.grabbable=!0,this.imgReady=!1,"undefined"!=typeof f){this.img=new Image;var g=this;this.img.onload=function(){g.imgReady=!0,g.w=this.width,g.h=this.height},this.img.src=f}};GameObj.prototype={updatePos:function(){this.isOnObj||(this.pos.y<FULLH-game.padFloor-this.h+5?(this.pos.y+=this.vY,this.onGround=!1):(this.pos.y=FULLH-game.padFloor-this.h+5,this.onGround=!0))},draw:function(){this.imgReady?ctx.drawImage(this.img,this.pos.x,this.pos.y):(ctx.fillStyle="red",ctx.fillRect(this.pos.x,this.pos.y,this.w,this.h))}};var GameItem=function(a,b,c){utils.extend(this,a),this.val="undefined"!=typeof b?b:-1,this.visible="undefined"!=typeof c?c:!0,this.collected=!1,this.holding=!1;var d=this.draw;this.draw=function(){this.visible&&!this.collected&&d.apply(this)}},HUD=function(){function a(){for(var a=0;a<hero.health;++a)ctx.fillStyle="red",ctx.fillRect(80+21*a,FULLH+14,19,8)}function b(){for(var a=0;a<hero.mana;++a)ctx.fillStyle="#00b6ff",ctx.fillRect(80+21*a,FULLH+37,19,8)}function c(){ctx.fillStyle="#ddd",ctx.font="12px 'Press Start 2P'";var a=hero.xp<10?"0":"";ctx.fillText(a+hero.xp+"/"+hero.xpNeeded,80,FULLH+71)}var d=null,e=null,f=null,g=null;return{init:function(){d=new GameObj(548,FULLH+33,22,24,JQObject.EMPTY,"img/cash.png"),e=new GameObj(238,FULLH+31,25,24,JQObject.EMPTY,"img/medKit.png"),f=new GameObj(447,FULLH+32,24,24,JQObject.EMPTY,"img/shuriken.png"),g=new GameObj(342,FULLH+31,25,25,JQObject.EMPTY,"img/syringe.png")},draw:function(){ctx.fillStyle="#070707",ctx.fillRect(0,FULLH,FULLW,game.padHUD),ctx.fillStyle="#ddd",ctx.font="12px 'Press Start 2P'",ctx.fillText("HP-"+hero.healthLvl,15,FULLH+24),ctx.fillText("MP-"+hero.manaLvl,15,FULLH+48),ctx.fillText("XP",15,FULLH+71),a(),b(),c(),ctx.fillText(hero.medKits,210,FULLH+50),e.draw(),ctx.fillText(hero.manaKits,315,FULLH+50),g.draw(),ctx.fillText(hero.ammo,410,FULLH+50),f.draw(),ctx.fillText(hero.cash,515,FULLH+50),d.draw();var h=utils.getTimeObj(game.actualTime);ctx.fillText(h.min+":"+h.sec,FULLW-84,FULLH+34)}}}(),Enemy=function(a,b,c,d,e){function f(a){var b=a.w/a.initHealth*a.health;ctx.fillStyle="red",ctx.fillRect(a.x,a.y-12,b,4)}utils.extend(this,a),this.initHealth=this.health=b,this.leftXBound=c,this.rightXBound=d,this.active="undefined"!=typeof e?e:!1,this.deadOffScreen=!1,this.dir=Dir.RIGHT,this.alive=!0,this.deadOnScreen=!1,this.clearDir=!0;var g=this.draw;this.draw=function(){(this.alive||this.deadOnScreen)&&(this.initHealth>1&&f(this),ctx.save(),this.deadOnScreen&&(ctx.globalAlpha=.3),g.apply(this),ctx.restore())}};Enemy.prototype={update:function(){this.deadOnScreen?(this.pos.x+=this.clearDir?2:-2,this.pos.y-=9,(this.pos.x<0||this.pos.x>FULLW)&&(this.deadOnScreen=!1,this.deadOffScreen=!0)):this.active&&game.totalTicks%3===0&&(this.pos.x+hero.lvlX<=this.leftXBound?this.dir=Dir.RIGHT:this.pos.x+hero.lvlX>=this.rightXBound&&(this.dir=Dir.LEFT),this.dir===Dir.RIGHT?++this.pos.x:--this.pos.x)},death:function(){this.clearDir=hero.dir==Dir.RIGHT,audio.enemyDeath.play(),hero.xp+=15,this.alive=!1,this.deadOnScreen=!0}};var level=function(){function a(){for(var a=0;a<level.objs.length;++a)level.objs[a].pos.x-=hero.vX}function b(){for(var a=0;a<level.items.length;++a)level.items[a].pos.x-=hero.vX}function c(){for(var a=0;a<level.bg[1].length;++a)level.bg[1][a].pos.x-=hero.vX/3;for(var a=0;a<level.bg[0].length;++a)level.bg[0][a].pos.x-=hero.vX/2}function d(){ctx.fillStyle=Color.LIGHT_GREEN,ctx.fillRect(0,0,FULLW,FULLH-game.padFloor-1),ctx.fillStyle="#000",ctx.fillRect(0,FULLH-game.padFloor-1,FULLW,game.padFloor+1);for(var a=0;a<level.bg[1].length;++a)level.bg[1][a].draw();for(var a=0;a<level.bg[0].length;++a)level.bg[0][a].draw()}function e(){for(var a=0;a<level.objs.length;++a)("undefined"==typeof level.objs[a].visible||level.objs[a].visible)&&(level.objs[a].type===JQObject.LADDER?Graphics.drawLadder(level.objs[a]):level.objs[a].type===JQObject.SCALE?(Graphics.drawScale(level.objs[a]),Graphics.drawPlatformStatus(level.objs[a])):(level.objs[a].type===JQObject.PLATFORM||level.objs[a].type===JQObject.FLOOR)&&Graphics.drawPlatform(level.objs[a]))}return{bg:[[],[]],crates:[],objs:[],items:[],curLvl:null,isCutscene:!1,time:0,hiddenItemsFound:0,hiddenItems:0,isTransitioning:!1,init:function(){level.curLvl=startScreen,level.curLvl.init(),level.reset()},reset:function(){level.hiddenItemsFound=0,hero.pos.x=23,hero.pos.y=FULLH-game.padFloor-hero.h+4,hero.vX=hero.vY=0,hero.isJumping=!1,hero.bulletArr.length=0},complete:function(){level.isTransitioning=!0,audio.lvlComplete(),Graphics.ticker=1,Graphics.fadeOut=!0,Graphics.fadeCanvas(function(){level.isTransitioning=!1,hero.lvlX=0,level.objs=[],level.items=[],level.crates=[],level.bg=[[],[]],level.curLvl=lvlComplete,level.isCutscene=!0,level.time=game.actualTime})},update:function(){level.isTransitioning||(Crate.update(),level.curLvl.update())},updateView:function(){a(),b(),c()},render:function(){d(),e(),level.curLvl.render()}}}(),lvlComplete=function(){return{update:function(){if(KeyCode.ENTER in keysDown||0===game.lvl||window.DEBUG){switch(lastKeyDown=KeyCode.EMPTY,++game.lvl){case 1:game.actualTime=0,lvl1.init(),level.curLvl=lvl1;break;case 2:lvl2.init(),level.curLvl=lvl2}level.isCutscene=!1,level.reset()}},render:function(){ctx.fillStyle="#000",ctx.fillRect(0,0,FULLW,canvas.height),ctx.font="24px 'Press Start 2P'";var a="LEVEL "+game.lvl+" COMPLETE",b=ctx.measureText(a).width;ctx.fillStyle=Color.ORANGE,ctx.fillText(a,HALFW-b/2,70),ctx.font="18px 'Press Start 2P'";{var c=utils.getTimeObj(level.time),d="LEVEL TIME......"+c.min+":"+c.sec;ctx.measureText(d).width}ctx.fillStyle="#e1e1e1",ctx.fillText(d,HALFW-b/2,150),ctx.font="18px 'Press Start 2P'";var e="HIDDEN ITEMS....."+level.hiddenItemsFound+"/"+level.hiddenItems,f=ctx.measureText(e).width;ctx.fillStyle="#e1e1e1",ctx.fillText(e,HALFW-f/2,190),Graphics.blinkText(16,HALFW,HALFH+120)}}}(),startScreen=function(){var a="JON'S",b="QUEST",c=String.fromCharCode("169")+" 2013 JON WIEDMANN";return{init:function(){level.isCutscene=!0},update:function(){lastKeyDown===KeyCode.ENTER&&level.complete()},render:function(){ctx.fillStyle="#000",ctx.fillRect(0,0,FULLW,FULLH+game.padHUD),ctx.font="29px 'Press Start 2P'";var d=HALFW-ctx.measureText(a).width/2+11,e=58;ctx.setTransform(1,0,-.4,1.4,0,0),ctx.fillStyle="#222",ctx.fillText("J",d+4,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("J",d,e),ctx.setTransform(1,0,-.2,1.4,0,0),ctx.fillStyle="#222",ctx.fillText("O",d+32,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("O",d+28,e),ctx.setTransform(1,0,.05,1.41,0,-1),ctx.fillStyle="#222",ctx.fillText("N",d+58,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("N",d+54,e),ctx.setTransform(1,0,.23,1.4,0,0),ctx.fillStyle="#222",ctx.fillText("'",d+78,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("'",d+74,e),ctx.setTransform(1,0,.42,1.4,0,0),ctx.fillStyle="#222",ctx.fillText("S",d+95,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("S",d+91,e),ctx.font="36px 'Press Start 2P'",d=HALFW-ctx.measureText(b).width/2+30,e=98,ctx.setTransform(1,0,-.5,1.6,0,0),ctx.fillStyle="#222",ctx.fillText("Q",d+4,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("Q",d,e),ctx.setTransform(1,0,-.25,1.6,0,0),ctx.fillStyle="#222",ctx.fillText("U",d+26,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("U",d+22,e),ctx.setTransform(1,0,.03,1.6,0,0),ctx.fillStyle="#222",ctx.fillText("E",d+50,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("E",d+46,e),ctx.setTransform(1,0,.25,1.6,0,0),ctx.fillStyle="#222",ctx.fillText("S",d+74,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("S",d+70,e),ctx.setTransform(1,0,.5,1.6,0,0),ctx.fillStyle="#222",ctx.fillText("T",d+90,e+4),ctx.fillStyle="#ff6a00",ctx.fillText("T",d+86,e),ctx.setTransform(1,0,0,1,0,0),Graphics.blinkText(22,HALFW,HALFH+81),ctx.font="13px 'Press Start 2P'",ctx.fillStyle="#ddd",ctx.fillText(c,HALFW-ctx.measureText(c).width/2,FULLH+44)}}}(),lvl1=function(){function a(){if(h)hero.onLadder=SAT.testPolygonPolygon(hero,f);else{for(var a=0,b=0;b<level.objs.length;++b)level.objs[b].type===JQObject.SCALE&&"undefined"!=typeof level.objs[b].holdingItem&&level.objs[b].holdingItem===JQObject.CRATE&&++a;
if(h=3===a){var c=$.grep(level.objs,function(a){return a.type===JQObject.LADDER});c[0].visible=!0}}}var b,c,d,e,f,g=[],h=!1;return{width:2700,init:function(){level.hiddenItems=1;var a=new GameObj(-Graphics.projectX,FULLH-game.padFloor-1,lvl1.width+2*Graphics.projectX,game.padFloor+1,JQObject.FLOOR);level.objs.push(a);for(var h,i=0,j=HALFW/1.2,k=HALFW/2.7,l=60-j;l<this.width;)h=++i%2==0?100:0,l+=j,level.bg[0].push(new GameObj(l,60+h,0,0,JQObject.CLOUD,"img/cloud.png"));for(l=0;l<this.width;)h=++i%2==0?70:i%3==0?140:10,l+=k,level.bg[1].push(new GameObj(l,100+h,0,0,JQObject.SMALL_CLOUD,"img/cloud_small.png"));level.objs.push(Graphics.getSkewedRect(200,216,267,50),Graphics.getSkewedRect(562,315,300,50),Graphics.getSkewedRect(585,135,220,50));for(var m={x:1160,y:210,w:0,h:0},n=5,o=17,i=0;15>i;++i)level.objs.push(Graphics.getSkewedRect(m.x+o*i,m.y-n*i,o+1,50)),m.w+=o,m.h+=n;level.objs.push(Graphics.getSkewedRect(m.x+m.w,m.y-m.h,200,50)),e=new GameItem(new GameObj(m.x+m.w+155,m.y-m.h-53,25,53,JQObject.DOOR)),d=new GameItem(new GameObj(680,111+Graphics.projectY/2,20,24,JQObject.SACK,"img/sack.png"),5),d.collidable=!1,b=new Enemy(new GameObj(1600,FULLH-game.padFloor-38+5,28,38,JQObject.ENEMY,"img/cyborgBnW.png"),1,1087,1600,!0),b.collidable=!1,c=new GameItem(new GameObj(113,80,22,24,JQObject.CASH,"img/cash.png"),10,!1),c.collidable=!1,level.objs.push(d,b,c,e),f=new GameItem(new GameObj(m.x-37,m.y-1,38,FULLH-m.y-game.padFloor,JQObject.LADDER),0,!1,!0),f.collidable=!1,level.objs.push(f);for(var i=0;3>i;++i)g[i]=new GameItem(new GameObj(e.pos.x+350+220*i,FULLH-game.padFloor-107,150,36,JQObject.SCALE),0,!0,!0),g[i].holdingItem=JQObject.EMPTY,level.objs.push(g[i]);for(var i=0;3>i;++i)level.crates[i]=new GameItem(new GameObj(446,FULLH-game.padFloor-26+5,24,26,JQObject.CRATE,"img/crate.png"),0,!0,!0);level.crates[1].pos.x=g[1].pos.x+g[1].w/2-level.crates[0].w/2,level.crates[2].pos.x=g[2].pos.x+g[2].w/2-level.crates[0].w/2;for(var i=0;i<level.crates.length;++i)level.items.push(level.crates[i])},update:function(){if(window.DEBUG&&level.complete(),c.updatePos(),b.update(),a(),d.collected||Physics.isCollision(hero,d,0)&&(d.collected=!0,audio.itemPickedUp.play(),hero.ammo+=d.val),c.visible)c.collected||(c.visible&&(c.vY+=game.gravity),Physics.isCollision(hero,c,0)&&(c.collected=!0,audio.itemPickedUp.play(),hero.cash+=c.val,++level.hiddenItemsFound));else for(var f=0;f<hero.bulletArr.length;++f)Physics.isCollision(hero.bulletArr[f],c,-17)&&(c.visible=!0,audio.discovery.play());if(b.health>0){Physics.isCollision(hero,b,0)&&(b.active=!0,hero.invincible||(audio.play(audio.heartbeat,!0),hero.invincible=!0,--hero.health));for(var f=0;f<hero.bulletArr.length;++f){var g=!1;Physics.isCollision(hero.bulletArr[f],b,0)&&(g=!0,audio.play(audio.thud,!0)),g&&(b.active=!0,hero.bulletArr.splice(f,1),--b.health,b.health<=0&&b.death())}}!game.over&&Physics.isCollision(hero,e,0)&&level.complete()},render:function(){d.collected||d.draw(),c.visible&&c.draw(),b.deadOffScreen||b.draw(),Graphics.drawDoor(e.pos.x,e.pos.y,e.w,e.h);for(var a=0;a<level.crates.length;++a)level.crates[a].holding?0===hero.vX&&(level.crates[a].pos.x=hero.pos.x+2,level.crates[a].pos.y=hero.pos.y+11):level.crates[a].draw()}}}(),lvl2=function(){var a;return{width:800,init:function(){var b=new GameObj(-Graphics.projectX,FULLH-game.padFloor-1,FULLW/3,game.padFloor+1,JQObject.FLOOR),c=new GameObj(HALFW,FULLH-game.padFloor-1,FULLW/3,game.padFloor+1,JQObject.FLOOR);level.objs.push(b,c),a=new Enemy(new GameObj(c.pos.x,c.pos.y-38,28,38,JQObject.ENEMY,"img/cyborgBnW.png"),1,c.pos.x,c.pos.x+c.w-28,!0),a.collidable=!1,level.objs.push(a)},update:function(){a.update()},render:function(){ctx.font="18px 'Press Start 2P'";var b="LEVEL 2 -- COMING SOON",c=ctx.measureText(b).width;ctx.fillStyle="#e1e1e1",ctx.fillText(b,HALFW-c/2,150),a.deadOffScreen||a.draw()}}}(),game=function(){function a(){level.isCutscene||level.isTransitioning||hero.update(),level.update()}function b(a){a-g>0&&(h=a-g),g=a,d=requestAnimFrame(b),level.render(),level.isCutscene||(hero.render(),HUD.draw(),c())}function c(){if(i.push(1e3/h),game.totalTicks%120===0){for(var a=0,b=i.length;--b;)a+=i[b];for(f=i.length>0?Math.floor(a/i.length):0;i.length>0;)i.pop()}ctx.fillStyle="#ddd",ctx.font="12px 'Press Start 2P'",ctx.fillText(f+" FPS",FULLW-84,FULLH+65)}var d,e,f=0,g=0,h=16,i=[60];return{over:!1,gravity:.07,padHUD:80,padFloor:32,lvl:0,totalTicks:0,actualTime:0,start:function(){e=setInterval(function(){++game.totalTicks,Graphics.ticker+=Graphics.fadeOut?-Graphics.tickerStep:Graphics.tickerStep,a()},8.3333),b()},stop:function(){window.cancelAnimationFrame(d),clearInterval(e)}}}(),hero=function(){function a(){hero.invincible&&--hero.invincibleTimer,hero.invincibleTimer<=0&&(hero.invincible=!1,hero.invincibleTimer=hero.invincibleTimer0),hero.health<=0&&!game.over&&utils.deathSequence()}function b(){var a={x:0,y:0};if(hero.isCarrying&&0===hero.vX)a=j.playerDown;else if(hero.onLadder)a=j.playerUp;else if(hero.dir===Dir.RIGHT||hero.dir===Dir.LEFT){var b=hero.dir===Dir.RIGHT,c="player"+(b?"Right":"Left");if(b&&hero.vX>0||!b&&hero.vX<0){var d=game.totalTicks%60;a=hero.isOnObj?Math.abs(hero.vX)<=10*hero.aX?j[c+"_Step"]:d>=0&&20>d?j[c+"_Run1"]:d>=20&&40>d?j[c+"_Run2"]:j[c+"_Run3"]:j[c+"_Run1"]}else a=j[c]}if(hero.onLadder||0!==hero.vX||0!==hero.vY?i=0:++i,i>210){var e=i%200;e>=0&&50>=e||e>100&&150>=e||hero.isCarrying?a=j.playerDown:e>50&&100>=e?a=j.playerDown_breatheIn:e>150&&200>=e&&(a=j.playerDown_breatheOut)}var f=hero.invincibleTimer%40;hero.invincible&&f>=0&&16>=f&&(a={x:-1,y:-1}),hero.sx=a.x,hero.sy=a.y}function c(){g&&hero.sx>=0&&hero.sy>=0&&ctx.drawImage(h,hero.sx,hero.sy,hero.w,hero.h,hero.pos.x,hero.pos.y,hero.w,hero.h)}function d(){hero.isCarrying&&hero.curItem.draw()}var e=null,f=null,g=!1,h=null,i=0,j=[];return{sx:0,sy:0,lvlX:0,w:28,h:38,vX:0,vY:0,aX:.17,aY:.52,jumpMod:4,jumpMod0:4,dir:Dir.RIGHT,isJumping:!1,isCarrying:!1,onLadder:!1,curItem:null,isOnObj:!0,invincible:!1,invincibleTimer:240,invincibleTimer0:240,health:4,maxHealth:5,medKits:1,healthLvl:1,mana:0,maxMana:4,manaKits:1,manaLvl:1,ammo:20,cash:0,lvl:1,xp:0,xpNeeded:50,bulletArr:[],physics:null,init:function(){h=new Image,h.onload=function(){g=!0},h.src="../dungeon/web/img/sprites/player/player.png",$.get("../dungeon/web/img/sprites/player/player.xml",function(a){var b=$(a).find("sprite");$(b).each(function(){var a=$(this).attr("n"),b=$(this).attr("x"),c=$(this).attr("y");a=a.substring(0,a.length-4),j[a]={x:b,y:c}})}),e=HeroInputComponent(),e.init(),hero.physics=HeroPhysicsComponent(),f=HeroGraphicsComponent(),f.init(),$.extend(hero,new SAT.Box(new SAT.Vector(0,0),hero.w,hero.h).toPolygon())},update:function(){e.check(),hero.physics.updatePosition(),hero.physics.checkCollision(),a(),b()},render:function(){c(),f.drawBullets(),d()}}}(),HeroGraphicsComponent=function(){var a=null,b=!1;return{init:function(){a=new Image,a.src="img/shuriken.png",a.onload=function(){b=!0}},drawBullets:function(){for(var b=0;b<hero.bulletArr.length;++b){var c=hero.bulletArr[b].dirR?hero.w:0;hero.bulletArr[b].deg+=5,Graphics.drawRotate(a,hero.bulletArr[b].pos.x+c,hero.bulletArr[b].pos.y+20,hero.bulletArr[b].deg)}}}},HeroPhysicsComponent=function(){function a(){for(var a=0;a<hero.bulletArr.length;++a)hero.bulletArr[a].pos.x+=hero.bulletArr[a].dirR?bullet.speed:-bullet.speed,(hero.bulletArr[a].pos.x>FULLW||hero.bulletArr[a].pos.x<0)&&hero.bulletArr.splice(a,1)}function b(){hero.pos.y<-hero.h?(hero.pos.y=-hero.h,hero.vY=0):hero.pos.y>=FULLW&&utils.deathSequence(),hero.pos.x<0?(hero.pos.x=0,hero.vX=0):hero.pos.x>FULLW-hero.w&&(hero.pos.x=FULLW-hero.w,hero.vX=0)}function c(){hero.isOnObj=!1,Physics.lvlObjCollision(hero,function(a){1===a.overlapN.y?(hero.isOnObj=!0,hero.isJumping=!1,hero.vY=0):-1===a.overlapN.y&&(hero.vY=0)}),Physics.lvlItemCollision(function(a,b){1===a.overlapN.y?(hero.pos.y-=a.overlapV.y,hero.isOnObj=!0,hero.isJumping=!1,hero.vY=0):a.b.grabbable&&(a.b.holding=!0,a.b.vY=6.5,a.b.onGround=!1,a.b.isOnObj&&(a.b.isOnObj=!1,a.b.onObj.grabbable=!0,a.b.onObj=null),hero.curItem=a.b,hero.isCarrying=!0,level.items.splice(b,1))})}return{updatePosition:function(){hero.isJumping||hero.onLadder||hero.pos.x===hero.pos.x+hero.vX||audio.step.play(),(hero.dir===Dir.RIGHT&&hero.pos.x>=HALFW+35||hero.dir===Dir.LEFT&&hero.pos.x<=HALFW-45)&&hero.lvlX+hero.vX>=0&&hero.lvlX+hero.vX<=level.curLvl.width-FULLW?(hero.lvlX+=hero.vX,level.updateView()):hero.pos.x+=hero.vX,hero.onLadder||(hero.pos.y+=hero.vY)},checkCollision:function(){a(),b(),c()}}},HeroInputComponent=function(){var a=2.3,b=10;return{init:function(){keysDown={},lastKeyDown=-1,$(document).on("click",".resize",function(){$(this).hasClass("off")?($(this).removeClass("off").addClass("on"),$(this).children("span").removeClass("icon-expand").addClass("icon-contract")):$(this).hasClass("on")&&($(this).removeClass("on").addClass("off"),$(this).children("span").removeClass("icon-contract").addClass("icon-expand")),utils.toggleFullScreen()}),addEventListener("keydown",function(a){32==a.keyCode?a.preventDefault():77==a.keyCode?audio.handleMuteButton():70==a.keyCode?$(".resize").trigger("click"):75!=a.keyCode||hero.isJumping||75==lastKeyDown&&75 in keysDown||!hero.isOnObj?74!=a.keyCode||74==lastKeyDown&&74 in keysDown?a.keyCode==KeyCode.O&&utils.toggleMenu():hero.ammo>0&&!hero.isCarrying&&(audio.play(audio.effort),hero.bulletArr[hero.bulletArr.length]={pos:{x:hero.pos.x,y:hero.pos.y},w:bullet.w,h:bullet.h,dirR:hero.dir===Dir.RIGHT,deg:0},--hero.ammo):(audio.jump.play(),hero.vY=0,hero.isJumping=!0,hero.isOnObj=!1),lastKeyDown=a.keyCode,keysDown[a.keyCode]=!0},!1),addEventListener("keyup",function(a){delete keysDown[a.keyCode]},!1)},check:function(){var c=!1;if(hero.isJumping?hero.jumpMod>0?hero.vY-=hero.aY*hero.jumpMod--:c=!0:(hero.jumpMod=hero.jumpMod0,c=!0),c&&!hero.onLadder){var d=hero.vY+2*game.gravity;hero.vY=d>b?b:d}var e=!1;65 in keysDown&&(hero.vX=Math.abs(hero.vX-hero.aX)>a?-a:hero.vX-hero.aX,hero.dir=Dir.LEFT,e=!0),68 in keysDown&&(hero.vX=Math.abs(hero.vX+hero.aX)>a?a:hero.vX+hero.aX,hero.dir=Dir.RIGHT,e=!0),Math.abs(hero.vX)<hero.aX?hero.vX=0:e||(hero.vX/=1.26),KeyCode.W in keysDown&&hero.onLadder&&--hero.pos.y,KeyCode.S in keysDown&&hero.onLadder&&++hero.pos.y,32 in keysDown&&hero.isCarrying&&(hero.isCarrying=!1,hero.curItem.holding=!1,hero.curItem=null),72 in keysDown&&hero.medKits>0&&hero.health<hero.maxHealth&&(++hero.health,--hero.medKits,audio.play(audio.enchant,!0)),82 in keysDown&&!(17 in keysDown)&&hero.manaKits>0&&hero.mana<hero.maxMana&&(++hero.mana,--hero.manaKits,audio.play(audio.enchant,!0))}}},Main=function(){function a(){canvas=$("canvas")[0],ctx=canvas.getContext("2d"),FULLW=canvas.width,FULLH=canvas.height-game.padHUD,HALFW=FULLW/2,HALFH=FULLH/2}function b(){ctx.fillStyle="#e1e1e1",ctx.font="25px 'Press Start 2P'",ctx.fillText("LOADING...",HALFW-80,HALFH+20)}function c(){"jon"===location.host&&(window.DEBUG=!0,lastKeyDown=KeyCode.ENTER,audio.handleMuteButton())}return{init:function(){a(),b(),hero.init(),audio.init(),level.init(),HUD.init(),$(document).on("fontLoaded",function(){setInterval(function(){++game.actualTime},1e3),game.start()}),c()}}}();$(function(){window.WebFontConfig={google:{families:["Press Start 2P"]},active:function(){$(document).trigger("fontLoaded")},inactive:function(){alert("There was a problem loading a font from google, some text may not render correctly (refreshing the page may fix the issue)."),$(document).trigger("fontLoaded")}},function(){var a=document.createElement("script");a.src="//ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",a.type="text/javascript",a.async="true";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}(),Main.init()});