!function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-43015655-1","jonmann20.github.io"),ga("send","pageview"),function(a,b,c){function d(c,d,e){var f=b.createElement(c);return d&&(f.id=_+d),e&&(f.style.cssText=e),a(f)}function e(){return c.innerHeight?c.innerHeight:a(c).height()}function f(a){var b=y.length,c=(Q+a)%b;return 0>c?b+c:c}function g(a,b){return Math.round((/%/.test(a)?("x"===b?z.width():e())/100:1)*parseInt(a,10))}function h(a,b){return a.photo||a.photoRegex.test(b)}function i(a,b){return a.retinaUrl&&c.devicePixelRatio>1?b.replace(a.photoRegex,a.retinaSuffix):b}function j(a){"contains"in r[0]&&!r[0].contains(a.target)&&(a.stopPropagation(),r.focus())}function k(){var b,c=a.data(P,$);null==c?(K=a.extend({},Z),console&&console.log&&console.log("Error: cboxElement missing settings object")):K=a.extend({},c);for(b in K)a.isFunction(K[b])&&"on"!==b.slice(0,2)&&(K[b]=K[b].call(P));K.rel=K.rel||P.rel||a(P).data("rel")||"nofollow",K.href=K.href||a(P).attr("href"),K.title=K.title||P.title,"string"==typeof K.href&&(K.href=a.trim(K.href))}function l(c,d){a(b).trigger(c),hb.triggerHandler(c),a.isFunction(d)&&d.call(P)}function m(c){U||(P=c,k(),y=a(P),Q=0,"nofollow"!==K.rel&&(y=a("."+ab).filter(function(){var b,c=a.data(this,$);return c&&(b=a(this).data("rel")||c.rel||this.rel),b===K.rel}),Q=y.index(P),-1===Q&&(y=y.add(P),Q=y.length-1)),q.css({opacity:parseFloat(K.opacity),cursor:K.overlayClose?"pointer":"auto",visibility:"visible"}).show(),X&&r.add(q).removeClass(X),K.className&&r.add(q).addClass(K.className),X=K.className,K.closeButton?I.html(K.close).appendTo(t):I.appendTo("<div/>"),S||(S=T=!0,r.css({visibility:"hidden",display:"block"}),A=d(ib,"LoadedContent","width:0; height:0; overflow:hidden"),t.css({width:"",height:""}).append(A),L=u.height()+x.height()+t.outerHeight(!0)-t.height(),M=v.width()+w.width()+t.outerWidth(!0)-t.width(),N=A.outerHeight(!0),O=A.outerWidth(!0),K.w=g(K.initialWidth,"x"),K.h=g(K.initialHeight,"y"),A.css({width:"",height:K.h}),W.position(),l(bb,K.onOpen),J.add(D).hide(),r.focus(),K.trapFocus&&b.addEventListener&&(b.addEventListener("focus",j,!0),hb.one(fb,function(){b.removeEventListener("focus",j,!0)})),K.returnFocus&&hb.one(fb,function(){a(P).focus()})),p())}function n(){!r&&b.body&&(Y=!1,z=a(c),r=d(ib).attr({id:$,"class":a.support.opacity===!1?_+"IE":"",role:"dialog",tabindex:"-1"}).hide(),q=d(ib,"Overlay").hide(),C=a([d(ib,"LoadingOverlay")[0],d(ib,"LoadingGraphic")[0]]),s=d(ib,"Wrapper"),t=d(ib,"Content").append(D=d(ib,"Title"),E=d(ib,"Current"),H=a('<button type="button"/>').attr({id:_+"Previous"}),G=a('<button type="button"/>').attr({id:_+"Next"}),F=d("button","Slideshow"),C),I=a('<button type="button"/>').attr({id:_+"Close"}),s.append(d(ib).append(d(ib,"TopLeft"),u=d(ib,"TopCenter"),d(ib,"TopRight")),d(ib,!1,"clear:left").append(v=d(ib,"MiddleLeft"),t,w=d(ib,"MiddleRight")),d(ib,!1,"clear:left").append(d(ib,"BottomLeft"),x=d(ib,"BottomCenter"),d(ib,"BottomRight"))).find("div div").css({"float":"left"}),B=d(ib,!1,"position:absolute; width:9999px; visibility:hidden; display:none; max-width:none;"),J=G.add(H).add(E).add(F),a(b.body).append(q,r.append(s,B)))}function o(){function c(a){a.which>1||a.shiftKey||a.altKey||a.metaKey||a.ctrlKey||(a.preventDefault(),m(this))}return r?(Y||(Y=!0,G.click(function(){W.next()}),H.click(function(){W.prev()}),I.click(function(){W.close()}),q.click(function(){K.overlayClose&&W.close()}),a(b).bind("keydown."+_,function(a){var b=a.keyCode;S&&K.escKey&&27===b&&(a.preventDefault(),W.close()),S&&K.arrowKey&&y[1]&&!a.altKey&&(37===b?(a.preventDefault(),H.click()):39===b&&(a.preventDefault(),G.click()))}),a.isFunction(a.fn.on)?a(b).on("click."+_,"."+ab,c):a("."+ab).live("click."+_,c)),!0):!1}function p(){var e,f,j,m=W.prep,n=++jb;T=!0,R=!1,P=y[Q],k(),l(gb),l(cb,K.onLoad),K.h=K.height?g(K.height,"y")-N-L:K.innerHeight&&g(K.innerHeight,"y"),K.w=K.width?g(K.width,"x")-O-M:K.innerWidth&&g(K.innerWidth,"x"),K.mw=K.w,K.mh=K.h,K.maxWidth&&(K.mw=g(K.maxWidth,"x")-O-M,K.mw=K.w&&K.w<K.mw?K.w:K.mw),K.maxHeight&&(K.mh=g(K.maxHeight,"y")-N-L,K.mh=K.h&&K.h<K.mh?K.h:K.mh),e=K.href,V=setTimeout(function(){C.show()},100),K.inline?(j=d(ib).hide().insertBefore(a(e)[0]),hb.one(gb,function(){j.replaceWith(A.children())}),m(a(e))):K.iframe?m(" "):K.html?m(K.html):h(K,e)?(e=i(K,e),R=b.createElement("img"),a(R).addClass(_+"Photo").bind("error",function(){K.title=!1,m(d(ib,"Error").html(K.imgError))}).one("load",function(){var b;n===jb&&(a.each(["alt","longdesc","aria-describedby"],function(b,c){var d=a(P).attr(c)||a(P).attr("data-"+c);d&&R.setAttribute(c,d)}),K.retinaImage&&c.devicePixelRatio>1&&(R.height=R.height/c.devicePixelRatio,R.width=R.width/c.devicePixelRatio),K.scalePhotos&&(f=function(){R.height-=R.height*b,R.width-=R.width*b},K.mw&&R.width>K.mw&&(b=(R.width-K.mw)/R.width,f()),K.mh&&R.height>K.mh&&(b=(R.height-K.mh)/R.height,f())),K.h&&(R.style.marginTop=Math.max(K.mh-R.height,0)/2+"px"),y[1]&&(K.loop||y[Q+1])&&(R.style.cursor="pointer",R.onclick=function(){W.next()}),R.style.width=R.width+"px",R.style.height=R.height+"px",setTimeout(function(){m(R)},1))}),setTimeout(function(){R.src=e},1)):e&&B.load(e,K.data,function(b,c){n===jb&&m("error"===c?d(ib,"Error").html(K.xhrError):a(this).contents())})}var q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z={html:!1,photo:!1,iframe:!1,inline:!1,transition:"elastic",speed:300,fadeOut:300,width:!1,initialWidth:"600",innerWidth:!1,maxWidth:!1,height:!1,initialHeight:"450",innerHeight:!1,maxHeight:!1,scalePhotos:!0,scrolling:!0,href:!1,title:!1,rel:!1,opacity:.9,preloading:!0,className:!1,overlayClose:!0,escKey:!0,arrowKey:!0,top:!1,bottom:!1,left:!1,right:!1,fixed:!1,data:void 0,closeButton:!0,fastIframe:!0,open:!1,reposition:!0,loop:!0,slideshow:!1,slideshowAuto:!0,slideshowSpeed:2500,slideshowStart:"start slideshow",slideshowStop:"stop slideshow",photoRegex:/\.(gif|png|jp(e|g|eg)|bmp|ico|webp)((#|\?).*)?$/i,retinaImage:!1,retinaUrl:!1,retinaSuffix:"@2x.$1",current:"image {current} of {total}",previous:"previous",next:"next",close:"close",xhrError:"This content failed to load.",imgError:"This image failed to load.",returnFocus:!0,trapFocus:!0,onOpen:!1,onLoad:!1,onComplete:!1,onCleanup:!1,onClosed:!1},$="colorbox",_="cbox",ab=_+"Element",bb=_+"_open",cb=_+"_load",db=_+"_complete",eb=_+"_cleanup",fb=_+"_closed",gb=_+"_purge",hb=a("<a/>"),ib="div",jb=0,kb={},lb=function(){function a(){clearTimeout(g)}function b(){(K.loop||y[Q+1])&&(a(),g=setTimeout(W.next,K.slideshowSpeed))}function c(){F.html(K.slideshowStop).unbind(i).one(i,d),hb.bind(db,b).bind(cb,a),r.removeClass(h+"off").addClass(h+"on")}function d(){a(),hb.unbind(db,b).unbind(cb,a),F.html(K.slideshowStart).unbind(i).one(i,function(){W.next(),c()}),r.removeClass(h+"on").addClass(h+"off")}function e(){f=!1,F.hide(),a(),hb.unbind(db,b).unbind(cb,a),r.removeClass(h+"off "+h+"on")}var f,g,h=_+"Slideshow_",i="click."+_;return function(){f?K.slideshow||(hb.unbind(eb,e),e()):K.slideshow&&y[1]&&(f=!0,hb.one(eb,e),K.slideshowAuto?c():d(),F.show())}}();a.colorbox||(a(n),W=a.fn[$]=a[$]=function(b,c){var d=this;if(b=b||{},n(),o()){if(a.isFunction(d))d=a("<a/>"),b.open=!0;else if(!d[0])return d;c&&(b.onComplete=c),d.each(function(){a.data(this,$,a.extend({},a.data(this,$)||Z,b))}).addClass(ab),(a.isFunction(b.open)&&b.open.call(d)||b.open)&&m(d[0])}return d},W.position=function(b,c){function d(){u[0].style.width=x[0].style.width=t[0].style.width=parseInt(r[0].style.width,10)-M+"px",t[0].style.height=v[0].style.height=w[0].style.height=parseInt(r[0].style.height,10)-L+"px"}var f,h,i,j=0,k=0,l=r.offset();if(z.unbind("resize."+_),r.css({top:-9e4,left:-9e4}),h=z.scrollTop(),i=z.scrollLeft(),K.fixed?(l.top-=h,l.left-=i,r.css({position:"fixed"})):(j=h,k=i,r.css({position:"absolute"})),k+=K.right!==!1?Math.max(z.width()-K.w-O-M-g(K.right,"x"),0):K.left!==!1?g(K.left,"x"):Math.round(Math.max(z.width()-K.w-O-M,0)/2),j+=K.bottom!==!1?Math.max(e()-K.h-N-L-g(K.bottom,"y"),0):K.top!==!1?g(K.top,"y"):Math.round(Math.max(e()-K.h-N-L,0)/2),r.css({top:l.top,left:l.left,visibility:"visible"}),s[0].style.width=s[0].style.height="9999px",f={width:K.w+O+M,height:K.h+N+L,top:j,left:k},b){var m=0;a.each(f,function(a){return f[a]!==kb[a]?(m=b,void 0):void 0}),b=m}kb=f,b||r.css(f),r.dequeue().animate(f,{duration:b||0,complete:function(){d(),T=!1,s[0].style.width=K.w+O+M+"px",s[0].style.height=K.h+N+L+"px",K.reposition&&setTimeout(function(){z.bind("resize."+_,W.position)},1),c&&c()},step:d})},W.resize=function(a){var b;S&&(a=a||{},a.width&&(K.w=g(a.width,"x")-O-M),a.innerWidth&&(K.w=g(a.innerWidth,"x")),A.css({width:K.w}),a.height&&(K.h=g(a.height,"y")-N-L),a.innerHeight&&(K.h=g(a.innerHeight,"y")),a.innerHeight||a.height||(b=A.scrollTop(),A.css({height:"auto"}),K.h=A.height()),A.css({height:K.h}),b&&A.scrollTop(b),W.position("none"===K.transition?0:K.speed))},W.prep=function(c){function e(){return K.w=K.w||A.width(),K.w=K.mw&&K.mw<K.w?K.mw:K.w,K.w}function g(){return K.h=K.h||A.height(),K.h=K.mh&&K.mh<K.h?K.mh:K.h,K.h}if(S){var j,k="none"===K.transition?0:K.speed;A.empty().remove(),A=d(ib,"LoadedContent").append(c),A.hide().appendTo(B.show()).css({width:e(),overflow:K.scrolling?"auto":"hidden"}).css({height:g()}).prependTo(t),B.hide(),a(R).css({"float":"none"}),j=function(){function c(){a.support.opacity===!1&&r[0].style.removeAttribute("filter")}var e,g,j=y.length,m="frameBorder",n="allowTransparency";S&&(g=function(){clearTimeout(V),C.hide(),l(db,K.onComplete)},D.html(K.title).add(A).show(),j>1?("string"==typeof K.current&&E.html(K.current.replace("{current}",Q+1).replace("{total}",j)).show(),G[K.loop||j-1>Q?"show":"hide"]().html(K.next),H[K.loop||Q?"show":"hide"]().html(K.previous),lb(),K.preloading&&a.each([f(-1),f(1)],function(){var c,d,e=y[this],f=a.data(e,$);f&&f.href?(c=f.href,a.isFunction(c)&&(c=c.call(e))):c=a(e).attr("href"),c&&h(f,c)&&(c=i(f,c),d=b.createElement("img"),d.src=c)})):J.hide(),K.iframe?(e=d("iframe")[0],m in e&&(e[m]=0),n in e&&(e[n]="true"),K.scrolling||(e.scrolling="no"),a(e).attr({src:K.href,name:(new Date).getTime(),"class":_+"Iframe",allowFullScreen:!0,webkitAllowFullScreen:!0,mozallowfullscreen:!0}).one("load",g).appendTo(A),hb.one(gb,function(){e.src="//about:blank"}),K.fastIframe&&a(e).trigger("load")):g(),"fade"===K.transition?r.fadeTo(k,1,c):c())},"fade"===K.transition?r.fadeTo(k,0,function(){W.position(0,j)}):W.position(k,j)}},W.next=function(){!T&&y[1]&&(K.loop||y[Q+1])&&(Q=f(1),m(y[Q]))},W.prev=function(){!T&&y[1]&&(K.loop||Q)&&(Q=f(-1),m(y[Q]))},W.close=function(){S&&!U&&(U=!0,S=!1,l(eb,K.onCleanup),z.unbind("."+_),q.fadeTo(K.fadeOut||0,0),r.stop().fadeTo(K.fadeOut||0,0,function(){r.add(q).css({opacity:1,cursor:"auto"}).hide(),l(gb),A.empty().remove(),setTimeout(function(){U=!1,l(fb,K.onClosed)},1)}))},W.remove=function(){r&&(r.stop(),a.colorbox.close(),r.stop().remove(),q.remove(),U=!1,r=null,a("."+ab).removeData($).removeClass(ab),a(b).unbind("click."+_))},W.element=function(){return a(P)},W.settings=Z)}(jQuery,document,window);var SAT=window.SAT={};!function(a){"use strict";var b=function(a,b){this.x=this.x=a||0,this.y=this.y=b||0};a.Vector=b,a.V=b,b.prototype.copy=function(a){return this.x=a.x,this.y=a.y,this},b.prototype.copy=b.prototype.copy,b.prototype.perp=function(){var a=this.x;return this.x=this.y,this.y=-a,this},b.prototype.perp=b.prototype.perp,b.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this},b.prototype.reverse=b.prototype.reverse,b.prototype.normalize=function(){var a=this.len();return a>0&&(this.x=this.x/a,this.y=this.y/a),this},b.prototype.normalize=b.prototype.normalize,b.prototype.add=function(a){return this.x+=a.x,this.y+=a.y,this},b.prototype.add=b.prototype.add,b.prototype.sub=function(a){return this.x-=a.x,this.y-=a.y,this},b.prototype.sub=b.prototype.sub,b.prototype.scale=function(a,b){return this.x*=a,this.y*=b||a,this},b.prototype.scale=b.prototype.scale,b.prototype.project=function(a){var b=this.dot(a)/a.len2();return this.x=b*a.x,this.y=b*a.y,this},b.prototype.project=b.prototype.project,b.prototype.projectN=function(a){var b=this.dot(a);return this.x=b*a.x,this.y=b*a.y,this},b.prototype.projectN=b.prototype.projectN,b.prototype.reflect=function(a){var b=this.x,c=this.y;return this.project(a).scale(2),this.x-=b,this.y-=c,this},b.prototype.reflect=b.prototype.reflect,b.prototype.reflectN=function(a){var b=this.x,c=this.y;return this.projectN(a).scale(2),this.x-=b,this.y-=c,this},b.prototype.relectN=b.prototype.reflectN,b.prototype.dot=function(a){return this.x*a.x+this.y*a.y},b.prototype.dot=b.prototype.dot,b.prototype.len2=function(){return this.dot(this)},b.prototype.len2=b.prototype.len2,b.prototype.len=function(){return Math.sqrt(this.len2())},b.prototype.len=b.prototype.len;var c=function(a,c){this.pos=this.pos=a||new b,this.r=this.r=c||0};a.Circle=c;var d=function(a,c){this.pos=this.pos=a||new b,this.points=this.points=c||[],this.recalc()};a.Polygon=d,d.prototype.recalc=function(){var a=this.points,c=a.length;this.edges=[],this.normals=[];for(var d=0;c>d;d++){var e=a[d],f=c-1>d?a[d+1]:a[0],g=(new b).copy(f).sub(e),h=(new b).copy(g).perp().normalize();this.edges.push(g),this.normals.push(h)}},d.prototype.recalc=d.prototype.recalc;var e=function(a,c,d){this.pos=this.pos=a||new b,this.w=this.w=c||0,this.h=this.h=d||0};a.Box=e,e.prototype.toPolygon=function(){var a=this.pos,c=this.w,e=this.h;return new d(new b(a.x,a.y),[new b,new b(c,0),new b(c,e),new b(0,e)])},e.prototype.toPolygon=e.prototype.toPolygon;for(var f=[],g=0;10>g;g++)f.push(new b);for(var h=[],g=0;5>g;g++)h.push([]);var i=function(){this.a=this.a=null,this.b=this.b=null,this.overlapN=this.overlapN=new b,this.overlapV=this.overlapV=new b,this.clear()};a.Response=i,i.prototype.clear=function(){return this.aInB=this.aInB=!0,this.bInA=this.bInA=!0,this.overlap=this.overlap=Number.MAX_VALUE,this},i.prototype.clear=i.prototype.clear;var j=function(a,b,c){for(var d=Number.MAX_VALUE,e=-Number.MAX_VALUE,f=a.length,g=0;f>g;g++){var h=a[g].dot(b);d>h&&(d=h),h>e&&(e=h)}c[0]=d,c[1]=e},k=function(a,b,c,d,e,g){var i=h.pop(),k=h.pop(),l=f.pop().copy(b).sub(a),m=l.dot(e);if(j(c,e,i),j(d,e,k),k[0]+=m,k[1]+=m,i[0]>k[1]||k[0]>i[1])return f.push(l),h.push(i),h.push(k),!0;if(g){var n=0;if(i[0]<k[0])if(g.aInB=!1,i[1]<k[1])n=i[1]-k[0],g.bInA=!1;else{var o=i[1]-k[0],p=k[1]-i[0];n=p>o?o:-p}else if(g.bInA=!1,i[1]>k[1])n=i[0]-k[1],g.aInB=!1;else{var o=i[1]-k[0],p=k[1]-i[0];n=p>o?o:-p}var q=Math.abs(n);q<g.overlap&&(g.overlap=q,g.overlapN.copy(e),0>n&&g.overlapN.reverse())}return f.push(l),h.push(i),h.push(k),!1},l=function(a,b){var c=a.len2(),d=b.dot(a);return 0>d?m:d>c?o:n},m=-1,n=0,o=1,p=function(a,b,c){var d=f.pop().copy(b.pos).sub(a.pos),e=a.r+b.r,g=e*e,h=d.len2();if(h>g)return f.push(d),!1;if(c){var i=Math.sqrt(h);c.a=a,c.b=b,c.overlap=e-i,c.overlapN.copy(d.normalize()),c.overlapV.copy(d).scale(c.overlap),c.aInB=a.r<=b.r&&i<=b.r-a.r,c.bInA=b.r<=a.r&&i<=a.r-b.r}return f.push(d),!0};a.testCircleCircle=p;var q=function(a,b,c){for(var d=f.pop().copy(b.pos).sub(a.pos),e=b.r,g=e*e,h=a.points,i=h.length,j=f.pop(),k=f.pop(),n=0;i>n;n++){var p=n===i-1?0:n+1,q=0===n?i-1:n-1,r=0,s=null;j.copy(a.edges[n]),k.copy(d).sub(h[n]),c&&k.len2()>g&&(c.aInB=!1);var t=l(j,k);if(t===m){j.copy(a.edges[q]);var u=f.pop().copy(d).sub(h[q]);if(t=l(j,u),t===o){var v=k.len();if(v>e)return f.push(d),f.push(j),f.push(k),f.push(u),!1;c&&(c.bInA=!1,s=k.normalize(),r=e-v)}f.push(u)}else if(t===o){if(j.copy(a.edges[p]),k.copy(d).sub(h[p]),t=l(j,k),t===m){var v=k.len();if(v>e)return f.push(d),f.push(j),f.push(k),!1;c&&(c.bInA=!1,s=k.normalize(),r=e-v)}}else{var w=j.perp().normalize(),v=k.dot(w),x=Math.abs(v);if(v>0&&x>e)return f.push(d),f.push(w),f.push(k),!1;c&&(s=w,r=e-v,(v>=0||2*e>r)&&(c.bInA=!1))}s&&c&&Math.abs(r)<Math.abs(c.overlap)&&(c.overlap=r,c.overlapN.copy(s))}return c&&(c.a=a,c.b=b,c.overlapV.copy(c.overlapN).scale(c.overlap)),f.push(d),f.push(j),f.push(k),!0};a.testPolygonCircle=q;var r=function(a,b,c){var d=q(b,a,c);if(d&&c){var e=c.a,f=c.aInB;c.overlapN.reverse(),c.overlapV.reverse(),c.a=c.b,c.b=e,c.aInB=c.bInA,c.bInA=f}return d};a.testCirclePolygon=r;var s=function(a,b,c){for(var d=a.points,e=d.length,f=b.points,g=f.length,h=0;e>h;h++)if(k(a.pos,b.pos,d,f,a.normals[h],c))return!1;for(var h=0;g>h;h++)if(k(a.pos,b.pos,d,f,b.normals[h],c))return!1;return c&&(c.a=a,c.b=b,c.overlapV.copy(c.overlapN).scale(c.overlap)),!0};a.testPolygonPolygon=s}(SAT);var utils=function(){var a;return{degToRad:function(a){return.017453292519943295*a},printMouse:function(){$("canvas").on("mousemove",function(a){console.log(a.offsetX,a.offsetY)})},printDir:function(a){switch(a){case 0:console.log("Dir.NONE");break;case 1:console.log("Dir.TOP");break;case 2:console.log("Dir.BOT");break;case 3:console.log("Dir.LEFT");break;case 4:console.log("Dir.RIGHT");break;case 5:console.log("Dir.IN");break;default:console.log("Dir.unknown")}},toggleMenu:function(){"block"===$("#colorbox").css("display")?a.colorbox.close():a=$.colorbox({html:$(".gameInstructions").html(),width:250,height:460})}}}(),Dir=Object.freeze({NONE:0,TOP:1,BOT:2,LEFT:3,RIGHT:4,IN:5}),Inv_e=Object.freeze({NOT_HIT:0,HIT_WHITE:1,HIT_RED:2}),KeyCode=Object.freeze({ENTER:13,J:74,K:75,O:79}),Color=Object.freeze({LIGHT_BROWN:"#c44525",DARK_BROWN:"#672819",LIGHT_GREEN:"#166a38"}),bullet={color:"rgba(0, 182, 255, .85)",w:19.5,h:9,speed:3.3};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(a){setTimeout(a,16.6666666667)}}();var audio=function(){return{bgMusic:new Audio("audio/firstChiptune/firstChiptune.mp3"),enterSound:new Audio("audio/synthetic_explosion_1.mp3"),itemPickedUp:new Audio("audio/life_pickup.mp3"),heartbeat:new Audio("audio/heartbeat.mp3"),jump:new Audio("audio/jump.mp3"),thud:new Audio("audio/thud.mp3"),step:new Audio("audio/step.mp3"),effort:new Audio("audio/woosh.mp3"),discovery:new Audio("audio/spell3.mp3"),enemyDeath:new Audio("audio/death.mp3"),heroDeath:new Audio("audio/DiscsOfTron_Cascade.mp3"),enchant:new Audio("audio/enchant.mp3"),isOn:!1,play:function(a,b){b="undefined"!=typeof b?b:!0,a.ended?a.play():(b||0===a.currentTime)&&(a.pause(),a.currentTime=0,a.play())},handleMuteButton:function(){$(".audioState").hasClass("off")?($(".audioState span").removeClass("icon-volume-mute").addClass("icon-volume-medium"),$(".audioState").removeClass("off"),$(".audioState").addClass("on"),audio.mute(!1)):($(".audioState span").removeClass("icon-volume-medium").addClass("icon-volume-mute"),$(".audioState").removeClass("on"),$(".audioState").addClass("off"),audio.mute(!0))},mute:function(a){audio.discovery.muted=audio.enterSound.muted=audio.bgMusic.muted=audio.itemPickedUp.muted=audio.heartbeat.muted=audio.effort.muted=audio.thud.muted=audio.jump.muted=audio.step.muted=audio.enemyDeath.muted=audio.heroDeath.muted=audio.enchant.muted=a,a?audio.bgMusic.pause():audio.bgMusic.play(),audio.isOn=!a}}}(),Graphics=function(){var a=1;return{ticker:1,tickerStep:.01,fadeOut:!1,blinkText:function(b,c,d,e){e="undefined"!=typeof e?e:"PRESS ENTER",(Graphics.ticker>=1.35||Graphics.ticker<=Graphics.tickerStep)&&(Graphics.fadeOut=!Graphics.fadeOut),a=Graphics.ticker>=1?1:Graphics.ticker<=Graphics.tickerStep?0:Graphics.ticker,ctx.font=b+"px 'Press Start 2P'";var f=ctx.measureText(e).width;ctx.fillStyle="rgba(233, 233, 233,"+a+")",ctx.fillText(e,c-f/2,d)},drawPlatform:function(a,b,c,d){ctx.fillStyle=Color.LIGHT_BROWN,ctx.fillRect(a,b,c,1),ctx.fillStyle=Color.DARK_BROWN,ctx.fillRect(a,b+1,c,d-1)},drawDoor:function(a,b,c,d){ctx.fillStyle=Color.LIGHT_BROWN,ctx.fillRect(a+2,b+2,c-2,d-2),ctx.fillStyle=Color.DARK_BROWN,ctx.fillRect(a,b,2,d),ctx.fillRect(a,b,c,2),ctx.fillRect(a+c,b,2,d),ctx.beginPath(),ctx.arc(a+c-c/3.2,b+d-d/3.4,3,0,2*Math.PI,!1),ctx.fill(),ctx.closePath(),ctx.fillStyle="#e1e1e1",ctx.font="12px 'Press Start 2P'",ctx.fillText("EXIT",a-7,b-5)},drawEllipse:function(a,b,c,d){var e=.5522848,f=c/2*e,g=d/2*e,h=a+c,i=b+d,j=a+c/2,k=b+d/2;ctx.beginPath(),ctx.moveTo(a,k),ctx.bezierCurveTo(a,k-g,j-f,b,j,b),ctx.bezierCurveTo(j+f,b,h,k-g,h,k),ctx.bezierCurveTo(h,k+g,j+f,i,j,i),ctx.bezierCurveTo(j-f,i,a,k+g,a,k),ctx.closePath(),ctx.fill()},drawRotate:function(a,b,c,d){ctx.save(),ctx.translate(b,c),ctx.rotate(utils.degToRad(d)),ctx.translate(.5*-a.width,.5*-a.height),ctx.drawImage(a,0,0),ctx.restore()}}}(),Physics=function(){return{isCollision:function(a,b,c,d){var e="undefined"!=typeof d?a.x+a.lvlX:a.x;return e+c<=b.x+b.w&&b.x+c<=e+a.w&&a.y+c<=b.y+b.h&&b.y+c<=a.y+a.h?!0:!1},lvlObjCollision:function(a,b){"undefined"!=typeof a.pos&&(a.pos.x=a.x,a.pos.y=a.y);for(var c=new SAT.Response,d=0;d<level.objs.length;++d)if("undefined"!=typeof level.objs[d].pos){var e=SAT.testPolygonPolygon(a,level.objs[d],c);if(e){c.a.x=c.a.pos.x-c.overlapV.x,c.a.y=c.a.pos.y-c.overlapV.y,"undefined"!=typeof level.objs[d].item_t&&(c.item_t=level.objs[d].item_t),b(c);break}c.clear()}},isSATcollision:function(a,b,c){a.pos.x=a.x,a.pos.y=a.y,b.pos.x=b.x,b.pos.y=b.y;var d=new SAT.Response,e=SAT.testPolygonPolygon(a,b,d);e&&c(d)}}}(),GameObj=function(a,b,c,d,e){var f=null,g=!1;return"undefined"!=typeof e&&(f=new Image,f.onload=function(){g=!0},f.src=e),{initX:a,x:a,initY:b,y:b,w:c,h:d,vY:0,onGround:!1,updatePos:function(){this.y<FULLH-game.padFloor-this.h?(this.y+=this.vY,this.onGround=!1):(this.y=FULLH-game.padFloor-this.h,this.onGround=!0)},draw:function(){g?ctx.drawImage(f,this.x,this.y):(ctx.fillStyle="red",ctx.fillRect(this.x,this.y,this.w,this.h))}}},GameItem=function(){function a(){return function(){this.visible&&!this.collected&&b.apply(this)}}var b=null;return{collected:!1,holding:!1,visible:!0,val:-1,init:function(c,d,e,f){$.extend(this,c),"undefined"!=typeof d&&(this.val=d),"undefined"!=typeof e&&(this.visible=e),"undefined"!=typeof f&&f===!0&&$.extend(this,new SAT.Box(new SAT.Vector(this.x,this.y),this.w,this.h).toPolygon()),b=this.draw,this.draw=a()}}},Enemy=function(){function a(a){var b=a.w/d*a.health;ctx.fillStyle="red",ctx.fillRect(a.x,a.y-12,b,4)}function b(){return function(){(e||f)&&(d>1&&a(this),ctx.save(),f&&(ctx.globalAlpha=.3),c.apply(this),ctx.restore())}}var c=null,d=0,e=!0,f=!1,g=!0;return{active:!1,health:0,deadOffScreen:!1,init:function(a,e){$.extend(this,a),"undefined"!=typeof e&&(this.health=d=e),c=this.draw,this.draw=b()},update:function(){if(f)this.x+=g?2:-2,this.y-=9,(this.x<0||this.x>FULLW)&&(f=!1,this.deadOffScreen=!0);else{if(!e)return;this.active&&game.totalTicks%3===0&&(this.x<hero.x?++this.x:this.x>hero.x&&--this.x)}},death:function(){g=hero.dir==Dir.RIGHT,audio.enemyDeath.play(),hero.xp+=2,e=!1,f=!0}}},startScreen=function(){function a(){lastKeyDown==KeyCode.ENTER&&(++game.lvl,audio.enterSound.play(),audio.bgMusic.pause(),setTimeout(function(){audio.bgMusic=new Audio("audio/inspiredBySparkMan/sparkBoy.mp3"),audio.bgMusic.loop=!0,audio.bgMusic.volume=.45,audio.isOn?audio.bgMusic.play():audio.bgMusic.pause()},1e3),clearInterval(f),cancelAnimationFrame(g),game.start())}function b(){g=requestAnimFrame(b),ctx.fillStyle="#000",ctx.fillRect(0,0,FULLW,FULLH+game.padHUD),ctx.font="29px 'Press Start 2P'";var a=HALFW-ctx.measureText(c).width/2+11,f=58;ctx.setTransform(1,0,-.4,1.4,0,0),ctx.fillStyle="#222",ctx.fillText("J",a+4,f+3),ctx.fillStyle="#ff6a00",ctx.fillText("J",a,f),ctx.setTransform(1,0,-.2,1.4,0,0),ctx.fillStyle="#222",ctx.fillText("O",a+32,f+3),ctx.fillStyle="#ff6a00",ctx.fillText("O",a+28,f),ctx.setTransform(1,0,.05,1.41,0,-1),ctx.fillStyle="#222",ctx.fillText("N",a+58,f+3),ctx.fillStyle="#ff6a00",ctx.fillText("N",a+54,f),ctx.setTransform(1,0,.23,1.4,0,0),ctx.fillStyle="#222",ctx.fillText("'",a+78,f+3),ctx.fillStyle="#ff6a00",ctx.fillText("'",a+74,f),ctx.setTransform(1,0,.42,1.4,0,0),ctx.fillStyle="#222",ctx.fillText("S",a+95,f+3),ctx.fillStyle="#ff6a00",ctx.fillText("S",a+91,f),ctx.font="36px 'Press Start 2P'",a=HALFW-ctx.measureText(d).width/2+30,f=98,ctx.setTransform(1,0,-.5,1.6,0,0),ctx.fillStyle="#222",ctx.fillText("Q",a+4,f+3),ctx.fillStyle="#ff6a00",ctx.fillText("Q",a,f),ctx.setTransform(1,0,-.25,1.6,0,0),ctx.fillStyle="#222",ctx.fillText("U",a+26,f+3),ctx.fillStyle="#ff6a00",ctx.fillText("U",a+22,f),ctx.setTransform(1,0,.03,1.6,0,0),ctx.fillStyle="#222",ctx.fillText("E",a+50,f+3),ctx.fillStyle="#ff6a00",ctx.fillText("E",a+46,f),ctx.setTransform(1,0,.25,1.6,0,0),ctx.fillStyle="#222",ctx.fillText("S",a+74,f+3),ctx.fillStyle="#ff6a00",ctx.fillText("S",a+70,f),ctx.setTransform(1,0,.5,1.6,0,0),ctx.fillStyle="#222",ctx.fillText("T",a+90,f+4),ctx.fillStyle="#ff6a00",ctx.fillText("T",a+86,f),ctx.setTransform(1,0,0,1,0,0),Graphics.blinkText(22,HALFW,HALFH+81),ctx.font="13px 'Press Start 2P'",ctx.fillStyle="#ddd",ctx.fillText(e,HALFW-ctx.measureText(e).width/2,FULLH+44)}var c="JON'S",d="QUEST",e=String.fromCharCode("169")+" 2013 JON WIEDMANN",f=null,g=null;return{start:function(){f=setInterval(function(){Graphics.ticker+=Graphics.fadeOut?-Graphics.tickerStep:Graphics.tickerStep,a()},game.updateFPS),b()}}}(),level=function(){function a(){ctx.fillStyle="#070707",ctx.fillRect(0,FULLH,FULLW,game.padHUD),ctx.fillStyle="#ddd",ctx.font="12px 'Press Start 2P'",ctx.fillText("HP-"+hero.healthLvl,15,FULLH+24),ctx.fillText("MP-"+hero.manaLvl,15,FULLH+48),ctx.fillText("XP",15,FULLH+71),ctx.fillText(hero.medKits,210,FULLH+50),g.draw(),ctx.fillText(hero.manaKits,315,FULLH+50),f.draw(),ctx.fillText(hero.ammo,410,FULLH+50),d.draw(),ctx.fillText(hero.cash,515,FULLH+50),e.draw();var a=Math.floor(game.actualTime/60),b=game.actualTime%60;10>b&&(b="0"+b),10>a&&(a="0"+a),ctx.fillText(a+":"+b,FULLW-84,FULLH+34)}function b(a,b){var c=0;for(var d in a)"none"!==a[d]&&(j[d]=new Image,j[d].onload=function(){b(this.num)},j[d].src=a[d],j[d].num=c),++c}function c(){ctx.fillStyle="orange";for(var a=0;a<level.objs.length;++a)"undefined"!=typeof level.objs[a].pos&&Graphics.drawPlatform(level.objs[a].pos.x,level.objs[a].pos.y,level.objs[a].edges[0].x,level.objs[a].edges[1].y)}var d=null,e=null,f=null,g=null,h=5,i=new Array(h),j={};return{objs:[],items:[],width:0,init:function(){g=GameObj(238,FULLH+31,25,24,"img/medKit.png"),f=GameObj(342,FULLH+31,25,25,"img/syringe.png"),d=GameObj(447,FULLH+32,24,24,"img/shuriken.png"),e=GameObj(548,FULLH+33,22,24,"img/cash.png");for(var a=0;h>a;++a)i[a]={status:!1,bgColor:"#"+Math.floor(16777215*Math.random()).toString(16)};b({lvl0:"img/lvl0.jpg",lvl1:"none"},function(a){i[a].status=!0}),level.reset(),lvl0.init()},reset:function(){level.width=3198,hero.x=23,hero.y=canvas.height-hero.h,hero.isJumping=!1,hero.bulletArr.length=0},update:function(){switch(game.lvl){case 0:lvl0.update()}},updateObjs:function(){for(var a=0;a<level.objs.length;++a)"undefined"!=typeof level.objs[a].pos?level.objs[a].pos.x-=hero.vX:level.objs[a].x-=hero.vX;lvl0.crate.x-=hero.vX},render:function(){switch(ctx.fillStyle=Color.LIGHT_GREEN,ctx.fillRect(0,0,FULLW,FULLH),Graphics.drawPlatform(0,FULLH-game.padFloor-1,FULLW,game.padFloor+1),a(),game.lvl){case 0:lvl0.render()}c()},drawAfterHero:function(){0===game.lvl&&lvl0.crate.holding&&lvl0.crate.draw()}}}(),lvl0=function(){function a(){if(lvl0.crate.holding)lvl0.crate.x=hero.dir==Dir.RIGHT?hero.x+22:hero.x-22,lvl0.crate.y=hero.y;else{Physics.lvlObjCollision(lvl0.crate,function(a){1===a.overlapN.y&&(lvl0.crate.vY=0,level.items.push(lvl0.crate))});var a=level.items.indexOf(lvl0.crate);0>a&&lvl0.crate.onGround&&level.items.push(lvl0.crate)}lvl0.crate.updatePos()}var b,c,d,e,f;return{init:function(){level.objs.push(new SAT.Box(new SAT.Vector(200,196),267,40).toPolygon(),new SAT.Box(new SAT.Vector(562,290),300,40).toPolygon(),new SAT.Box(new SAT.Vector(600,95),200,40).toPolygon());for(var a={x:1160,y:210,w:0,h:0},g=5,h=17,i=0;15>i;++i)level.objs.push(new SAT.Box(new SAT.Vector(a.x+h*i,a.y-g*i),h+1,50).toPolygon()),a.w+=h,a.h+=g;level.objs.push(new SAT.Box(new SAT.Vector(a.x+a.w,a.y-a.h),200,50).toPolygon()),e=GameItem(),e.init(GameObj(a.x+a.w+155,a.y-a.h-53,25,60,null)),d=GameItem(),d.init(GameObj(680,71,20,24,"img/sack.png"),5),b=Enemy(),b.init(GameObj(1700,FULLH-game.padFloor-38+1,28,38,"img/cyborgBnW.png"),1),c=GameItem(),c.init(GameObj(140,50,22,24,"img/cash.png"),10,!1),lvl0.crate=GameItem(),lvl0.crate.init(GameObj(600,FULLH-game.padFloor-26,24,26,"img/crate.png"),0,!0,!0),lvl0.crate.item_t="crate",f=GameItem(),f.init(GameObj(e.x+330,FULLH-game.padFloor-210,450,210,null),0,!0,!0),level.objs.push(d,b,c,e,f),level.items.push(lvl0.crate)},update:function(){if(c.updatePos(),b.update(),d.collected||Physics.isCollision(hero,d,0)&&(d.collected=!0,audio.itemPickedUp.play(),hero.ammo+=d.val),c.visible)c.collected||(c.visible&&(c.vY+=game.gravity),Physics.isCollision(hero,c,0)&&(c.collected=!0,audio.itemPickedUp.play(),hero.cash+=c.val));else for(var f=0;f<hero.bulletArr.length;++f)Physics.isCollision(hero.bulletArr[f],c,-17)&&(c.visible=!0,audio.discovery.play());if(a(),b.health>0){Physics.isCollision(hero,b,0)&&(b.active=!0,hero.invincible||(audio.play(audio.heartbeat,!0),hero.invincible=!0,--hero.health));for(var f=0;f<hero.bulletArr.length;++f){var g=!1;Physics.isCollision(hero.bulletArr[f],b,0)&&(g=!0,audio.play(audio.thud,!0)),g&&(b.active=!0,hero.bulletArr.splice(f,1),--b.health,b.health<=0&&b.death())}}Physics.isCollision(hero,e,0)&&alert("Level 1 completed")},render:function(){d.collected||d.draw(),c.visible&&c.draw(),b.deadOffScreen||b.draw(),Graphics.drawDoor(e.x,e.y,e.w,e.h),f.draw(),lvl0.crate.holding?0===hero.vX&&(lvl0.crate.x=hero.x+2,lvl0.crate.y=hero.y+11):lvl0.crate.draw()}}}(),game=function(){function a(){hero.update(),level.update()}function b(a){a-g>0&&(game.renderTimeBtw=a-g),g=a,d=requestAnimFrame(b),level.render(),hero.render(),level.drawAfterHero(),c()}function c(){var a=1e3/game.renderTimeBtw;if("Infinity"!=a&&h.push(a),game.totalTicks%120===0){var b=0;for(var c in h)b+=h[c];f=h.length>0?Math.floor(b/h.length):0,h=[]}ctx.fillStyle="#ddd",ctx.font="12px 'Press Start 2P'",ctx.fillText(f+" FPS",FULLW-84,FULLH+65)}var d,e,f=0,g=0,h=[0];return{gravity:.07,padBot:119,padHUD:80,padFloor:39,lvl:-1,updateFPS:1e3/120,renderTimeBtw:0,totalTicks:0,actualTime:0,start:function(){e=setInterval(function(){++game.totalTicks,Graphics.ticker+=Graphics.fadeOut?-Graphics.tickerStep:Graphics.tickerStep,a()},game.updateFPS),b()},stop:function(){window.cancelAnimationFrame(d),clearInterval(e)}}}(),hero=function(){function a(){hero.invincible&&--hero.invincibleTimer,hero.invincibleTimer<=0&&(hero.invincible=!1,hero.invincibleTimer=hero.invincibleTimer0),hero.health<=0&&!i&&(audio.heroDeath.play(),audio.bgMusic.muted=!0,alert("You died"),location.reload(),i=!0)}function b(){game.totalTicks%30===0&&(h=!h);var a={x:0,y:0};hero.isCarrying&&0===hero.vX?a=j.playerDown:hero.dir==Dir.RIGHT?a=hero.vX>0?Math.abs(hero.vX)<=3.5*hero.aX?j.playerRight_Step:h?j.playerRight_Run1:j.playerRight_Run2:j.playerRight:hero.dir==Dir.LEFT&&(a=hero.vX<0?Math.abs(hero.vX)<=3.5*hero.aX?j.playerLeft_Step:h?j.playerLeft_Run1:j.playerLeft_Run2:j.playerLeft);var b=hero.invincibleTimer%40;hero.invincible&&b>=0&&16>=b&&(a={x:-1,y:-1}),hero.sx=a.x,hero.sy=a.y}function c(){f&&hero.sx>=0&&hero.sy>=0&&ctx.drawImage(g,hero.sx,hero.sy,hero.w,hero.h,hero.x,hero.y,hero.w,hero.h)}var d=null,e=null,f=!1,g=null,h=!0,i=!1,j=[];return{x:0,y:0,sx:0,sy:0,lvlX:0,w:28,h:38,vX:0,vY:0,maxVx:3.6,maxVy:10,aX:.17,aY:.5,jumpMod:4,jumpMod0:4,dir:Dir.RIGHT,isJumping:!1,isCarrying:!1,onGround:!0,isOnObj:!0,invincible:!1,invincibleTimer:120,invincibleTimer0:120,health:4,maxHealth:5,medKits:1,healthLvl:1,mana:0,maxMana:4,manaKits:1,manaLvl:1,ammo:20,cash:0,lvl:1,xp:0,xpNeeded:50,bulletArr:[],physics:null,init:function(){g=new Image,g.onload=function(){f=!0},g.src="../dungeon/web/img/sprites/player/player.png",$.get("../dungeon/web/img/sprites/player/player.xml",function(a){var b=$(a).find("sprite");$(b).each(function(){var a=$(this).attr("n"),b=$(this).attr("x"),c=$(this).attr("y");
a=a.substring(0,a.length-4),j[a]={x:b,y:c}})}),d=HeroInputComponent(),d.init(),hero.physics=HeroPhysicsComponent(),e=HeroGraphicsComponent(),e.init(),$.extend(hero,new SAT.Box(new SAT.Vector(hero.x,hero.y),hero.w,hero.h).toPolygon())},update:function(){d.check(),hero.physics.updatePosition(),hero.physics.checkCollision(),a(),b()},render:function(){c(),e.drawBullets(),e.drawHealth(),e.drawMana(),e.drawXP()}}}(),HeroGraphicsComponent=function(){var a=null,b=!1;return{init:function(){a=new Image,a.src="img/shuriken.png",a.onload=function(){b=!0}},drawBullets:function(){for(var b=0;b<hero.bulletArr.length;++b){var c=hero.bulletArr[b].dirR?hero.w:0;hero.bulletArr[b].deg+=5,Graphics.drawRotate(a,hero.bulletArr[b].x+c,hero.bulletArr[b].y+20,hero.bulletArr[b].deg)}},drawHealth:function(){for(var a=0;a<hero.health;++a)ctx.fillStyle="red",ctx.fillRect(80+21*a,FULLH+14,19,8)},drawMana:function(){for(var a=0;a<hero.mana;++a)ctx.fillStyle="#00b6ff",ctx.fillRect(80+21*a,FULLH+37,19,8)},drawXP:function(){ctx.fillStyle="#ddd",ctx.font="12px 'Press Start 2P'";var a=hero.xp<10?"0":"";ctx.fillText(a+hero.xp+"/"+hero.xpNeeded,80,FULLH+71)}}},HeroPhysicsComponent=function(){function a(){for(var a=0;a<hero.bulletArr.length;++a)hero.bulletArr[a].x+=hero.bulletArr[a].dirR?bullet.speed:-bullet.speed,(hero.bulletArr[a].x>canvas.width||hero.bulletArr[a].x<0)&&hero.bulletArr.splice(a,1)}function b(){hero.onGround=!1,hero.y<-hero.h?(hero.y=-hero.h,hero.vY=0):hero.y>=canvas.height-game.padBot-hero.h&&(hero.y=canvas.height-game.padBot-hero.h,hero.isJumping=!1,hero.onGround=!0,hero.vY=0),hero.x<0?(hero.x=0,hero.vX=0):hero.x>canvas.width-hero.w&&(hero.x=canvas.width-hero.w,hero.vX=0)}function c(){hero.isOnObj=!1,Physics.lvlObjCollision(hero,function(a){1===a.overlapN.y?(hero.isOnObj=!0,hero.isJumping=!1,hero.vY=0):-1===a.overlapN.y&&(hero.vY=0)}),lvl0.crate.holding||32 in keysDown||Physics.isSATcollision(hero,lvl0.crate,function(a){if(1===a.overlapN.y)hero.y-=a.overlapV.y,hero.isOnObj=!0,hero.isJumping=!1,hero.vY=0;else{hero.isCarrying=!0,lvl0.crate.holding=!0,lvl0.crate.vY=6.5;var b=level.items.indexOf(lvl0.crate);level.items.splice(b,1)}})}return{updatePosition:function(){hero.x!==hero.x+hero.vX&&audio.step.play(),(hero.dir==Dir.RIGHT&&hero.x>=canvas.width/2+35||hero.dir==Dir.LEFT&&hero.x<=canvas.width/2-45)&&hero.lvlX+hero.vX>=0&&hero.lvlX+hero.vX<=level.width-canvas.width?(hero.lvlX+=hero.vX,level.updateObjs()):hero.x+=hero.vX,hero.y+=hero.vY},checkCollision:function(){a(),b(),c()}}},HeroInputComponent=function(){return{init:function(){keysDown={},lastKeyDown=-1,addEventListener("keydown",function(a){32==a.keyCode?a.preventDefault():77==a.keyCode?audio.handleMuteButton():66==a.keyCode?$(".resize").trigger("click"):75!=a.keyCode||hero.isJumping||75==lastKeyDown&&75 in keysDown||!hero.isOnObj&&!hero.onGround?74!=a.keyCode||74==lastKeyDown&&74 in keysDown?a.keyCode==KeyCode.O&&utils.toggleMenu():hero.ammo>0&&!hero.isCarrying&&(audio.play(audio.effort),hero.bulletArr[hero.bulletArr.length]={x:hero.x,y:hero.y,w:bullet.w,h:bullet.h,dirR:hero.dir==Dir.RIGHT,deg:0},--hero.ammo):(audio.jump.play(),hero.vY=0,hero.isJumping=!0,hero.isOnObj=!1),lastKeyDown=a.keyCode,keysDown[a.keyCode]=!0},!1),addEventListener("keyup",function(a){delete keysDown[a.keyCode]},!1)},check:function(){var a=!1;if(hero.isJumping?hero.jumpMod>0?hero.vY-=hero.aY*hero.jumpMod--:a=!0:(hero.jumpMod=hero.jumpMod0,a=!0),a){var b=hero.vY+2*game.gravity;hero.vY=b>hero.maxVY?hero.maxVy:b}var c=!1;65 in keysDown&&(hero.vX=Math.abs(hero.vX-hero.aX)>hero.maxVx?-hero.maxVx:hero.vX-hero.aX,hero.dir=Dir.LEFT,c=!0),68 in keysDown&&(hero.vX=Math.abs(hero.vX+hero.aX)>hero.maxVx?hero.maxVx:hero.vX+hero.aX,hero.dir=Dir.RIGHT,c=!0),Math.abs(hero.vX)<hero.aX?hero.vX=0:c||(hero.vX/=1.26),32 in keysDown&&(lvl0.crate.holding=!1,hero.isCarrying=!1),72 in keysDown&&hero.medKits>0&&hero.health<hero.maxHealth&&(++hero.health,--hero.medKits,audio.play(audio.enchant,!0)),82 in keysDown&&!(17 in keysDown)&&hero.manaKits>0&&hero.mana<hero.maxMana&&(++hero.mana,--hero.manaKits,audio.play(audio.enchant,!0))}}},Main=function(){function a(){canvas=$("canvas")[0],ctx=canvas.getContext("2d"),FULLW=canvas.width,FULLH=canvas.height,FULLH-=game.padHUD,HALFW=FULLW/2,HALFH=FULLH/2}function b(){audio.bgMusic.loop=!0,audio.bgMusic.volume=.7,audio.bgMusic.pause(),audio.enemyDeath.volume=.6,audio.jump.volume=.4,audio.thud.volume=.78,audio.discovery.volume=.7,audio.mute(!0),$(document).on("click",".audioState",audio.handleMuteButton),$(".menu").on("click",function(a){a.preventDefault(),utils.toggleMenu()}),audio.handleMuteButton()}function c(){ctx.fillStyle="#e1e1e1",ctx.font="25px 'Press Start 2P'",ctx.fillText("LOADING...",HALFW-80,HALFH+20)}return{init:function(){a(),b(),c(),level.init(),hero.init(),setInterval(function(){++game.actualTime},1e3),startScreen.start(),"jon"===location.host&&(lastKeyDown=KeyCode.ENTER,audio.handleMuteButton())}}}();$(function(){Main.init()});