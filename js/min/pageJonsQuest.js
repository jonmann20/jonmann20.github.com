function StartScreen(){this.width=FULLW,level.isCutscene=!0}!function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-43015655-1","jonmann20.github.io"),ga("send","pageview"),function(a,b,c){function d(c,d,e){var f=b.createElement(c);return d&&(f.id=_+d),e&&(f.style.cssText=e),a(f)}function e(){return c.innerHeight?c.innerHeight:a(c).height()}function f(a){var b=y.length,c=(Q+a)%b;return 0>c?b+c:c}function g(a,b){return Math.round((/%/.test(a)?("x"===b?z.width():e())/100:1)*parseInt(a,10))}function h(a,b){return a.photo||a.photoRegex.test(b)}function i(a,b){return a.retinaUrl&&c.devicePixelRatio>1?b.replace(a.photoRegex,a.retinaSuffix):b}function j(a){"contains"in r[0]&&!r[0].contains(a.target)&&(a.stopPropagation(),r.focus())}function k(){var b,c=a.data(P,$);null==c?(K=a.extend({},Z),console&&console.log&&console.log("Error: cboxElement missing settings object")):K=a.extend({},c);for(b in K)a.isFunction(K[b])&&"on"!==b.slice(0,2)&&(K[b]=K[b].call(P));K.rel=K.rel||P.rel||a(P).data("rel")||"nofollow",K.href=K.href||a(P).attr("href"),K.title=K.title||P.title,"string"==typeof K.href&&(K.href=a.trim(K.href))}function l(c,d){a(b).trigger(c),hb.triggerHandler(c),a.isFunction(d)&&d.call(P)}function m(c){U||(P=c,k(),y=a(P),Q=0,"nofollow"!==K.rel&&(y=a("."+ab).filter(function(){var b,c=a.data(this,$);return c&&(b=a(this).data("rel")||c.rel||this.rel),b===K.rel}),Q=y.index(P),-1===Q&&(y=y.add(P),Q=y.length-1)),q.css({opacity:parseFloat(K.opacity),cursor:K.overlayClose?"pointer":"auto",visibility:"visible"}).show(),X&&r.add(q).removeClass(X),K.className&&r.add(q).addClass(K.className),X=K.className,K.closeButton?I.html(K.close).appendTo(t):I.appendTo("<div/>"),S||(S=T=!0,r.css({visibility:"hidden",display:"block"}),A=d(ib,"LoadedContent","width:0; height:0; overflow:hidden"),t.css({width:"",height:""}).append(A),L=u.height()+x.height()+t.outerHeight(!0)-t.height(),M=v.width()+w.width()+t.outerWidth(!0)-t.width(),N=A.outerHeight(!0),O=A.outerWidth(!0),K.w=g(K.initialWidth,"x"),K.h=g(K.initialHeight,"y"),A.css({width:"",height:K.h}),W.position(),l(bb,K.onOpen),J.add(D).hide(),r.focus(),K.trapFocus&&b.addEventListener&&(b.addEventListener("focus",j,!0),hb.one(fb,function(){b.removeEventListener("focus",j,!0)})),K.returnFocus&&hb.one(fb,function(){a(P).focus()})),p())}function n(){!r&&b.body&&(Y=!1,z=a(c),r=d(ib).attr({id:$,"class":a.support.opacity===!1?_+"IE":"",role:"dialog",tabindex:"-1"}).hide(),q=d(ib,"Overlay").hide(),C=a([d(ib,"LoadingOverlay")[0],d(ib,"LoadingGraphic")[0]]),s=d(ib,"Wrapper"),t=d(ib,"Content").append(D=d(ib,"Title"),E=d(ib,"Current"),H=a('<button type="button"/>').attr({id:_+"Previous"}),G=a('<button type="button"/>').attr({id:_+"Next"}),F=d("button","Slideshow"),C),I=a('<button type="button"/>').attr({id:_+"Close"}),s.append(d(ib).append(d(ib,"TopLeft"),u=d(ib,"TopCenter"),d(ib,"TopRight")),d(ib,!1,"clear:left").append(v=d(ib,"MiddleLeft"),t,w=d(ib,"MiddleRight")),d(ib,!1,"clear:left").append(d(ib,"BottomLeft"),x=d(ib,"BottomCenter"),d(ib,"BottomRight"))).find("div div").css({"float":"left"}),B=d(ib,!1,"position:absolute; width:9999px; visibility:hidden; display:none; max-width:none;"),J=G.add(H).add(E).add(F),a(b.body).append(q,r.append(s,B)))}function o(){function c(a){a.which>1||a.shiftKey||a.altKey||a.metaKey||a.ctrlKey||(a.preventDefault(),m(this))}return r?(Y||(Y=!0,G.click(function(){W.next()}),H.click(function(){W.prev()}),I.click(function(){W.close()}),q.click(function(){K.overlayClose&&W.close()}),a(b).bind("keydown."+_,function(a){var b=a.keyCode;S&&K.escKey&&27===b&&(a.preventDefault(),W.close()),S&&K.arrowKey&&y[1]&&!a.altKey&&(37===b?(a.preventDefault(),H.click()):39===b&&(a.preventDefault(),G.click()))}),a.isFunction(a.fn.on)?a(b).on("click."+_,"."+ab,c):a("."+ab).live("click."+_,c)),!0):!1}function p(){var e,f,j,m=W.prep,n=++jb;T=!0,R=!1,P=y[Q],k(),l(gb),l(cb,K.onLoad),K.h=K.height?g(K.height,"y")-N-L:K.innerHeight&&g(K.innerHeight,"y"),K.w=K.width?g(K.width,"x")-O-M:K.innerWidth&&g(K.innerWidth,"x"),K.mw=K.w,K.mh=K.h,K.maxWidth&&(K.mw=g(K.maxWidth,"x")-O-M,K.mw=K.w&&K.w<K.mw?K.w:K.mw),K.maxHeight&&(K.mh=g(K.maxHeight,"y")-N-L,K.mh=K.h&&K.h<K.mh?K.h:K.mh),e=K.href,V=setTimeout(function(){C.show()},100),K.inline?(j=d(ib).hide().insertBefore(a(e)[0]),hb.one(gb,function(){j.replaceWith(A.children())}),m(a(e))):K.iframe?m(" "):K.html?m(K.html):h(K,e)?(e=i(K,e),R=b.createElement("img"),a(R).addClass(_+"Photo").bind("error",function(){K.title=!1,m(d(ib,"Error").html(K.imgError))}).one("load",function(){var b;n===jb&&(a.each(["alt","longdesc","aria-describedby"],function(b,c){var d=a(P).attr(c)||a(P).attr("data-"+c);d&&R.setAttribute(c,d)}),K.retinaImage&&c.devicePixelRatio>1&&(R.height=R.height/c.devicePixelRatio,R.width=R.width/c.devicePixelRatio),K.scalePhotos&&(f=function(){R.height-=R.height*b,R.width-=R.width*b},K.mw&&R.width>K.mw&&(b=(R.width-K.mw)/R.width,f()),K.mh&&R.height>K.mh&&(b=(R.height-K.mh)/R.height,f())),K.h&&(R.style.marginTop=Math.max(K.mh-R.height,0)/2+"px"),y[1]&&(K.loop||y[Q+1])&&(R.style.cursor="pointer",R.onclick=function(){W.next()}),R.style.width=R.width+"px",R.style.height=R.height+"px",setTimeout(function(){m(R)},1))}),setTimeout(function(){R.src=e},1)):e&&B.load(e,K.data,function(b,c){n===jb&&m("error"===c?d(ib,"Error").html(K.xhrError):a(this).contents())})}var q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z={html:!1,photo:!1,iframe:!1,inline:!1,transition:"elastic",speed:300,fadeOut:300,width:!1,initialWidth:"600",innerWidth:!1,maxWidth:!1,height:!1,initialHeight:"450",innerHeight:!1,maxHeight:!1,scalePhotos:!0,scrolling:!0,href:!1,title:!1,rel:!1,opacity:.9,preloading:!0,className:!1,overlayClose:!0,escKey:!0,arrowKey:!0,top:!1,bottom:!1,left:!1,right:!1,fixed:!1,data:void 0,closeButton:!0,fastIframe:!0,open:!1,reposition:!0,loop:!0,slideshow:!1,slideshowAuto:!0,slideshowSpeed:2500,slideshowStart:"start slideshow",slideshowStop:"stop slideshow",photoRegex:/\.(gif|png|jp(e|g|eg)|bmp|ico|webp)((#|\?).*)?$/i,retinaImage:!1,retinaUrl:!1,retinaSuffix:"@2x.$1",current:"image {current} of {total}",previous:"previous",next:"next",close:"close",xhrError:"This content failed to load.",imgError:"This image failed to load.",returnFocus:!0,trapFocus:!0,onOpen:!1,onLoad:!1,onComplete:!1,onCleanup:!1,onClosed:!1},$="colorbox",_="cbox",ab=_+"Element",bb=_+"_open",cb=_+"_load",db=_+"_complete",eb=_+"_cleanup",fb=_+"_closed",gb=_+"_purge",hb=a("<a/>"),ib="div",jb=0,kb={},lb=function(){function a(){clearTimeout(g)}function b(){(K.loop||y[Q+1])&&(a(),g=setTimeout(W.next,K.slideshowSpeed))}function c(){F.html(K.slideshowStop).unbind(i).one(i,d),hb.bind(db,b).bind(cb,a),r.removeClass(h+"off").addClass(h+"on")}function d(){a(),hb.unbind(db,b).unbind(cb,a),F.html(K.slideshowStart).unbind(i).one(i,function(){W.next(),c()}),r.removeClass(h+"on").addClass(h+"off")}function e(){f=!1,F.hide(),a(),hb.unbind(db,b).unbind(cb,a),r.removeClass(h+"off "+h+"on")}var f,g,h=_+"Slideshow_",i="click."+_;return function(){f?K.slideshow||(hb.unbind(eb,e),e()):K.slideshow&&y[1]&&(f=!0,hb.one(eb,e),K.slideshowAuto?c():d(),F.show())}}();a.colorbox||(a(n),W=a.fn[$]=a[$]=function(b,c){var d=this;if(b=b||{},n(),o()){if(a.isFunction(d))d=a("<a/>"),b.open=!0;else if(!d[0])return d;c&&(b.onComplete=c),d.each(function(){a.data(this,$,a.extend({},a.data(this,$)||Z,b))}).addClass(ab),(a.isFunction(b.open)&&b.open.call(d)||b.open)&&m(d[0])}return d},W.position=function(b,c){function d(){u[0].style.width=x[0].style.width=t[0].style.width=parseInt(r[0].style.width,10)-M+"px",t[0].style.height=v[0].style.height=w[0].style.height=parseInt(r[0].style.height,10)-L+"px"}var f,h,i,j=0,k=0,l=r.offset();if(z.unbind("resize."+_),r.css({top:-9e4,left:-9e4}),h=z.scrollTop(),i=z.scrollLeft(),K.fixed?(l.top-=h,l.left-=i,r.css({position:"fixed"})):(j=h,k=i,r.css({position:"absolute"})),k+=K.right!==!1?Math.max(z.width()-K.w-O-M-g(K.right,"x"),0):K.left!==!1?g(K.left,"x"):Math.round(Math.max(z.width()-K.w-O-M,0)/2),j+=K.bottom!==!1?Math.max(e()-K.h-N-L-g(K.bottom,"y"),0):K.top!==!1?g(K.top,"y"):Math.round(Math.max(e()-K.h-N-L,0)/2),r.css({top:l.top,left:l.left,visibility:"visible"}),s[0].style.width=s[0].style.height="9999px",f={width:K.w+O+M,height:K.h+N+L,top:j,left:k},b){var m=0;a.each(f,function(a){return f[a]!==kb[a]?(m=b,void 0):void 0}),b=m}kb=f,b||r.css(f),r.dequeue().animate(f,{duration:b||0,complete:function(){d(),T=!1,s[0].style.width=K.w+O+M+"px",s[0].style.height=K.h+N+L+"px",K.reposition&&setTimeout(function(){z.bind("resize."+_,W.position)},1),c&&c()},step:d})},W.resize=function(a){var b;S&&(a=a||{},a.width&&(K.w=g(a.width,"x")-O-M),a.innerWidth&&(K.w=g(a.innerWidth,"x")),A.css({width:K.w}),a.height&&(K.h=g(a.height,"y")-N-L),a.innerHeight&&(K.h=g(a.innerHeight,"y")),a.innerHeight||a.height||(b=A.scrollTop(),A.css({height:"auto"}),K.h=A.height()),A.css({height:K.h}),b&&A.scrollTop(b),W.position("none"===K.transition?0:K.speed))},W.prep=function(c){function e(){return K.w=K.w||A.width(),K.w=K.mw&&K.mw<K.w?K.mw:K.w,K.w}function g(){return K.h=K.h||A.height(),K.h=K.mh&&K.mh<K.h?K.mh:K.h,K.h}if(S){var j,k="none"===K.transition?0:K.speed;A.empty().remove(),A=d(ib,"LoadedContent").append(c),A.hide().appendTo(B.show()).css({width:e(),overflow:K.scrolling?"auto":"hidden"}).css({height:g()}).prependTo(t),B.hide(),a(R).css({"float":"none"}),j=function(){function c(){a.support.opacity===!1&&r[0].style.removeAttribute("filter")}var e,g,j=y.length,m="frameBorder",n="allowTransparency";S&&(g=function(){clearTimeout(V),C.hide(),l(db,K.onComplete)},D.html(K.title).add(A).show(),j>1?("string"==typeof K.current&&E.html(K.current.replace("{current}",Q+1).replace("{total}",j)).show(),G[K.loop||j-1>Q?"show":"hide"]().html(K.next),H[K.loop||Q?"show":"hide"]().html(K.previous),lb(),K.preloading&&a.each([f(-1),f(1)],function(){var c,d,e=y[this],f=a.data(e,$);f&&f.href?(c=f.href,a.isFunction(c)&&(c=c.call(e))):c=a(e).attr("href"),c&&h(f,c)&&(c=i(f,c),d=b.createElement("img"),d.src=c)})):J.hide(),K.iframe?(e=d("iframe")[0],m in e&&(e[m]=0),n in e&&(e[n]="true"),K.scrolling||(e.scrolling="no"),a(e).attr({src:K.href,name:(new Date).getTime(),"class":_+"Iframe",allowFullScreen:!0,webkitAllowFullScreen:!0,mozallowfullscreen:!0}).one("load",g).appendTo(A),hb.one(gb,function(){e.src="//about:blank"}),K.fastIframe&&a(e).trigger("load")):g(),"fade"===K.transition?r.fadeTo(k,1,c):c())},"fade"===K.transition?r.fadeTo(k,0,function(){W.position(0,j)}):W.position(k,j)}},W.next=function(){!T&&y[1]&&(K.loop||y[Q+1])&&(Q=f(1),m(y[Q]))},W.prev=function(){!T&&y[1]&&(K.loop||Q)&&(Q=f(-1),m(y[Q]))},W.close=function(){S&&!U&&(U=!0,S=!1,l(eb,K.onCleanup),z.unbind("."+_),q.fadeTo(K.fadeOut||0,0),r.stop().fadeTo(K.fadeOut||0,0,function(){r.add(q).css({opacity:1,cursor:"auto"}).hide(),l(gb),A.empty().remove(),setTimeout(function(){U=!1,l(fb,K.onClosed)},1)}))},W.remove=function(){r&&(r.stop(),a.colorbox.close(),r.stop().remove(),q.remove(),U=!1,r=null,a("."+ab).removeData($).removeClass(ab),a(b).unbind("click."+_))},W.element=function(){return a(P)},W.settings=Z)}(jQuery,document,window);var SAT={};!function(a){"use strict";var b=function(a,b){this.x=a||0,this.y=b||0};a.Vector=b,b.prototype.copy=function(a){return this.x=a.x,this.y=a.y,this},b.prototype.perp=function(){var a=this.x;return this.x=this.y,this.y=-a,this},b.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this},b.prototype.normalize=function(){var a=this.len();return a>0&&(this.x=this.x/a,this.y=this.y/a),this},b.prototype.add=function(a){return this.x+=a.x,this.y+=a.y,this},b.prototype.sub=function(a){return this.x-=a.x,this.y-=a.y,this},b.prototype.scale=function(a,b){return this.x*=a,this.y*=b||a,this},b.prototype.project=function(a){var b=this.dot(a)/a.len2();return this.x=b*a.x,this.y=b*a.y,this},b.prototype.projectN=function(a){var b=this.dot(a);return this.x=b*a.x,this.y=b*a.y,this},b.prototype.projectN=b.prototype.projectN,b.prototype.reflect=function(a){var b=this.x,c=this.y;return this.project(a).scale(2),this.x-=b,this.y-=c,this},b.prototype.reflectN=function(a){var b=this.x,c=this.y;return this.projectN(a).scale(2),this.x-=b,this.y-=c,this},b.prototype.dot=function(a){return this.x*a.x+this.y*a.y},b.prototype.len2=function(){return this.dot(this)},b.prototype.len=function(){return Math.sqrt(this.len2())};var c=function(a,c){this.pos=a||new b,this.points=c||[],this.recalc()};a.Polygon=c,c.prototype.recalc=function(){var a=this.points,c=a.length;this.edges=[],this.normals=[];for(var d=0;c>d;d++){var e=a[d],f=c-1>d?a[d+1]:a[0],g=(new b).copy(f).sub(e),h=(new b).copy(g).perp().normalize();this.edges.push(g),this.normals.push(h)}};var d=function(a,c,d){this.pos=a||new b,this.w=c||0,this.h=d||0};a.Box=d,d.prototype.toPolygon=function(){var a=this.pos,d=this.w,e=this.h;return new c(new b(a.x,a.y),[new b,new b(d,0),new b(d,e),new b(0,e)])};for(var e=[],f=0;10>f;++f)e.push(new b);for(var g=[],f=0;5>f;++f)g.push([]);var h=function(){this.a=null,this.b=null,this.overlapN=new b,this.overlapV=new b,this.clear()};a.Response=h,h.prototype.clear=function(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this};var i=function(a,b,c){for(var d=Number.MAX_VALUE,e=-Number.MAX_VALUE,f=a.length,g=0;f>g;++g){var h=a[g].dot(b);d>h&&(d=h),h>e&&(e=h)}c[0]=d,c[1]=e},j=function(a,b,c,d,f,h){var j=g.pop(),k=g.pop(),l=e.pop().copy(b).sub(a),m=l.dot(f);if(i(c,f,j),i(d,f,k),k[0]+=m,k[1]+=m,j[0]>k[1]||k[0]>j[1])return e.push(l),g.push(j),g.push(k),!0;if(h){var n=0;if(j[0]<k[0])if(h.aInB=!1,j[1]<k[1])n=j[1]-k[0],h.bInA=!1;else{var o=j[1]-k[0],p=k[1]-j[0];n=p>o?o:-p}else if(h.bInA=!1,j[1]>k[1])n=j[0]-k[1],h.aInB=!1;else{var o=j[1]-k[0],p=k[1]-j[0];n=p>o?o:-p}var q=Math.abs(n);q<h.overlap&&(h.overlap=q,h.overlapN.copy(f),0>n&&h.overlapN.reverse())}return e.push(l),g.push(j),g.push(k),!1};a.testPolygonPolygon=function(a,b,c){for(var d=a.points,e=d.length,f=b.points,g=f.length,h=0;e>h;h++)if(j(a.pos,b.pos,d,f,a.normals[h],c))return!1;for(var h=0;g>h;h++)if(j(a.pos,b.pos,d,f,b.normals[h],c))return!1;return c&&(c.a=a,c.b=b,c.overlapV.copy(c.overlapN).scale(c.overlap)),!0}}(SAT);var utils=function(){var a;return{extend:function(a,b){$.extend(a,b);var c="imgReady";Object.defineProperty(a,c,{get:function(){return b[c]}})},speed2scale:function(a){return-.5*a+2},randF:function(a,b,c){return"undefined"==typeof c&&(c=2),parseFloat(Math.min(a+Math.random()*(b-a),b).toFixed(c))},repeatAction:function(a,b,c){var d=0,e=setInterval(function(){d++>b?clearInterval(e):c()},a)},deathSequence:function(){game.over||(game.over=!0,audio.heroDeath.play(),audio.bgMusic.muted=!0,setTimeout(function(){Graphics.fadeCanvas(function(){level.reset(),level.curLvl.deinit(),level.curLvl.init(),audio.isOn&&(audio.bgMusic.muted=!1)})},2600))},degToRad:function(a){return.017453292519943295*a},getTimeObj:function(a){if(0===a)return{min:"00",sec:"00"};var b=Math.floor(a/60),c=a%60;return 10>c&&(c="0"+c),10>b&&(b="0"+b),{min:b,sec:c}},browser:function(){var a,b=navigator.userAgent,c=b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];return/trident/i.test(c[1])?(a=/\brv[ :]+(\d+(\.\d+)?)/g.exec(b)||[],"IE "+(a[1]||"")):(c=c[2]?[c[1],c[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(a=b.match(/version\/([\.\d]+)/i))&&(c[2]=a[1]),c.join(" "))},printSlow:function(a){game.actualTime%10===0&&console.log(a)},printMouse:function(){$("canvas").on("mousemove",function(a){console.log(a.offsetX,a.offsetY)})},printDir:function(a){switch(a){case 0:console.log("Dir.NONE");break;case 1:console.log("Dir.TOP");break;case 2:console.log("Dir.BOT");break;case 3:console.log("Dir.LEFT");break;case 4:console.log("Dir.RIGHT");break;case 5:console.log("Dir.IN");break;default:console.log("Dir.unknown")}},toggleMenu:function(){"block"===$("#colorbox").css("display")?a.colorbox.close():a=$.colorbox({html:$(".gameInstructions").html(),width:320,height:530})},toggleFullScreen:function(){if($("body").hasClass("fullscreen"))$(".canvasWrap").css({width:"",marginLeft:""}),$("body").removeClass("fullscreen");else{$("body").addClass("fullscreen");var a=1.777778*$(window).height();$(".canvasWrap").css({width:a,marginLeft:-a/2})}}}}(),Dir=Object.freeze({NONE:0,TOP:1,BOT:2,LEFT:3,RIGHT:4,IN:5}),Color=Object.freeze({LIGHT_BROWN:"#c44525",DARK_BROWN:"#672819",LIGHT_GREEN:"#166a38",SILVER:"#c0c0c0",BLACK:"#000",GOLD:"#ddaa13",ORANGE:"#ff6a00"});window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(a){setTimeout(a,16.6666666667)}}();var audio=function(){return{bgMusic:new Audio("audio/firstChiptune/firstChiptune.mp3"),enterSound:new Audio("audio/synthetic_explosion_1.mp3"),exitSound:new Audio("audio/annulet.mp3"),itemPickedUp:new Audio("audio/life_pickup.mp3"),heartbeat:new Audio("audio/heartbeat.mp3"),jump:new Audio("audio/jump.mp3"),thud:new Audio("audio/thud.mp3"),step:new Audio("audio/step.mp3"),effort:new Audio("audio/woosh.mp3"),discovery:new Audio("audio/spell3.mp3"),enemyDeath:new Audio("audio/death.mp3"),heroDeath:new Audio("audio/DiscsOfTron_Cascade.mp3"),enchant:new Audio("audio/enchant.mp3"),isOn:!1,init:function(){audio.bgMusic.loop=!0,audio.bgMusic.volume=.7,audio.bgMusic.pause(),audio.enemyDeath.volume=.6,audio.jump.volume=.4,audio.thud.volume=.78,audio.discovery.volume=.7,audio.mute(!0),$(document).on("click",".audioState",audio.handleMuteButton),$(".menu").on("click",function(a){a.preventDefault(),utils.toggleMenu()}),audio.handleMuteButton()},lvlComplete:function(){audio.bgMusic.pause();var a;switch(game.lvl){case 0:audio.enterSound.play(),a="inspiredBySparkMan/sparkBoy.mp3";break;default:audio.exitSound.play(),a="sweetAcoustic.mp3"}setTimeout(function(){audio.bgMusic=new Audio("audio/"+a),audio.bgMusic.loop=!0,audio.bgMusic.volume=.45,audio.isOn?audio.bgMusic.play():audio.bgMusic.pause()},1e3)},play:function(a,b){b="undefined"!=typeof b?b:!0,a.ended?a.play():(b||0===a.currentTime)&&(a.pause(),a.currentTime=0,a.play())},handleMuteButton:function(){$(".audioState").hasClass("off")?($(".audioState span").removeClass("icon-volume-mute").addClass("icon-volume-medium"),$(".audioState").removeClass("off"),$(".audioState").addClass("on"),audio.mute(!1)):($(".audioState span").removeClass("icon-volume-medium").addClass("icon-volume-mute"),$(".audioState").removeClass("on"),$(".audioState").addClass("off"),audio.mute(!0))},mute:function(a){audio.discovery.muted=audio.enterSound.muted=audio.bgMusic.muted=audio.itemPickedUp.muted=audio.heartbeat.muted=audio.effort.muted=audio.thud.muted=audio.jump.muted=audio.step.muted=audio.enemyDeath.muted=audio.heroDeath.muted=audio.enchant.muted=audio.exitSound.muted=a,a?audio.bgMusic.pause():audio.bgMusic.play(),audio.isOn=!a}}}(),Graphics=function(){var a=1,b=null,c=250,d=c,e=c;return{ticker:1,tickerStep:.01,fadeOut:!1,projectX:8,projectY:11,fadeCanvas:function(a){"MSIE 9.0"===utils.browser()?a():($(canvas).removeClass("preTransition"),$(canvas).addClass("duringTransition"),b=$(canvas).on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){b.off(),$(this).removeClass("duringTransition"),$(this).addClass("preTransition"),a()}))},blinkText:function(b,c,d,e){e="undefined"!=typeof e?e:"PRESS ENTER",(Graphics.ticker>=1.35||Graphics.ticker<=Graphics.tickerStep)&&(Graphics.fadeOut=!Graphics.fadeOut),a=Graphics.ticker>=1?1:Graphics.ticker<=Graphics.tickerStep?0:Graphics.ticker,ctx.font=b+"px 'Press Start 2P'";var f=ctx.measureText(e).width;ctx.fillStyle="rgba(233, 233, 233,"+a+")",ctx.fillText(e,c-f/2,d)},getSkewedRect:function(a,b,c,d){b+=Graphics.projectY/2;var e=new SAT.Polygon(new SAT.Vector(a,b),[new SAT.Vector,new SAT.Vector(c-Graphics.projectX,0),new SAT.Vector(c,Graphics.projectY),new SAT.Vector(c,d),new SAT.Vector(Graphics.projectX,d),new SAT.Vector(0,d-Graphics.projectY)]);return e.type=JQObject.PLATFORM,e},drawLadder:function(a){var b=a.pos.x,c=a.pos.y,d=a.edges[0].x,e=a.edges[1].y;ctx.fillStyle=Color.LIGHT_BROWN,ctx.fillRect(b,c,5,e),ctx.fillRect(b+d-5,c,5,e);for(var f=13;e>f;f+=20)ctx.fillRect(b,c+f,d,8)},drawScale:function(a){var b=a.pos.x,c=a.pos.y,d=a.edges[0].x,e=a.edges[1].y;ctx.fillStyle=Color.BLACK,ctx.fillRect(b,c-1,d,1),ctx.fillStyle=Color.DARK_BROWN,ctx.fillRect(b,c,d,e)},drawPlatform:function(a){var b=a.pos.y-Graphics.projectY/2;ctx.fillStyle=Color.LIGHT_BROWN,ctx.beginPath(),ctx.moveTo(a.pos.x,b),ctx.lineTo(a.pos.x+a.points[1].x,b+a.points[1].y),ctx.lineTo(a.pos.x+a.points[2].x,b+a.points[2].y),ctx.lineTo(a.pos.x+Graphics.projectX,b+Graphics.projectY),ctx.closePath(),ctx.fill(),ctx.fillStyle=Color.DARK_BROWN,ctx.beginPath(),ctx.moveTo(a.pos.x+a.points[2].x,b+a.points[2].y),ctx.lineTo(a.pos.x+a.points[3].x,b+a.points[3].y),ctx.lineTo(a.pos.x+a.points[4].x,b+a.points[4].y),ctx.lineTo(a.pos.x+a.points[5].x,b+a.points[5].y),ctx.lineTo(a.pos.x+a.points[0].x,b+a.points[0].y),ctx.lineTo(a.pos.x+Graphics.projectX,b+Graphics.projectY),ctx.closePath(),ctx.fill()},drawPlatformStatus:function(a){var b=a.pos.x,c=a.pos.y,d=a.w,e=a.h,f=26,g=f/2,h=b+d/2-g,i=c+e/2-g;ctx.lineWidth=3,a.holdingItem===JQObject.CRATE?(ctx.strokeStyle="green",--i,ctx.beginPath(),ctx.moveTo(h,i+g),ctx.lineTo(h+g,i+f),ctx.moveTo(h+g-1,i+f),ctx.lineTo(h+f+2,i+2),ctx.stroke(),ctx.closePath()):(ctx.strokeStyle="red",ctx.beginPath(),ctx.moveTo(h,i),ctx.lineTo(h+f,i+f),ctx.moveTo(h,i+f),ctx.lineTo(h+f,i),ctx.stroke(),ctx.closePath())},drawDoor:function(a){var b=a.pos.x,c=a.pos.y,d=a.w,e=a.h;ctx.fillStyle=Color.LIGHT_BROWN,ctx.fillRect(b+2,c+2,d-2,e-2),ctx.fillStyle=Color.DARK_BROWN,ctx.fillRect(b,c,2,e),ctx.fillRect(b,c,d,2),ctx.fillRect(b+d,c,2,e),ctx.beginPath(),ctx.arc(b+d-d/3.2,c+e-e/3.4,4,0,2*Math.PI,!1),ctx.fill(),ctx.closePath(),ctx.font="19px 'Press Start 2P'",ctx.fillStyle=Color.DARK_BROWN,ctx.fillText("EXIT",b-15,c-3),ctx.fillStyle=Color.LIGHT_BROWN,ctx.fillText("EXIT",b-18,c-5)},getDoorBgGrad:function(){var a=ctx.createRadialGradient(level.bgColor.gradX,level.bgColor.gradY,14,level.bgColor.gradX,level.bgColor.gradY,490-e);return--d===-c?(d=c,e=c):0>d?++e:--e,a.addColorStop(0,"rgb(203,163,0)"),a.addColorStop(1,"#1F7DCF"),a},drawEllipse:function(a,b,c,d){var e=.5522848,f=c/2*e,g=d/2*e,h=a+c,i=b+d,j=a+c/2,k=b+d/2;ctx.beginPath(),ctx.moveTo(a,k),ctx.bezierCurveTo(a,k-g,j-f,b,j,b),ctx.bezierCurveTo(j+f,b,h,k-g,h,k),ctx.bezierCurveTo(h,k+g,j+f,i,j,i),ctx.bezierCurveTo(j-f,i,a,k+g,a,k),ctx.closePath(),ctx.fill()},drawRotate:function(a,b,c,d){ctx.save(),ctx.translate(b,c),ctx.rotate(utils.degToRad(d)),ctx.translate(.5*-a.width,.5*-a.height),ctx.drawImage(a,0,0),ctx.restore()}}}(),Physics=function(){return{isCollision:function(a,b,c,d){var e="undefined"!=typeof d?a.pos.x+a.lvlX:a.pos.x;return e+c<=b.pos.x+b.w&&b.pos.x+c<=e+a.w&&a.pos.y+c<=b.pos.y+b.h&&b.pos.y+c<=a.pos.y+a.h?!0:!1},isSATcollision:function(a,b,c){var d=new SAT.Response;SAT.testPolygonPolygon(a,b,d)&&c(d)},testObjObjs:function(a,b){for(var c=new SAT.Response,d=0;d<level.objs.length;++d)if("undefined"==typeof level.objs[d].collidable){var e=SAT.testPolygonPolygon(a,level.objs[d],c);if(e){c.a.pos.x-=c.overlapV.x,c.a.pos.y-=c.overlapV.y,b(c);break}c.clear()}},testItemItems:function(a,b){for(var c=new SAT.Response,d=0;d<level.items.length;++d)if(!level.items[d].isBeingHeld){if(level.items[d].type!==JQObject.CRATE)continue;var e=SAT.testPolygonPolygon(a,level.items[d],c);if(e&&1===c.overlapN.y){c.a.pos.x-=c.overlapV.x,c.a.pos.y-=c.overlapV.y,b(c);break}c.clear()}},testHeroItems:function(a){for(var b=0;b<level.items.length;++b)level.items[b].visible&&Physics.isSATcollision(hero,level.items[b],function(c){a(c,b)})}}}(),JQObject=Object.freeze({EMPTY:0,CRATE:1,LADDER:2,SACK:3,ENEMY:4,CASH:5,DOOR:6,SCALE:7,CLOUD:8,PLATFORM:9,FLOOR:10,SHURIKEN:11}),JQObject_names=Object.freeze({0:"EMPTY",1:"CRATE",2:"LADDER",3:"SACK",4:"ENEMY",5:"CASH",6:"DOOR",7:"SCALE",8:"CLOUD",9:"PLATFORM",10:"FLOOR",11:"SHURIKEN"}),GameObj=function(a,b,c,d,e,f){if(this.type=a,a===JQObject.FLOOR?($.extend(this,Graphics.getSkewedRect(b,c,d,e)),this.type=JQObject.FLOOR):$.extend(this,new SAT.Box(new SAT.Vector(b,c),d,e).toPolygon()),this.imgReady=!1,"undefined"==typeof f)this.w=d,this.h=e;else{this.w=0,this.h=0,this.img=new Image;var g=this;this.img.onload=function(){g.imgReady=!0,g.w=this.width,g.h=this.height},this.img.src="img/"+f}};GameObj.prototype={draw:function(){this.imgReady?ctx.drawImage(this.img,this.pos.x,this.pos.y):(ctx.fillStyle="red",ctx.fillRect(this.pos.x,this.pos.y,this.w,this.h))}};var GameItem=function(a,b,c,d){utils.extend(this,a),this.grabbable="undefined"!=typeof b?b:!1,this.val="undefined"!=typeof c?c:-1,this.visible="undefined"!=typeof d?d:!0,this.vY=0,this.isOnObj=!1,this.onObj=null,this.isBeingHeld=!1;var e=this.draw;this.draw=function(){this.visible&&e.apply(this)}},HUD=function(){function a(){for(var a=0;a<hero.health;++a)ctx.fillStyle="red",ctx.fillRect(77+21*a,FULLH+8,19,8)}function b(){for(var a=0;a<hero.mana;++a)ctx.fillStyle="#00b6ff",ctx.fillRect(77+21*a,FULLH+26,19,8)}function c(){ctx.fillStyle="#ddd",ctx.font="12px 'Press Start 2P'";var a=hero.xp<10?"0":"";ctx.fillText(a+hero.xp+"/"+hero.xpNeeded,77,FULLH+54)}var d=null,e=null,f=null,g=null;return{init:function(){d=new GameObj(JQObject.EMPTY,548,FULLH+20,22,24,"cash.png"),e=new GameObj(JQObject.EMPTY,238,FULLH+15,31,30,"medKit.png"),f=new GameObj(JQObject.EMPTY,447,FULLH+15,31,31,"shuriken.png"),g=new GameObj(JQObject.EMPTY,342,FULLH+18,25,25,"syringe.png")},draw:function(){ctx.fillStyle="#070707",ctx.fillRect(0,FULLH,FULLW,game.padHUD),ctx.fillStyle="#ddd",ctx.font="11px 'Press Start 2P'",ctx.fillText("HP-"+hero.healthLvl,7,FULLH+18),ctx.fillText("MP-"+hero.manaLvl,7,FULLH+37),ctx.fillText("XP",7,FULLH+54),a(),b(),c(),ctx.fillText(hero.medKits,210,FULLH+37),e.draw(),ctx.fillText(hero.manaKits,315,FULLH+37),g.draw(),ctx.fillText(hero.ammo,410,FULLH+37),f.draw(),ctx.fillText(hero.cash,515,FULLH+37),d.draw();var h=utils.getTimeObj(game.actualTime);ctx.fillText(h.min+":"+h.sec,FULLW-78,FULLH+24)}}}(),JQEnemy=Object.freeze({STILL:0,PATROL:1,FOLLOW:2}),Enemy=function(a,b,c,d,e,f){function g(a){var b=a.w/a.initHealth*a.health;ctx.fillStyle="red",ctx.fillRect(a.x,a.y-12,b,4)}utils.extend(this,a),this.initHealth=this.health=c,this.enemy_t=b,this.leftXBound=d,this.rightXBound=e,this.active="undefined"!=typeof f?f:!1,this.deadOffScreen=!1,this.dir=Dir.RIGHT,this.alive=!0,this.deadOnScreen=!1,this.clearDir=!0;var h=this.draw;this.draw=function(){(this.alive||this.deadOnScreen)&&(this.initHealth>1&&g(this),ctx.save(),this.deadOnScreen&&(ctx.globalAlpha=.3),h.apply(this),ctx.restore())}};Enemy.prototype={update:function(){this.deadOnScreen?(this.pos.x+=this.clearDir?2:-2,this.pos.y-=9,(this.pos.x<0||this.pos.x>FULLW)&&(this.deadOnScreen=!1,this.deadOffScreen=!0)):this.active&&game.totalTicks%3===0&&this.movement()},movement:function(){this.enemy_t===JQEnemy.PATROL?(this.pos.x+hero.lvlX<=this.leftXBound?this.dir=Dir.RIGHT:this.pos.x+hero.lvlX>=this.rightXBound&&(this.dir=Dir.LEFT),this.dir===Dir.RIGHT?++this.pos.x:--this.pos.x):this.enemy_t===JQEnemy.FOLLOW&&(this.pos.x<hero.pos.x?++this.pos.x:this.pos.x>hero.pos.x&&--this.pos.x)},death:function(){this.clearDir=hero.dir==Dir.RIGHT,audio.enemyDeath.play(),hero.xp+=15,this.alive=!1,this.deadOnScreen=!0}};var level=function(){function a(){for(var a=0;a<level.objs.length;++a)level.objs[a].pos.x-=hero.vX}function b(){for(var a=0;a<level.items.length;++a)level.items[a].pos.x-=hero.vX}function c(){level.bgColor.gradX-=hero.vX,level.bgColor.fillStyle=Graphics.getDoorBgGrad();for(var a=0;a<level.bg.length;++a)level.bg[a].pos.x-=hero.vX/level.bg[a].speed}function d(){for(var a=0;a<level.enemies.length;++a)level.enemies[a].pos.x-=hero.vX}function e(){for(var a=0;a<level.items.length;++a)level.items[a].visible&&!level.items[a].isOnObj&&(level.items[a].vY<k?level.items[a].vY+=game.gravity:level.items[a].vY=k,level.items[a].pos.y+=level.items[a].vY,Physics.testObjObjs(level.items[a],function(a){1===a.overlapN.y&&(audio.thud.play(),a.a.vY=0,a.a.isOnObj=!0,a.a.recentlyHeld=!1,a.b.type===JQObject.SCALE&&(a.a.grabbable=!1,a.b.holdingItem=JQObject.CRATE,utils.repeatAction(70,8,function(){++a.a.pos.y,++a.b.pos.y})))}),Physics.testItemItems(level.items[a],function(a){a.a.isOnObj=!0,a.a.onObj=a.b,a.b.grabbable=!1,a.a.recentlyHeld=!1}))}function f(){for(var a=0;a<level.enemies.length;++a)if(level.enemies[a].update(),level.enemies[a].health>0){SAT.testPolygonPolygon(hero,level.enemies[a])&&(level.enemies[a].active=!0,hero.invincible||(audio.play(audio.heartbeat,!0),hero.invincible=!0,--hero.health));for(var b=0;b<hero.bulletArr.length;++b)SAT.testPolygonPolygon(hero.bulletArr[b],level.enemies[a])&&(audio.play(audio.thud,!0),level.enemies[a].active=!0,hero.bulletArr.splice(b,1),--level.enemies[a].health,level.enemies[a].health<=0&&level.enemies[a].death())}}function g(){ctx.fillStyle=level.bgColor.fillStyle,ctx.fillRect(0,0,FULLW,level.bgColor.h);for(var a=0;a<level.bg.length;++a){var b=level.bg[a],c=utils.speed2scale(b.speed);ctx.drawImage(b.img,b.pos.x,b.pos.y,b.w*c,b.h*c)}}function h(){for(var a=0;a<level.objs.length;++a)("undefined"==typeof level.objs[a].visible||level.objs[a].visible)&&(level.objs[a].type===JQObject.LADDER?Graphics.drawLadder(level.objs[a]):level.objs[a].type===JQObject.SCALE?(Graphics.drawScale(level.objs[a]),Graphics.drawPlatformStatus(level.objs[a])):level.objs[a].type===JQObject.PLATFORM||level.objs[a].type===JQObject.FLOOR?Graphics.drawPlatform(level.objs[a]):level.objs[a].type===JQObject.DOOR?Graphics.drawDoor(level.objs[a]):(ctx.fillStyle=Color.DARK_BROWN,ctx.fillRect(level.objs[a].pos.x,level.objs[a].pos.y,level.objs[a].w,level.objs[a].h)))}function i(){for(var a=0;a<level.items.length;++a)level.items[a].draw()}function j(){for(var a=0;a<level.enemies.length;++a)level.enemies[a].deadOffScreen||level.enemies[a].draw()}var k=10;return{bgColor:{},bg:[],objs:[],items:[],enemies:[],curLvl:null,isCutscene:!1,time:0,hiddenItemsFound:0,hiddenItems:0,isTransitioning:!1,init:function(){level.reset(),level.curLvl=new StartScreen},reset:function(){game.over=!1,game.actualTime=0,level.hiddenItemsFound=0,hero.lvlX=0,level.bgColor={fillStyle:"#000",h:FULLH+game.padHUD},level.bg=[],level.objs=[],level.items=[],level.enemies=[],hero.pos.x=23,hero.pos.y=FULLH-game.padFloor-hero.h+4,hero.vX=hero.vY=0,hero.isJumping=!1,hero.bulletArr.length=0,hero.invincible=!1,hero.isHolding=!1,hero.curItem=null,hero.dir=Dir.RIGHT,hero.health=hero.maxHealth},complete:function(){level.isTransitioning=!0,audio.lvlComplete(),Graphics.ticker=1,Graphics.fadeOut=!0,Graphics.fadeCanvas(function(){level.isTransitioning=!1,level.reset(),level.curLvl=lvlComplete,level.isCutscene=!0,level.time=game.actualTime})},update:function(){level.isTransitioning||(e(),f(),level.curLvl.update())},updateView:function(){a(),b(),c(),d()},render:function(){g(),h(),i(),j(),level.curLvl.render()}}}(),lvlComplete=function(){return{update:function(){if(keysDown[KeyCode.ENTER]||0===game.lvl||window.DEBUG){switch(lastKeyDown=KeyCode.EMPTY,++game.lvl){case 1:lvl1.init(),level.curLvl=lvl1;break;case 2:lvl2.init(),level.curLvl=lvl2}level.isCutscene=!1}},render:function(){ctx.fillStyle="#000",ctx.fillRect(0,0,FULLW,canvas.height),ctx.font="24px 'Press Start 2P'";var a="LEVEL "+game.lvl+" COMPLETE",b=ctx.measureText(a).width;ctx.fillStyle=Color.ORANGE,ctx.fillText(a,HALFW-b/2,70),ctx.font="18px 'Press Start 2P'";{var c=utils.getTimeObj(level.time),d="LEVEL TIME......"+c.min+":"+c.sec;ctx.measureText(d).width}ctx.fillStyle="#e1e1e1",ctx.fillText(d,HALFW-b/2,150),ctx.font="18px 'Press Start 2P'";var e="HIDDEN ITEMS....."+level.hiddenItemsFound+"/"+level.hiddenItems,f=ctx.measureText(e).width;ctx.fillStyle="#e1e1e1",ctx.fillText(e,HALFW-f/2,190),Graphics.blinkText(16,HALFW,HALFH+120)}}}();StartScreen.prototype=function(){var a="JON'S",b="QUEST",c=String.fromCharCode("169")+" 2013 JON WIEDMANN";
return{update:function(){lastKeyDown===KeyCode.ENTER&&level.complete()},render:function(){ctx.font="29px 'Press Start 2P'";var d=HALFW-ctx.measureText(a).width/2+11,e=58;ctx.setTransform(1,0,-.4,1.4,0,0),ctx.fillStyle="#222",ctx.fillText("J",d+4,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("J",d,e),ctx.setTransform(1,0,-.2,1.4,0,0),ctx.fillStyle="#222",ctx.fillText("O",d+32,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("O",d+28,e),ctx.setTransform(1,0,.05,1.41,0,-1),ctx.fillStyle="#222",ctx.fillText("N",d+58,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("N",d+54,e),ctx.setTransform(1,0,.23,1.4,0,0),ctx.fillStyle="#222",ctx.fillText("'",d+78,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("'",d+74,e),ctx.setTransform(1,0,.42,1.4,0,0),ctx.fillStyle="#222",ctx.fillText("S",d+95,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("S",d+91,e),ctx.font="36px 'Press Start 2P'",d=HALFW-ctx.measureText(b).width/2+30,e=98,ctx.setTransform(1,0,-.5,1.6,0,0),ctx.fillStyle="#222",ctx.fillText("Q",d+4,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("Q",d,e),ctx.setTransform(1,0,-.25,1.6,0,0),ctx.fillStyle="#222",ctx.fillText("U",d+26,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("U",d+22,e),ctx.setTransform(1,0,.03,1.6,0,0),ctx.fillStyle="#222",ctx.fillText("E",d+50,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("E",d+46,e),ctx.setTransform(1,0,.25,1.6,0,0),ctx.fillStyle="#222",ctx.fillText("S",d+74,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("S",d+70,e),ctx.setTransform(1,0,.5,1.6,0,0),ctx.fillStyle="#222",ctx.fillText("T",d+90,e+4),ctx.fillStyle="#ff6a00",ctx.fillText("T",d+86,e),ctx.setTransform(1,0,0,1,0,0),Graphics.blinkText(22,HALFW,HALFH+81),ctx.font="13px 'Press Start 2P'",ctx.fillStyle="#ddd",ctx.fillText(c,HALFW-ctx.measureText(c).width/2,FULLH+44)}}}();var lvl1=function(){function a(){if(i)hero.onLadder=SAT.testPolygonPolygon(hero,h);else{for(var a=0,b=0;b<level.objs.length;++b)level.objs[b].type===JQObject.SCALE&&"undefined"!=typeof level.objs[b].holdingItem&&level.objs[b].holdingItem===JQObject.CRATE&&++a;if(i=3===a){var c=$.grep(level.objs,function(a){return a.type===JQObject.LADDER});c[0].visible=!0}}}function b(){level.bgColor.gradX=g.pos.x+g.w/2,level.bgColor.gradY=g.pos.y+g.h/2,level.bgColor.h=FULLH,level.bgColor.fillStyle=Graphics.getDoorBgGrad();for(var a=0,b=0,c=180;a<lvl1.width;){var d=new GameObj(JQObject.CLOUD,a,10+b,0,0,"cloud.png");d.speed=utils.randF(2,3.3,1),level.bg.push(d),a+=d.w*utils.speed2scale(d.speed)+Math.floor(70*Math.random()+35),b=Math.floor(Math.random()*c)}}function c(){level.objs.push(new GameObj(JQObject.FLOOR,-Graphics.projectX,FULLH-game.padFloor-1,lvl1.width+2*Graphics.projectX,game.padFloor+1),Graphics.getSkewedRect(200,206,267,62),Graphics.getSkewedRect(575,310,300,62),Graphics.getSkewedRect(605,125,220,62));for(var a=[],b=0;3>b;++b)a[b]=new GameObj(JQObject.SCALE,lvl1.width-330-230*b,FULLH-game.padFloor-157,150,46),a[b].holdingItem=JQObject.EMPTY,level.objs.push(a[b]);for(var c={x:1160,y:210,w:0,h:0},d=5,e=17,b=0;15>b;++b)level.objs.push(Graphics.getSkewedRect(c.x+e*b,c.y-d*b,e+1,62)),c.w+=e,c.h+=d;return level.objs.push(Graphics.getSkewedRect(c.x+c.w,c.y-c.h,200,62)),g=new GameObj(JQObject.DOOR,c.x+c.w+143,c.y-c.h-62+Graphics.projectY/2,33,62),level.objs.push(g),h=new GameItem(new GameObj(JQObject.LADDER,c.x-37,c.y-1,38,FULLH-c.y-game.padFloor),!1,0,!1),h.collidable=!1,level.objs.push(h),[a[1].pos.x+a[1].w/2,a[2].pos.x+a[2].w/2]}function d(a){for(var b=[],c=0;3>c;++c)b.push(new GameItem(new GameObj(JQObject.CRATE,446,FULLH-game.padFloor-26+5,34,37,"crate.png"),!0));b[1].pos.x=a[0]-b[0].w/2,b[2].pos.x=a[1]-b[0].w/2;var d=new GameItem(new GameObj(JQObject.SACK,680,111+Graphics.projectY/2,30,34,"sack.png"),!1,5);f=new GameItem(new GameObj(JQObject.CASH,113,80,22,24,"cash.png"),!1,10,!1),level.items.push(b[0],b[1],b[2],d,f)}function e(){var a=new Enemy(new GameObj(JQObject.ENEMY,1600,FULLH-game.padFloor-76+Graphics.projectY/2,55,76,"cyborgBnW.png"),JQEnemy.FOLLOW,1,1087,1600,!1);a.collidable=!1,level.enemies.push(a)}var f,g,h,i=!1;return{width:2700,init:function(){level.hiddenItems=1;var a=c();d(a),e(),b()},deinit:function(){f=null,g=null,h=null,i=!1},update:function(){if(window.DEBUG&&level.complete(),a(),!f.visible)for(var b=0;b<hero.bulletArr.length;++b)Physics.isCollision(hero.bulletArr[b],f,-17)&&(f.visible=!0,audio.discovery.play(),++level.hiddenItemsFound);!game.over&&Physics.isCollision(hero,g,0)&&level.complete()},render:function(){}}}(),lvl2=function(){function a(){}function b(){var a=new GameObj(JQObject.EMPTY,-Graphics.projectX,FULLH-game.padFloor-1,FULLW/3+40,game.padFloor+1),b=new GameObj(JQObject.EMPTY,HALFW,FULLH-game.padFloor-1,120,game.padFloor+1),c=new GameObj(JQObject.EMPTY,b.pos.x+b.w,b.pos.y-b.h,300,150),d=new GameObj(JQObject.EMPTY,c.pos.x+b.w,b.pos.y-2.5*b.h,100,25);return level.objs.push(c,a,b,d),[b.pos,b.w]}function c(){new GameItem(new GameObj(JQObject.CRATE,206,FULLH-game.padFloor-26+5,24,26,"crate.png"),!0)}function d(a){var b=new Enemy(new GameObj(JQObject.ENEMY,a[0].x,a[0].y-38,28,38,"cyborgBnW.png"),JQEnemy.PATROL,1,a[0].x,a[0].x+a[1]-28,!0);b.collidable=!0}return{width:2700,init:function(){level.hiddenItems=0,a();var e=b();c(),d(e)},deinit:function(){},update:function(){},render:function(){ctx.font="18px 'Press Start 2P'";var a="LEVEL 2 -- COMING SOON",b=ctx.measureText(a).width;ctx.fillStyle="#e1e1e1",ctx.fillText(a,HALFW-b/2,150)}}}(),game=function(){function a(){level.isCutscene||level.isTransitioning||game.over||hero.update(),level.update()}function b(a){a-g>0&&(h=a-g),g=a,d=requestAnimFrame(b),level.render(),level.isCutscene||(game.over||hero.render(),HUD.draw(),c())}function c(){if(i.push(1e3/h),game.totalTicks%120===0){for(var a=0,b=i.length;--b;)a+=i[b];for(f=i.length>0?Math.floor(a/i.length):0;i.length>0;)i.pop()}ctx.fillStyle="#ddd",ctx.font="11px 'Press Start 2P'",ctx.fillText(f+" FPS",FULLW-77,FULLH+50)}var d,e,f=0,g=0,h=16,i=[60];return{over:!1,gravity:.13,padHUD:58,padFloor:16,lvl:0,totalTicks:0,actualTime:0,start:function(){e=setInterval(function(){++game.totalTicks,Graphics.ticker+=Graphics.fadeOut?-Graphics.tickerStep:Graphics.tickerStep,a()},8.3333),b()},stop:function(){window.cancelAnimationFrame(d),clearInterval(e)}}}(),Shuriken={w:31,h:31,speed:4.4},hero=function(){function a(){hero.invincible&&--l,0>=l&&(hero.invincible=!1,l=m),hero.health<=0&&!game.over&&utils.deathSequence()}function b(){var a={x:0,y:0};if(hero.isHolding&&0===hero.vX)a=k.playerDown;else if(hero.onLadder)a=k.playerUp;else if(hero.dir===Dir.RIGHT||hero.dir===Dir.LEFT){var b=hero.dir===Dir.RIGHT,c="player"+(b?"Right":"Left");if(b&&hero.vX>0||!b&&hero.vX<0){var d=game.totalTicks%60;hero.isOnObj?Math.abs(hero.vX)<=10*hero.aX?a=k[c+"_Step"]:d>=0&&20>d?(a=k[c+"_Run1"],hero.isJumping||audio.step.play()):a=d>=20&&40>d?k[c+"_Run2"]:k[c+"_Run3"]:a=k[c+"_Run1"]}else a=k[c]}if(hero.onLadder||0!==hero.vX||0!==hero.vY?j=0:++j,j>210){var e=j%200;e>=0&&50>=e||e>100&&150>=e||hero.isHolding?a=k.playerDown:e>50&&100>=e?a=k.playerDown_breatheIn:e>150&&200>=e&&(a=k.playerDown_breatheOut)}var f=l%40;hero.invincible&&f>=0&&16>=f&&(a={x:-1,y:-1}),hero.sx=a.x,hero.sy=a.y}function c(){h&&hero.sx>=0&&hero.sy>=0&&ctx.drawImage(i,hero.sx,hero.sy,hero.w,hero.h,Math.round(hero.pos.x),Math.round(hero.pos.y),hero.w,hero.h)}function d(){hero.isHolding&&hero.curItem.draw()}var e=null,f=null,g=null,h=!1,i=null,j=0,k=[],l=170,m=170;return{sx:0,sy:0,lvlX:0,w:48,h:65,vX:0,vY:0,aX:.17,aY:.82,jumpMod:4,jumpMod0:4,dir:Dir.RIGHT,onLadder:!1,invincible:!1,isJumping:!1,isHolding:!1,isOnObj:!0,curItem:null,health:3,maxHealth:3,medKits:1,healthLvl:1,mana:0,maxMana:4,manaKits:1,manaLvl:1,ammo:20,cash:0,lvl:1,xp:0,xpNeeded:50,bulletArr:[],init:function(){i=new Image,i.onload=function(){h=!0},i.src="/games/common/img/sprites/player/player.png",$.get("/games/common/img/sprites/player/player.xml",function(a){var b=$(a).find("sprite");$(b).each(function(){var a=$(this).attr("n"),b=$(this).attr("x"),c=$(this).attr("y");a=a.substring(0,a.length-4),k[a]={x:b,y:c}})}),e=HeroInputComponent(),g=HeroPhysicsComponent(),f=HeroGraphicsComponent(),$.extend(hero,new SAT.Box(new SAT.Vector(0,0),hero.w,hero.h).toPolygon())},update:function(){e.check(),g.updatePosition(),g.checkCollision(),a(),b()},render:function(){c(),f.drawBullets(),d()}}}(),HeroGraphicsComponent=function(){var a=!1,b=new Image;return b.src="img/shuriken.png",b.onload=function(){a=!0},{drawBullets:function(){for(var c=0;c<hero.bulletArr.length;++c){var d=hero.bulletArr[c].dirR?hero.w:0;hero.bulletArr[c].deg+=5,a&&Graphics.drawRotate(b,hero.bulletArr[c].pos.x+d,hero.bulletArr[c].pos.y+20,hero.bulletArr[c].deg)}}}},HeroPhysicsComponent=function(){function a(){for(var a=0;a<hero.bulletArr.length;++a)hero.bulletArr[a].pos.x+=hero.bulletArr[a].dirR?Shuriken.speed:-Shuriken.speed,hero.bulletArr[a].pos.x>FULLW||hero.bulletArr[a].pos.x<0?hero.bulletArr.splice(a,1):Physics.testObjObjs(hero.bulletArr[a],function(){hero.bulletArr.splice(a,1)})}function b(){hero.pos.y<-hero.h?(hero.pos.y=-hero.h,hero.vY=0):hero.pos.y>=FULLH+2*hero.h&&(game.over||utils.deathSequence()),hero.pos.x<0?(hero.pos.x=0,hero.vX=0):hero.pos.x>FULLW-hero.w&&(hero.pos.x=FULLW-hero.w,hero.vX=0)}function c(){hero.isOnObj=!1,Physics.testObjObjs(hero,function(a){1===a.overlapN.y?(hero.isOnObj=!0,hero.isJumping=!1,hero.vY=0):-1===a.overlapN.y&&(hero.vY=0)}),hero.isHolding&&(0===hero.vX?(hero.curItem.pos.x=hero.pos.x+7,hero.curItem.pos.y=hero.pos.y+20):(hero.curItem.pos.x=hero.pos.x+(hero.dir===Dir.RIGHT?45:-32),hero.curItem.pos.y=hero.pos.y+16)),Physics.testHeroItems(function(a,b){a.b.type===JQObject.CRATE?1===a.overlapN.y?(hero.pos.y-=a.overlapV.y,hero.isOnObj=!0,hero.isJumping=!1,hero.vY=0):hero.isHolding||!a.b.grabbable||a.b.recentlyHeld||(a.b.isOnObj===!0&&(a.b.isOnObj=!1,null!==a.b.onObj&&(a.b.onObj.grabbable=!0,a.b.onObj=null)),a.b.isBeingHeld=!0,hero.curItem=a.b,hero.isHolding=!0,level.items.splice(b,1)):(audio.itemPickedUp.play(),a.b.type===JQObject.SACK?hero.ammo+=a.b.val:a.b.type===JQObject.CASH&&(hero.cash+=a.b.val),level.items.splice(b,1))})}return{updatePosition:function(){(hero.dir===Dir.RIGHT&&hero.pos.x>=HALFW+35||hero.dir===Dir.LEFT&&hero.pos.x<=HALFW-45)&&hero.lvlX+hero.vX>=0&&hero.lvlX+hero.vX<=level.curLvl.width-FULLW?(hero.lvlX+=hero.vX,level.updateView()):hero.pos.x+=hero.vX,hero.onLadder||(hero.pos.y+=hero.vY)},checkCollision:function(){a(),b(),c()}}},KeyCode=Object.freeze({ENTER:13,CTRL:17,A:65,D:68,F:70,H:72,J:74,K:75,M:77,O:79,R:82,S:83,W:87,EMPTY:-1,SPACEBAR:32}),HeroInputComponent=function(){var a=2.6,b=10;return keysDown={},lastKeyDown=-1,$(document).on("click",".resize",function(){$(this).hasClass("off")?($(this).removeClass("off").addClass("on"),$(this).children("span").removeClass("icon-expand").addClass("icon-contract")):$(this).hasClass("on")&&($(this).removeClass("on").addClass("off"),$(this).children("span").removeClass("icon-contract").addClass("icon-expand")),utils.toggleFullScreen()}),addEventListener("keydown",function(a){if(a.keyCode===KeyCode.SPACEBAR)a.preventDefault();else if(a.keyCode===KeyCode.M)audio.handleMuteButton();else if(a.keyCode===KeyCode.F)$(".resize").trigger("click");else if(a.keyCode!==KeyCode.K||hero.isJumping||lastKeyDown===KeyCode.K&&keysDown[KeyCode.K]||!hero.isOnObj){if(a.keyCode!==KeyCode.J||lastKeyDown==KeyCode.J&&keysDown[KeyCode.J])a.keyCode==KeyCode.O&&utils.toggleMenu();else if(hero.ammo>0&&!hero.isHolding){audio.play(audio.effort);var b=new GameObj(JQObject.SHURIKEN,hero.pos.x,hero.pos.y,Shuriken.w,Shuriken.h);b.dirR=hero.dir===Dir.RIGHT,b.deg=0,hero.bulletArr.push(b),--hero.ammo}}else audio.jump.play(),hero.vY=0,hero.isJumping=!0,hero.isOnObj=!1;lastKeyDown=a.keyCode,keysDown[a.keyCode]=!0},!1),addEventListener("keyup",function(a){delete keysDown[a.keyCode]},!1),{check:function(){var c=!1;if(hero.isJumping?hero.jumpMod>0?hero.vY-=hero.aY*hero.jumpMod--:c=!0:(hero.jumpMod=hero.jumpMod0,c=!0),c&&!hero.onLadder){var d=hero.vY+2*game.gravity;hero.vY=d>b?b:d}var e=!1;keysDown[KeyCode.A]&&(hero.vX=Math.abs(hero.vX-hero.aX)>a?-a:hero.vX-hero.aX,hero.dir=Dir.LEFT,e=!0),keysDown[KeyCode.D]&&(hero.vX=Math.abs(hero.vX+hero.aX)>a?a:hero.vX+hero.aX,hero.dir=Dir.RIGHT,e=!0),Math.abs(hero.vX)<hero.aX?hero.vX=0:e||(hero.vX/=1.26),keysDown[KeyCode.W]&&hero.onLadder&&--hero.pos.y,keysDown[KeyCode.S]&&hero.onLadder&&++hero.pos.y,keysDown[KeyCode.SPACEBAR]&&hero.isHolding&&(hero.isHolding=!1,hero.curItem.isBeingHeld=!1,hero.curItem.recentlyHeld=!0,level.items.push(hero.curItem),hero.curItem=null),keysDown[KeyCode.H]&&hero.medKits>0&&hero.health<hero.maxHealth&&(++hero.health,--hero.medKits,audio.play(audio.enchant,!0)),keysDown[KeyCode.R]&&!keysDown[KeyCode.CTRL]&&hero.manaKits>0&&hero.mana<hero.maxMana&&(++hero.mana,--hero.manaKits,audio.play(audio.enchant,!0))}}},Main=function(){function a(){canvas=$("canvas")[0],ctx=canvas.getContext("2d"),FULLW=canvas.width,FULLH=canvas.height-game.padHUD,HALFW=FULLW/2,HALFH=FULLH/2}function b(){ctx.fillStyle="#e1e1e1",ctx.font="25px 'Press Start 2P'",ctx.fillText("LOADING...",HALFW-80,HALFH+20)}function c(){"jon"===location.host&&($(canvas).css({transition:"opacity 0.01s"}),lastKeyDown=KeyCode.ENTER,audio.handleMuteButton())}return{init:function(){a(),b(),hero.init(),audio.init(),level.init(),HUD.init(),$(document).on("fontLoaded",function(){setInterval(function(){++game.actualTime},1e3),game.start(),c()})}}}();$(function(){window.WebFontConfig={google:{families:["Press Start 2P"]},active:function(){$(document).trigger("fontLoaded")},inactive:function(){alert("There was a problem loading a font from google, some text may not render correctly (refreshing the page may fix the issue)."),$(document).trigger("fontLoaded")}},function(){var a=document.createElement("script");a.src="//ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",a.type="text/javascript",a.async="true";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}(),Main.init()});